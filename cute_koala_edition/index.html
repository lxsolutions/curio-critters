<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Curio Critters - Koko the Koala's Cute Adventure! üê®‚ú®</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
        }

        body {
            font-family: 'Comic Sans MS', cursive;
            background: linear-gradient(135deg, #FFB6C1 0%, #FFE4E1 50%, #E6E6FA 100%);
            height: 100vh;
            overflow: hidden;
            margin: 0;
            padding: 0;
            display: grid;
            grid-template-areas: 
                "header header header"
                "left-panel game-world right-panel"
                "bottom-panel bottom-panel bottom-panel";
            grid-template-columns: 280px 1fr 280px;
            grid-template-rows: 70px 1fr 140px;
            gap: 8px;
            padding: 8px;
        }

        .game-header {
            grid-area: header;
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 2px solid #FFB6C1;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .game-world-container {
            grid-area: game-world;
            background: rgba(255,255,255,0.98);
            border-radius: 20px;
            padding: 15px;
            border: 3px solid #4682B4;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow: hidden;
            position: relative;
        }

        .left-panel {
            grid-area: left-panel;
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 10px;
            border: 2px solid #9370DB;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            overflow-y: auto;
            max-height: 100%;
            position: relative;
        }

        .right-panel {
            grid-area: right-panel;
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 10px;
            border: 2px solid #32CD32;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            overflow-y: auto;
            max-height: 100%;
            position: relative;
        }

        .bottom-panel {
            grid-area: bottom-panel;
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 10px;
            border: 2px solid #FFD700;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            display: flex;
            gap: 15px;
            overflow-x: auto;
            align-items: center;
        }

        .panel-toggle {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(255,255,255,0.9);
            border: 1px solid #ccc;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 12px;
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .panel-toggle:hover {
            background: rgba(255,255,255,1);
            transform: scale(1.1);
        }

        .panel-minimized {
            height: 50px !important;
            overflow: hidden;
        }

        .panel-title {
            font-size: 12px;
            font-weight: bold;
            color: #8B008B;
            text-align: center;
            margin-bottom: 8px;
            padding: 5px;
            background: rgba(255,182,193,0.3);
            border-radius: 8px;
        }

        .game-container {
            display: none; /* Hide old container */
        }

        /* Header Styles */
        .header-left, .header-center, .header-right {
            display: flex;
            align-items: center;
        }

        .player-details {
            margin-left: 8px;
        }

        .player-name {
            font-size: 12px;
            font-weight: bold;
            color: #8B008B;
        }

        .player-level {
            font-size: 10px;
            color: #9370DB;
        }

        .game-title {
            font-size: 16px;
            font-weight: bold;
            color: #4682B4;
            text-align: center;
        }

        .resource-display {
            display: flex;
            gap: 15px;
            font-size: 12px;
            font-weight: bold;
            color: #8B008B;
        }

        /* Panel Content Styles */
        .stats-display {
            margin-bottom: 15px;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
            font-size: 10px;
        }

        .stat-bar {
            flex: 1;
            height: 8px;
            background: rgba(200,200,200,0.3);
            border-radius: 4px;
            overflow: hidden;
        }

        .stat-fill {
            height: 100%;
            background: linear-gradient(90deg, #32CD32, #90EE90);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .activity-section, .features-section, .advanced-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 120px;
        }

        .activity-buttons, .special-buttons, .advanced-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .activity-button {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px;
            background: rgba(255,255,255,0.8);
            border: 2px solid #32CD32;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 60px;
        }

        .activity-button:hover {
            background: rgba(50,205,50,0.2);
            transform: scale(1.05);
        }

        .activity-icon {
            font-size: 20px;
            margin-bottom: 4px;
        }

        .activity-name {
            font-size: 8px;
            font-weight: bold;
            color: #32CD32;
        }

        .weather-display {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }

        .weather-icon {
            font-size: 24px;
        }

        .weather-text {
            font-size: 10px;
            font-weight: bold;
            color: #4682B4;
        }

        .weather-temp {
            font-size: 9px;
            color: #708090;
        }

        .friends-list {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .friend-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px;
            background: rgba(255,255,255,0.6);
            border-radius: 8px;
            font-size: 9px;
        }

        .friend-item.locked {
            opacity: 0.5;
        }

        .friendship-bar {
            width: 40px;
            height: 6px;
            background: rgba(200,200,200,0.3);
            border-radius: 3px;
            overflow: hidden;
        }

        .friendship-fill {
            height: 100%;
            background: linear-gradient(90deg, #FFB6C1, #FF69B4);
            border-radius: 3px;
        }

        .locked-text {
            font-size: 8px;
            color: #808080;
        }

        /* Movement Controls Adjustments */
        .movement-controls {
            background: rgba(255,255,255,0.9);
            border: 2px solid #4682B4;
            border-radius: 15px;
            padding: 8px;
            margin-top: 10px;
            text-align: center;
        }

        .movement-instructions {
            font-size: 9px;
            color: #4682B4;
            margin-bottom: 6px;
            font-weight: bold;
        }

        /* Mini Map Adjustments */
        .mini-map {
            margin-bottom: 15px;
        }

        .mini-map-content {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 3px;
            margin-bottom: 6px;
        }

        .map-location {
            width: 25px;
            height: 25px;
            background: rgba(139,69,19,0.2);
            border: 1px solid #8B4513;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .current-location {
            font-size: 8px;
            color: #8B4513;
            text-align: center;
            font-weight: bold;
        }

        /* Koko Thoughts Panel Adjustments */
        .koko-thoughts-panel {
            background: rgba(255,182,193,0.3);
            border-radius: 10px;
            padding: 8px;
            margin-bottom: 15px;
        }

        .koko-thought {
            font-size: 9px;
            color: #FF69B4;
            text-align: center;
            font-style: italic;
            margin-bottom: 4px;
            min-height: 15px;
        }

        .mood-indicator {
            font-size: 8px;
            color: #FF1493;
            text-align: center;
            font-weight: bold;
        }

        /* Critter Collection Styles */
        .critter-collection {
            margin-bottom: 15px;
        }

        .collection-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-size: 9px;
            font-weight: bold;
            color: #8B008B;
        }

        .collection-btn {
            padding: 3px 6px;
            background: #9370DB;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 7px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .collection-btn:hover {
            background: #8B008B;
            transform: scale(1.05);
        }

        .active-critter-display {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            background: rgba(255,255,255,0.8);
            border: 2px solid #9370DB;
            border-radius: 10px;
            margin-bottom: 8px;
        }

        .critter-avatar {
            font-size: 24px;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(147,112,219,0.2);
            border-radius: 50%;
        }

        .critter-info {
            flex: 1;
        }

        .critter-name {
            font-size: 10px;
            font-weight: bold;
            color: #8B008B;
        }

        .critter-level {
            font-size: 8px;
            color: #9370DB;
        }

        .critter-specialization {
            font-size: 7px;
            color: #DDA0DD;
            font-style: italic;
        }

        .switch-critter-btn {
            padding: 4px;
            background: rgba(147,112,219,0.3);
            border: 1px solid #9370DB;
            border-radius: 50%;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .switch-critter-btn:hover {
            background: rgba(147,112,219,0.6);
            transform: scale(1.1);
        }

        .critter-growth-display {
            margin-bottom: 8px;
        }

        .growth-title {
            font-size: 8px;
            font-weight: bold;
            color: #8B008B;
            margin-bottom: 4px;
        }

        .growth-bars {
            display: flex;
            flex-direction: column;
            gap: 3px;
        }

        .growth-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
        }

        .growth-bar {
            flex: 1;
            height: 6px;
            background: rgba(200,200,200,0.3);
            border-radius: 3px;
            overflow: hidden;
        }

        .growth-fill {
            height: 100%;
            background: linear-gradient(90deg, #32CD32, #90EE90);
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .unlock-progress {
            margin-bottom: 8px;
        }

        .unlock-title {
            font-size: 8px;
            font-weight: bold;
            color: #8B008B;
            margin-bottom: 4px;
        }

        .next-critter {
            font-size: 7px;
            color: #9370DB;
        }

        .unlock-bar {
            width: 100%;
            height: 4px;
            background: rgba(200,200,200,0.3);
            border-radius: 2px;
            overflow: hidden;
            margin-top: 2px;
        }

        .unlock-fill {
            height: 100%;
            background: linear-gradient(90deg, #FFD700, #FFA500);
            border-radius: 2px;
            transition: width 0.3s ease;
        }

        /* Critter Collection Modal */
        .critter-collection-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(45deg, #F0F8FF, #E6E6FA);
            border: 3px solid #9370DB;
            border-radius: 20px;
            padding: 15px;
            z-index: 3000;
            max-width: 500px;
            max-height: 600px;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(147,112,219,0.4);
        }

        .critter-collection-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            font-size: 16px;
            font-weight: bold;
            color: #8B008B;
        }

        .collection-stats {
            display: flex;
            justify-content: space-around;
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(255,255,255,0.8);
            border-radius: 10px;
        }

        .stat {
            font-size: 10px;
            color: #9370DB;
            font-weight: bold;
        }

        .critter-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }

        .critter-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            background: rgba(255,255,255,0.9);
            border: 2px solid #DDA0DD;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .critter-card:hover {
            background: rgba(221,160,221,0.3);
            transform: scale(1.05);
        }

        .critter-card.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .critter-card.discovered {
            border-color: #FFD700;
            background: rgba(255,215,0,0.1);
        }

        .critter-card.owned {
            border-color: #32CD32;
            background: rgba(50,205,50,0.1);
        }

        .critter-card-emoji {
            font-size: 32px;
            margin-bottom: 5px;
        }

        .critter-card-name {
            font-size: 9px;
            font-weight: bold;
            color: #8B008B;
            text-align: center;
        }

        .critter-card-type {
            font-size: 7px;
            color: #9370DB;
            text-align: center;
        }

        .critter-card-status {
            font-size: 6px;
            color: #DDA0DD;
            text-align: center;
            margin-top: 3px;
        }

        /* Critter Switcher Modal */
        .critter-switcher-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(45deg, #E6E6FA, #F0F8FF);
            border: 3px solid #4169E1;
            border-radius: 20px;
            padding: 15px;
            z-index: 3000;
            max-width: 400px;
            box-shadow: 0 10px 30px rgba(65,105,225,0.4);
        }

        .critter-switcher-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            font-size: 14px;
            font-weight: bold;
            color: #4169E1;
        }

        .owned-critters-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .owned-critter-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: rgba(255,255,255,0.9);
            border: 2px solid #87CEEB;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .owned-critter-item:hover {
            background: rgba(135,206,235,0.3);
            transform: scale(1.02);
        }

        .owned-critter-item.active {
            border-color: #4169E1;
            background: rgba(65,105,225,0.2);
        }

        .owned-critter-emoji {
            font-size: 24px;
        }

        .owned-critter-details {
            flex: 1;
        }

        .owned-critter-name {
            font-size: 12px;
            font-weight: bold;
            color: #4169E1;
        }

        .owned-critter-stats {
            font-size: 9px;
            color: #6495ED;
        }

        /* Story Mode Styles */
        .story-mode-panel {
            margin-bottom: 15px;
        }

        .current-chapter {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            background: rgba(255,255,255,0.8);
            border: 2px solid #8B4513;
            border-radius: 10px;
            margin-bottom: 6px;
        }

        .chapter-info {
            display: flex;
            align-items: center;
            gap: 6px;
            flex: 1;
        }

        .chapter-info span {
            font-size: 16px;
        }

        .chapter-details {
            flex: 1;
        }

        .chapter-title {
            font-size: 9px;
            font-weight: bold;
            color: #8B4513;
        }

        .chapter-progress {
            font-size: 7px;
            color: #A0522D;
        }

        .story-btn {
            padding: 4px 8px;
            background: #8B4513;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 7px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .story-btn:hover {
            background: #A0522D;
            transform: scale(1.05);
        }

        .story-stats {
            display: flex;
            justify-content: space-between;
            font-size: 7px;
            color: #8B4513;
        }

        .story-stat {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2px;
        }

        /* Achievements Styles */
        .achievements-panel {
            margin-bottom: 15px;
        }

        .achievement-summary {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        }

        .achievement-count {
            font-size: 10px;
            font-weight: bold;
            color: #DAA520;
        }

        .achievements-btn {
            padding: 3px 6px;
            background: #DAA520;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 7px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .achievements-btn:hover {
            background: #B8860B;
            transform: scale(1.05);
        }

        .recent-achievements {
            background: rgba(255,255,255,0.6);
            border-radius: 8px;
            padding: 6px;
        }

        .recent-title {
            font-size: 8px;
            font-weight: bold;
            color: #DAA520;
            margin-bottom: 4px;
        }

        .recent-list {
            display: flex;
            flex-direction: column;
            gap: 3px;
        }

        .recent-achievement {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 7px;
            color: #B8860B;
        }

        .no-achievements {
            font-size: 7px;
            color: #999;
            font-style: italic;
            text-align: center;
        }

        /* Story Mode Modal */
        .story-mode-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(45deg, #F5DEB3, #DEB887);
            border: 3px solid #8B4513;
            border-radius: 20px;
            padding: 20px;
            z-index: 3000;
            max-width: 600px;
            max-height: 700px;
            overflow-y: auto;
            box-shadow: 0 15px 40px rgba(139,69,19,0.4);
        }

        .story-mode-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            font-size: 18px;
            font-weight: bold;
            color: #8B4513;
        }

        .chapter-selection {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }

        .chapter-card {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: rgba(255,255,255,0.9);
            border: 2px solid #DEB887;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .chapter-card:hover {
            background: rgba(222,184,135,0.3);
            transform: scale(1.02);
        }

        .chapter-card.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .chapter-card.completed {
            border-color: #32CD32;
            background: rgba(50,205,50,0.1);
        }

        .chapter-emoji {
            font-size: 48px;
        }

        .chapter-info-detailed {
            flex: 1;
        }

        .chapter-title-large {
            font-size: 16px;
            font-weight: bold;
            color: #8B4513;
            margin-bottom: 5px;
        }

        .chapter-description {
            font-size: 12px;
            color: #A0522D;
            margin-bottom: 8px;
        }

        .chapter-status {
            font-size: 10px;
            color: #DAA520;
            font-weight: bold;
        }

        .story-scene {
            background: rgba(255,255,255,0.9);
            border-radius: 15px;
            padding: 20px;
        }

        .scene-title {
            font-size: 18px;
            font-weight: bold;
            color: #8B4513;
            margin-bottom: 15px;
            text-align: center;
        }

        .scene-content {
            font-size: 14px;
            color: #654321;
            line-height: 1.6;
            margin-bottom: 20px;
            text-align: center;
        }

        .scene-choices {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .choice-button {
            padding: 12px 20px;
            background: linear-gradient(45deg, #DAA520, #FFD700);
            color: #8B4513;
            border: 2px solid #B8860B;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .choice-button:hover {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            transform: scale(1.02);
        }

        /* Achievements Modal */
        .achievements-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(45deg, #FFF8DC, #F0E68C);
            border: 3px solid #DAA520;
            border-radius: 20px;
            padding: 20px;
            z-index: 3000;
            max-width: 700px;
            max-height: 800px;
            overflow-y: auto;
            box-shadow: 0 15px 40px rgba(218,165,32,0.4);
        }

        .achievements-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            font-size: 18px;
            font-weight: bold;
            color: #DAA520;
        }

        .category-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .category-tab {
            padding: 8px 12px;
            background: rgba(255,255,255,0.8);
            border: 2px solid #DAA520;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 10px;
            font-weight: bold;
            color: #B8860B;
        }

        .category-tab:hover {
            background: rgba(218,165,32,0.3);
        }

        .category-tab.active {
            background: #DAA520;
            color: white;
        }

        .achievement-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .achievement-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px;
            background: rgba(255,255,255,0.9);
            border: 2px solid #DDD;
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .achievement-item.unlocked {
            border-color: #32CD32;
            background: rgba(50,205,50,0.1);
        }

        .achievement-item.locked {
            opacity: 0.6;
        }

        .achievement-emoji {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .achievement-name {
            font-size: 12px;
            font-weight: bold;
            color: #DAA520;
            text-align: center;
            margin-bottom: 5px;
        }

        .achievement-desc {
            font-size: 9px;
            color: #B8860B;
            text-align: center;
            margin-bottom: 8px;
        }

        .achievement-progress {
            width: 100%;
            height: 6px;
            background: rgba(200,200,200,0.3);
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 5px;
        }

        .achievement-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #DAA520, #FFD700);
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .achievement-reward {
            font-size: 8px;
            color: #8B4513;
            text-align: center;
        }

        .game-screen {
            width: 100%;
            height: 100%;
            position: relative;
            background: radial-gradient(circle at center, rgba(255,182,193,0.2) 0%, transparent 70%);
        }

        /* Cute Mode Selector */
        .mode-selector {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 35px;
            background: linear-gradient(90deg, rgba(255,182,193,0.9), rgba(255,228,225,0.9));
            display: flex;
            z-index: 200;
            border-bottom: 3px solid #FFB6C1;
        }

        .mode-tab {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
            color: #FF69B4;
        }

        .mode-tab.active {
            background: linear-gradient(45deg, #FFB6C1, #FFE4E1);
            color: #8B008B;
            border-bottom-color: #FF69B4;
            box-shadow: 0 2px 8px rgba(255,105,180,0.3);
        }

        .mode-tab:hover:not(.active) {
            background: rgba(255,182,193,0.5);
            transform: translateY(-1px);
        }

        /* Cute HUD */
        .cute-hud {
            position: absolute;
            top: 35px;
            left: 0;
            right: 0;
            background: linear-gradient(180deg, rgba(255,182,193,0.9) 0%, transparent 100%);
            padding: 8px;
            z-index: 100;
        }

        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        }

        .player-info {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .player-avatar {
            width: 35px;
            height: 35px;
            background: linear-gradient(45deg, #FFB6C1, #FFE4E1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            border: 3px solid #FF69B4;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(255,105,180,0.4);
        }

        .player-avatar:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(255,105,180,0.6);
        }

        .level-section {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .level-badge {
            background: linear-gradient(45deg, #FF69B4, #FFB6C1);
            color: white;
            padding: 2px 6px;
            border-radius: 12px;
            font-size: 9px;
            font-weight: bold;
            text-align: center;
            box-shadow: 0 2px 6px rgba(255,105,180,0.3);
        }

        .xp-container {
            width: 70px;
        }

        .xp-bar {
            height: 4px;
            background: rgba(255,255,255,0.3);
            border-radius: 6px;
            overflow: hidden;
            border: 1px solid #FF69B4;
        }

        .xp-fill {
            height: 100%;
            background: linear-gradient(90deg, #FF69B4, #FFB6C1);
            transition: width 0.5s ease;
            box-shadow: 0 0 8px rgba(255,105,180,0.5);
        }

        .xp-text {
            font-size: 7px;
            color: #FF69B4;
            text-align: center;
            margin-top: 1px;
            font-weight: bold;
        }

        .resources {
            display: flex;
            gap: 6px;
            font-size: 10px;
            color: #FF69B4;
            font-weight: bold;
        }

        .resource-item {
            display: flex;
            align-items: center;
            gap: 3px;
            background: rgba(255,255,255,0.7);
            padding: 3px 6px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid #FFB6C1;
            font-size: 12px;
        }

        .resource-item:hover {
            background: rgba(255,182,193,0.8);
            transform: scale(1.05);
            box-shadow: 0 2px 6px rgba(255,105,180,0.3);
        }

        /* Cute Stats */
        .cute-stats {
            display: flex;
            gap: 2px;
            margin-bottom: 4px;
        }

        .stat-mini {
            flex: 1;
            height: 4px;
            background: rgba(255,255,255,0.3);
            border-radius: 6px;
            overflow: hidden;
            border: 1px solid #FFB6C1;
        }

        .stat-fill-mini {
            height: 100%;
            transition: width 0.5s ease;
        }

        .health-fill { background: linear-gradient(90deg, #FF69B4, #FFB6C1); }
        .energy-fill { background: linear-gradient(90deg, #98FB98, #90EE90); }
        .happiness-fill { background: linear-gradient(90deg, #FFD700, #FFA500); }
        .love-fill { background: linear-gradient(90deg, #FF1493, #FF69B4); }

        /* Adorable Koala Display */
        .koala-area {
            position: absolute;
            top: 25%;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
        }

        .koala-container {
            position: relative;
            display: inline-block;
        }

        .cute-koala {
            font-size: 120px;
            cursor: pointer;
            transition: all 0.3s ease;
            filter: drop-shadow(0 0 20px rgba(255,182,193,0.6));
            animation: koalaBounce 3s infinite ease-in-out;
            position: relative;
        }

        .cute-koala:hover {
            transform: scale(1.15);
            filter: drop-shadow(0 0 30px rgba(255,105,180,0.8));
        }

        .cute-koala:active {
            transform: scale(0.9);
        }

        @keyframes koalaBounce {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            25% { transform: translateY(-10px) rotate(2deg); }
            50% { transform: translateY(-5px) rotate(0deg); }
            75% { transform: translateY(-15px) rotate(-2deg); }
        }

        @keyframes koalaWiggle {
            0%, 100% { transform: translateX(0) rotate(0deg); }
            25% { transform: translateX(-8px) rotate(-3deg); }
            50% { transform: translateX(8px) rotate(3deg); }
            75% { transform: translateX(-5px) rotate(-1deg); }
        }

        @keyframes koalaSpin {
            0% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(180deg) scale(1.1); }
            100% { transform: rotate(360deg) scale(1); }
        }

        /* Sparkling Puppy Dog Eyes */
        .koala-eyes {
            position: absolute;
            top: 20%;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            pointer-events: none;
        }

        .sparkle-eye {
            font-size: 20px;
            animation: sparkleEyes 2s infinite ease-in-out;
        }

        @keyframes sparkleEyes {
            0%, 100% { opacity: 0.8; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.3); }
        }

        .koala-status {
            position: absolute;
            top: -50px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255,255,255,0.9);
            color: #FF69B4;
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 10px;
            font-weight: bold;
            min-width: 100px;
            text-align: center;
            border: 2px solid #FFB6C1;
            box-shadow: 0 4px 12px rgba(255,182,193,0.4);
        }

        .koala-title {
            font-size: 11px;
            color: #FF1493;
            margin-top: 8px;
            font-weight: bold;
        }

        .love-progress {
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 5px;
            background: rgba(255,255,255,0.3);
            border-radius: 6px;
            overflow: hidden;
            border: 1px solid #FF69B4;
        }

        .love-fill {
            height: 100%;
            background: linear-gradient(90deg, #FF1493, #FF69B4);
            transition: width 0.5s ease;
            box-shadow: 0 0 8px rgba(255,20,147,0.5);
        }

        .love-text {
            position: absolute;
            bottom: -38px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 7px;
            color: #FF1493;
            font-weight: bold;
        }

        /* Cute Toy Box (Inventory) */
        .toy-box {
            position: absolute;
            top: 18%;
            left: 5px;
            width: 65px;
            background: rgba(255,255,255,0.9);
            border: 2px solid #FFB6C1;
            border-radius: 12px;
            padding: 4px;
            box-shadow: 0 4px 12px rgba(255,182,193,0.3);
        }

        .toy-box-title {
            font-size: 7px;
            color: #FF69B4;
            font-weight: bold;
            text-align: center;
            margin-bottom: 4px;
        }

        .toy-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 2px;
        }

        .toy-slot {
            width: 20px;
            height: 20px;
            background: rgba(255,182,193,0.3);
            border: 2px solid #FFB6C1;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .toy-slot:hover {
            background: rgba(255,182,193,0.6);
            border-color: #FF69B4;
            transform: scale(1.1);
        }

        .toy-slot.has-toy {
            background: linear-gradient(45deg, #FFB6C1, #FFE4E1);
            border-color: #FF69B4;
            box-shadow: 0 2px 6px rgba(255,105,180,0.3);
        }

        .toy-quantity {
            position: absolute;
            bottom: -1px;
            right: -1px;
            background: #FF1493;
            color: white;
            font-size: 5px;
            padding: 1px;
            border-radius: 3px;
            font-weight: bold;
        }

        /* Cute Activities */
        .activities-panel {
            position: absolute;
            bottom: 120px;
            left: 8px;
            right: 8px;
            display: flex;
            justify-content: center;
            gap: 4px;
        }

        .activity-button {
            width: 50px;
            height: 50px;
            background: rgba(255,255,255,0.9);
            border: 3px solid #FFB6C1;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            box-shadow: 0 4px 12px rgba(255,182,193,0.3);
        }

        .activity-button:hover {
            background: rgba(255,182,193,0.8);
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(255,105,180,0.4);
        }

        .activity-button.ready {
            background: linear-gradient(45deg, #98FB98, #90EE90);
            border-color: #32CD32;
            animation: activityReady 2s infinite ease-in-out;
        }

        @keyframes activityReady {
            0%, 100% { box-shadow: 0 4px 12px rgba(50,205,50,0.4); }
            50% { box-shadow: 0 6px 16px rgba(50,205,50,0.6); }
        }

        .activity-level {
            position: absolute;
            top: -2px;
            right: -2px;
            background: #FF1493;
            color: white;
            font-size: 6px;
            padding: 1px 2px;
            border-radius: 6px;
            font-weight: bold;
        }

        .activity-cooldown {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            border-radius: 10px;
            display: none;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 7px;
            font-weight: bold;
        }

        /* Cute Places */
        .cute-places {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 100px;
            background: linear-gradient(180deg, transparent 0%, rgba(255,182,193,0.9) 100%);
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 6px;
            border-top: 3px solid #FFB6C1;
        }

        .place-button {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 5px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            background: rgba(255,255,255,0.8);
            border: 3px solid #FFB6C1;
            min-width: 45px;
            position: relative;
            box-shadow: 0 2px 8px rgba(255,182,193,0.3);
        }

        .place-button:hover {
            background: rgba(255,182,193,0.8);
            border-color: #FF69B4;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255,105,180,0.4);
        }

        .place-button.available {
            border-color: #32CD32;
            background: rgba(152,251,152,0.8);
        }

        .place-icon {
            font-size: 28px;
            margin-bottom: 3px;
        }

        .place-label {
            font-size: 9px;
            font-weight: bold;
            color: #FF69B4;
            text-align: center;
        }

        .place-level {
            position: absolute;
            top: -2px;
            right: -2px;
            background: #FF1493;
            color: white;
            font-size: 5px;
            padding: 1px 2px;
            border-radius: 6px;
            font-weight: bold;
        }

        /* Cute Challenge Overlay */
        .challenge-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255,182,193,0.95);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .challenge-panel {
            background: linear-gradient(145deg, #FFE4E1, #FFB6C1);
            border: 3px solid #FF69B4;
            border-radius: 20px;
            padding: 15px;
            text-align: center;
            max-width: 300px;
            box-shadow: 0 15px 30px rgba(255,105,180,0.4);
            animation: challengeSlideIn 0.5s ease-out;
        }

        @keyframes challengeSlideIn {
            0% { opacity: 0; transform: scale(0.8) translateY(30px); }
            100% { opacity: 1; transform: scale(1) translateY(0); }
        }

        .challenge-title {
            color: #FF1493;
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
            text-shadow: 1px 1px 2px rgba(255,255,255,0.5);
        }

        .challenge-content {
            color: #8B008B;
            font-size: 12px;
            margin-bottom: 15px;
            line-height: 1.3;
        }

        .challenge-area {
            background: rgba(255,255,255,0.8);
            border-radius: 15px;
            padding: 10px;
            margin: 10px 0;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 2px solid #FFB6C1;
        }

        .challenge-visual {
            font-size: 36px;
            margin-bottom: 10px;
        }

        .challenge-question {
            color: #FF1493;
            font-size: 11px;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .answer-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px;
            margin: 10px 0;
        }

        .answer-button {
            background: linear-gradient(135deg, #98FB98, #90EE90);
            color: #006400;
            border: none;
            padding: 8px 10px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 3px 8px rgba(50,205,50,0.3);
            border: 2px solid #32CD32;
        }

        .answer-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(50,205,50,0.4);
        }

        .answer-button.correct {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #8B4513;
            border-color: #FF8C00;
        }

        .answer-button.incorrect {
            background: linear-gradient(135deg, #FFB6C1, #FFC0CB);
            color: #8B008B;
            border-color: #FF69B4;
        }

        /* Cute Effects */
        .floating-effect {
            position: absolute;
            font-size: 20px;
            font-weight: bold;
            pointer-events: none;
            animation: floatEffect 2s ease-out forwards;
            z-index: 1500;
        }

        .love-effect { color: #FF1493; }
        .happy-effect { color: #FFD700; }
        .cute-effect { color: #FF69B4; }
        .sparkle-effect { color: #98FB98; }

        @keyframes floatEffect {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-60px) scale(1.3);
            }
        }

        .heart-system {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: 50;
        }

        .floating-heart {
            position: absolute;
            pointer-events: none;
            animation: heartFloat 3s infinite ease-in-out;
            color: #FF69B4;
            font-size: 18px;
        }

        /* Daily Challenge Panel */
        .daily-challenge-panel {
            background: rgba(255,255,255,0.95);
            border: 3px solid #FFB6C1;
            border-radius: 15px;
            padding: 8px;
            margin: 5px 0;
            box-shadow: 0 4px 12px rgba(255,182,193,0.4);
        }

        .daily-challenge-header {
            font-size: 10px;
            font-weight: bold;
            color: #FF1493;
            text-align: center;
            margin-bottom: 4px;
        }

        .daily-challenge-name {
            font-size: 8px;
            font-weight: bold;
            color: #FF69B4;
            text-align: center;
        }

        .daily-challenge-desc {
            font-size: 6px;
            color: #FF1493;
            text-align: center;
            margin: 2px 0;
        }

        .daily-challenge-progress {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 6px;
        }

        .progress-bar {
            flex: 1;
            height: 8px;
            background: rgba(255,182,193,0.3);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #FFB6C1, #FF69B4);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        /* Collections Panel */
        .collections-panel {
            background: rgba(255,255,255,0.9);
            border: 2px solid #FFB6C1;
            border-radius: 12px;
            padding: 6px;
            margin: 5px 0;
        }

        .collections-header {
            font-size: 8px;
            font-weight: bold;
            color: #FF1493;
            text-align: center;
            margin-bottom: 4px;
        }

        .collections-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4px;
        }

        .collection-item {
            display: flex;
            align-items: center;
            gap: 3px;
            padding: 3px;
            background: rgba(255,182,193,0.2);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid #FFB6C1;
        }

        .collection-item:hover {
            background: rgba(255,182,193,0.4);
            transform: scale(1.05);
        }

        .collection-emoji {
            font-size: 12px;
        }

        .collection-count {
            font-size: 6px;
            font-weight: bold;
            color: #FF69B4;
        }

        /* Achievement Notification */
        .achievement-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(45deg, #FFD700, #FFA500);
            border: 3px solid #FF8C00;
            border-radius: 15px;
            padding: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 6px 20px rgba(255,140,0,0.4);
            animation: achievementSlideIn 0.5s ease-out;
            z-index: 2000;
            max-width: 250px;
        }

        .achievement-icon {
            font-size: 24px;
            animation: achievementBounce 1s infinite;
        }

        .achievement-title {
            font-size: 12px;
            font-weight: bold;
            color: #8B4513;
        }

        .achievement-desc {
            font-size: 10px;
            color: #A0522D;
        }

        @keyframes achievementSlideIn {
            0% { transform: translateX(100%); opacity: 0; }
            100% { transform: translateX(0); opacity: 1; }
        }

        @keyframes achievementBounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        /* Pet Care Panel */
        .pet-care-panel {
            background: rgba(255,255,255,0.9);
            border: 2px solid #FFB6C1;
            border-radius: 12px;
            padding: 6px;
            margin: 5px 0;
        }

        .pet-care-header {
            font-size: 8px;
            font-weight: bold;
            color: #FF1493;
            text-align: center;
            margin-bottom: 4px;
        }

        .care-stats {
            display: flex;
            gap: 4px;
        }

        .care-stat {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s;
            padding: 2px;
            border-radius: 6px;
        }

        .care-stat:hover {
            background: rgba(255,182,193,0.3);
            transform: scale(1.05);
        }

        .care-emoji {
            font-size: 12px;
            margin-bottom: 2px;
        }

        .care-bar {
            width: 100%;
            height: 6px;
            background: rgba(255,182,193,0.3);
            border-radius: 3px;
            overflow: hidden;
        }

        .care-fill {
            height: 100%;
            background: linear-gradient(90deg, #98FB98, #90EE90);
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        /* Weather Panel */
        .weather-panel {
            background: rgba(255,255,255,0.8);
            border: 2px solid #87CEEB;
            border-radius: 10px;
            padding: 4px;
            margin: 3px 0;
            text-align: center;
        }

        .weather-display {
            font-size: 8px;
            font-weight: bold;
            color: #4682B4;
        }

        .weather-effect {
            font-size: 6px;
            color: #708090;
        }

        /* Story Panel */
        .story-panel {
            background: rgba(255,255,255,0.9);
            border: 2px solid #DDA0DD;
            border-radius: 12px;
            padding: 6px;
            margin: 5px 0;
        }

        .story-header {
            font-size: 8px;
            font-weight: bold;
            color: #8B008B;
            text-align: center;
            margin-bottom: 4px;
        }

        .story-info {
            font-size: 6px;
            color: #9370DB;
            margin-bottom: 3px;
        }

        .story-progress {
            height: 6px;
            background: rgba(221,160,221,0.3);
            border-radius: 3px;
            overflow: hidden;
            margin: 2px 0;
        }

        .active-quest {
            font-size: 6px;
            color: #8B008B;
            display: flex;
            justify-content: space-between;
            background: rgba(221,160,221,0.2);
            padding: 2px 4px;
            border-radius: 6px;
        }

        /* Special Buttons */
        .special-buttons {
            display: flex;
            gap: 4px;
            margin: 5px 0;
            justify-content: center;
        }

        .special-button {
            width: 35px;
            height: 35px;
            background: linear-gradient(45deg, #FFE4E1, #FFF0F5);
            border: 2px solid #FF69B4;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 3px 10px rgba(255,105,180,0.3);
        }

        .special-button:hover {
            background: linear-gradient(45deg, #FFB6C1, #FFC0CB);
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(255,105,180,0.5);
        }

        /* Customization Panel */
        .customization-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(45deg, #FFE4E1, #FFF0F5);
            border: 3px solid #FF69B4;
            border-radius: 20px;
            padding: 15px;
            z-index: 3000;
            max-width: 300px;
            box-shadow: 0 10px 30px rgba(255,105,180,0.4);
        }

        .customization-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            font-size: 14px;
            font-weight: bold;
            color: #FF1493;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 16px;
            cursor: pointer;
            padding: 0;
        }

        .customization-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
        }

        .tab-btn {
            flex: 1;
            padding: 5px;
            background: rgba(255,182,193,0.3);
            border: 1px solid #FFB6C1;
            border-radius: 8px;
            font-size: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tab-btn.active {
            background: #FFB6C1;
            color: white;
        }

        .customization-items {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            max-height: 150px;
            overflow-y: auto;
        }

        .customization-item {
            width: 40px;
            height: 40px;
            background: rgba(255,255,255,0.8);
            border: 2px solid #FFB6C1;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .customization-item:hover {
            background: #FFB6C1;
            transform: scale(1.1);
        }

        .customization-item.selected {
            background: #FF69B4;
            border-color: #FF1493;
        }

        /* Friends Panel */
        .friends-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(45deg, #E6E6FA, #F0F8FF);
            border: 3px solid #9370DB;
            border-radius: 20px;
            padding: 15px;
            z-index: 3000;
            max-width: 280px;
            box-shadow: 0 10px 30px rgba(147,112,219,0.4);
        }

        .friends-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            font-size: 14px;
            font-weight: bold;
            color: #8B008B;
        }

        .friends-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .friend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            background: rgba(255,255,255,0.8);
            border: 2px solid #DDA0DD;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .friend-item:hover {
            background: rgba(221,160,221,0.3);
            transform: scale(1.02);
        }

        .friend-emoji {
            font-size: 24px;
        }

        .friend-info {
            flex: 1;
        }

        .friend-name {
            font-size: 10px;
            font-weight: bold;
            color: #8B008B;
        }

        .friend-friendship {
            font-size: 8px;
            color: #9370DB;
        }

        /* Photo Mode */
        .photo-mode {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(45deg, #FFF8DC, #FFFACD);
            border: 3px solid #DAA520;
            border-radius: 20px;
            padding: 15px;
            z-index: 3000;
            max-width: 320px;
            box-shadow: 0 10px 30px rgba(218,165,32,0.4);
        }

        .photo-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            font-size: 14px;
            font-weight: bold;
            color: #B8860B;
        }

        .photo-controls {
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
        }

        .photo-btn {
            flex: 1;
            padding: 6px;
            background: rgba(218,165,32,0.3);
            border: 1px solid #DAA520;
            border-radius: 8px;
            font-size: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .photo-btn:hover {
            background: #DAA520;
            color: white;
        }

        .photo-preview {
            width: 200px;
            height: 150px;
            background: linear-gradient(45deg, #87CEEB, #E0F6FF);
            border: 2px solid #4682B4;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
            position: relative;
            overflow: hidden;
        }

        .photo-koko {
            font-size: 60px;
            animation: photoKokoPose 2s infinite ease-in-out;
        }

        @keyframes photoKokoPose {
            0%, 100% { transform: rotate(-5deg) scale(1); }
            50% { transform: rotate(5deg) scale(1.1); }
        }

        /* Quest System */
        .quest-title {
            font-size: 7px;
            font-weight: bold;
            color: #8B008B;
            margin-bottom: 3px;
        }

        .quest-tasks {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .quest-task {
            font-size: 5px;
            color: #9370DB;
            display: flex;
            justify-content: space-between;
            padding: 1px 3px;
            background: rgba(221,160,221,0.1);
            border-radius: 4px;
        }

        .quest-task.completed {
            background: rgba(144,238,144,0.3);
            color: #228B22;
        }

        /* Skill Trees Panel */
        .skill-trees-panel {
            background: rgba(255,255,255,0.9);
            border: 2px solid #9370DB;
            border-radius: 12px;
            padding: 6px;
            margin: 5px 0;
        }

        .skill-trees-header {
            font-size: 8px;
            font-weight: bold;
            color: #8B008B;
            text-align: center;
            margin-bottom: 4px;
        }

        .skill-categories {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4px;
        }

        .skill-category {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 4px;
            background: rgba(147,112,219,0.2);
            border: 1px solid #9370DB;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .skill-category:hover {
            background: rgba(147,112,219,0.4);
            transform: scale(1.05);
        }

        .skill-emoji {
            font-size: 14px;
            margin-bottom: 2px;
        }

        .skill-level {
            font-size: 6px;
            font-weight: bold;
            color: #8B008B;
        }

        /* Koko's Thoughts Panel */
        .koko-thoughts-panel {
            background: rgba(255,255,255,0.9);
            border: 2px solid #FFB6C1;
            border-radius: 12px;
            padding: 6px;
            margin: 5px 0;
        }

        .thoughts-header {
            font-size: 8px;
            font-weight: bold;
            color: #FF1493;
            text-align: center;
            margin-bottom: 4px;
        }

        .koko-thought {
            font-size: 6px;
            color: #FF69B4;
            text-align: center;
            font-style: italic;
            margin-bottom: 3px;
            min-height: 12px;
        }

        .mood-indicator {
            font-size: 6px;
            color: #FF1493;
            text-align: center;
            font-weight: bold;
        }

        /* Seasonal Events Panel */
        .seasonal-event-panel {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            border: 3px solid #FF8C00;
            border-radius: 15px;
            padding: 8px;
            margin: 5px 0;
            box-shadow: 0 4px 12px rgba(255,140,0,0.4);
            animation: seasonalGlow 2s infinite ease-in-out;
        }

        .seasonal-header {
            font-size: 10px;
            font-weight: bold;
            color: #8B4513;
            text-align: center;
            margin-bottom: 4px;
        }

        .seasonal-name {
            font-size: 8px;
            font-weight: bold;
            color: #A0522D;
            text-align: center;
        }

        .seasonal-desc {
            font-size: 6px;
            color: #8B4513;
            text-align: center;
            margin: 2px 0;
        }

        .seasonal-timer {
            font-size: 6px;
            color: #A0522D;
            text-align: center;
            font-weight: bold;
        }

        @keyframes seasonalGlow {
            0%, 100% { box-shadow: 0 4px 12px rgba(255,140,0,0.4); }
            50% { box-shadow: 0 6px 20px rgba(255,140,0,0.8); }
        }

        /* Skill Tree Modal */
        .skill-tree-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(45deg, #E6E6FA, #F0F8FF);
            border: 3px solid #9370DB;
            border-radius: 20px;
            padding: 15px;
            z-index: 3000;
            max-width: 350px;
            max-height: 400px;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(147,112,219,0.4);
        }

        .skill-tree-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            font-size: 14px;
            font-weight: bold;
            color: #8B008B;
        }

        .skill-points-display {
            font-size: 12px;
            color: #9370DB;
            text-align: center;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .skill-tree-content {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .skill-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            background: rgba(255,255,255,0.8);
            border: 2px solid #DDA0DD;
            border-radius: 12px;
            transition: all 0.3s;
        }

        .skill-item.unlocked {
            background: rgba(144,238,144,0.3);
            border-color: #90EE90;
        }

        .skill-item.affordable {
            background: rgba(255,255,0,0.2);
            border-color: #FFD700;
            cursor: pointer;
        }

        .skill-item.affordable:hover {
            background: rgba(255,255,0,0.4);
            transform: scale(1.02);
        }

        .skill-info {
            flex: 1;
        }

        .skill-name {
            font-size: 10px;
            font-weight: bold;
            color: #8B008B;
        }

        .skill-cost {
            font-size: 8px;
            color: #9370DB;
        }

        .skill-unlock-btn {
            padding: 4px 8px;
            background: #9370DB;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .skill-unlock-btn:hover {
            background: #8B008B;
            transform: scale(1.05);
        }

        /* Interactive Objects Modal */
        .interactive-objects-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(45deg, #F0F8FF, #E0F6FF);
            border: 3px solid #4682B4;
            border-radius: 20px;
            padding: 15px;
            z-index: 3000;
            max-width: 300px;
            box-shadow: 0 10px 30px rgba(70,130,180,0.4);
        }

        .interactive-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            font-size: 14px;
            font-weight: bold;
            color: #4682B4;
        }

        .interactive-objects-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .interactive-object {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            background: rgba(255,255,255,0.8);
            border: 2px solid #87CEEB;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .interactive-object:hover {
            background: rgba(135,206,235,0.3);
            transform: scale(1.02);
        }

        .interactive-object.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .object-emoji {
            font-size: 24px;
        }

        .object-info {
            flex: 1;
        }

        .object-name {
            font-size: 10px;
            font-weight: bold;
            color: #4682B4;
        }

        .object-clicks {
            font-size: 8px;
            color: #708090;
        }

        /* Advanced Feature Buttons */
        .advanced-buttons {
            display: flex;
            gap: 4px;
            margin: 5px 0;
            justify-content: center;
        }

        .advanced-button {
            width: 35px;
            height: 35px;
            background: linear-gradient(45deg, #E6E6FA, #F0F8FF);
            border: 2px solid #9370DB;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 3px 10px rgba(147,112,219,0.3);
        }

        .advanced-button:hover {
            background: linear-gradient(45deg, #DDA0DD, #E6E6FA);
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(147,112,219,0.5);
        }

        /* Advanced Mini-Games Modal */
        .advanced-mini-games-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(45deg, #F0F8FF, #E0F6FF);
            border: 3px solid #4169E1;
            border-radius: 20px;
            padding: 15px;
            z-index: 3000;
            max-width: 400px;
            max-height: 500px;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(65,105,225,0.4);
        }

        .advanced-games-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            font-size: 14px;
            font-weight: bold;
            color: #4169E1;
        }

        .advanced-games-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .advanced-game-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: rgba(255,255,255,0.9);
            border: 2px solid #87CEEB;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .advanced-game-item:hover {
            background: rgba(135,206,235,0.3);
            transform: scale(1.02);
        }

        .game-info {
            flex: 1;
        }

        .game-title {
            font-size: 12px;
            font-weight: bold;
            color: #4169E1;
        }

        .game-description {
            font-size: 9px;
            color: #6495ED;
        }

        .game-stats {
            font-size: 8px;
            color: #708090;
        }

        .game-play-btn {
            padding: 6px 12px;
            background: #4169E1;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 9px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .game-play-btn:hover {
            background: #0000CD;
            transform: scale(1.05);
        }

        /* Learning Analytics Modal */
        .learning-analytics-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(45deg, #FFF8DC, #FFFACD);
            border: 3px solid #DAA520;
            border-radius: 20px;
            padding: 15px;
            z-index: 3000;
            max-width: 450px;
            max-height: 600px;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(218,165,32,0.4);
        }

        .analytics-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            font-size: 14px;
            font-weight: bold;
            color: #B8860B;
        }

        .analytics-content {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .analytics-section {
            background: rgba(255,255,255,0.8);
            border: 2px solid #F0E68C;
            border-radius: 12px;
            padding: 10px;
        }

        .analytics-title {
            font-size: 11px;
            font-weight: bold;
            color: #B8860B;
            margin-bottom: 6px;
        }

        .analytics-stat {
            display: flex;
            justify-content: space-between;
            font-size: 9px;
            color: #DAA520;
            margin: 3px 0;
        }

        .progress-chart {
            width: 100%;
            height: 8px;
            background: rgba(218,165,32,0.3);
            border-radius: 4px;
            overflow: hidden;
            margin: 4px 0;
        }

        .progress-fill-analytics {
            height: 100%;
            background: linear-gradient(90deg, #DAA520, #FFD700);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        /* Music System Modal */
        .music-system-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(45deg, #E6E6FA, #F8F8FF);
            border: 3px solid #8A2BE2;
            border-radius: 20px;
            padding: 15px;
            z-index: 3000;
            max-width: 350px;
            box-shadow: 0 10px 30px rgba(138,43,226,0.4);
        }

        .music-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            font-size: 14px;
            font-weight: bold;
            color: #8A2BE2;
        }

        .music-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .music-track {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            background: rgba(255,255,255,0.8);
            border: 2px solid #DDA0DD;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .music-track:hover {
            background: rgba(221,160,221,0.3);
        }

        .music-track.playing {
            background: rgba(138,43,226,0.2);
            border-color: #8A2BE2;
        }

        .track-info {
            flex: 1;
        }

        .track-name {
            font-size: 10px;
            font-weight: bold;
            color: #8A2BE2;
        }

        .track-mood {
            font-size: 8px;
            color: #9370DB;
        }

        .volume-control {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 10px;
        }

        .volume-slider {
            flex: 1;
            height: 6px;
            background: rgba(138,43,226,0.3);
            border-radius: 3px;
            cursor: pointer;
        }

        /* Story Choices Modal */
        .story-choices-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(45deg, #FFF0F5, #FFE4E1);
            border: 3px solid #DC143C;
            border-radius: 20px;
            padding: 15px;
            z-index: 3000;
            max-width: 400px;
            max-height: 500px;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(220,20,60,0.4);
        }

        .story-choices-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            font-size: 14px;
            font-weight: bold;
            color: #DC143C;
        }

        .story-choices-content {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .story-scenario {
            background: rgba(255,255,255,0.9);
            border: 2px solid #FFB6C1;
            border-radius: 12px;
            padding: 12px;
        }

        .scenario-text {
            font-size: 10px;
            color: #DC143C;
            margin-bottom: 10px;
            line-height: 1.4;
        }

        .choice-buttons {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .choice-btn {
            padding: 8px;
            background: rgba(255,182,193,0.3);
            border: 1px solid #FFB6C1;
            border-radius: 8px;
            font-size: 9px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
        }

        .choice-btn:hover {
            background: rgba(255,182,193,0.6);
            transform: scale(1.02);
        }

        /* Enhanced Parental Modal */
        .enhanced-parental-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(45deg, #F5F5DC, #FFF8DC);
            border: 3px solid #8B4513;
            border-radius: 20px;
            padding: 15px;
            z-index: 3000;
            max-width: 500px;
            max-height: 600px;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(139,69,19,0.4);
        }

        .enhanced-parental-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            font-size: 14px;
            font-weight: bold;
            color: #8B4513;
        }

        .enhanced-parental-content {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .parental-section {
            background: rgba(255,255,255,0.9);
            border: 2px solid #DEB887;
            border-radius: 12px;
            padding: 12px;
        }

        .parental-title {
            font-size: 12px;
            font-weight: bold;
            color: #8B4513;
            margin-bottom: 8px;
        }

        .parental-stat {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            color: #A0522D;
            margin: 4px 0;
        }

        .time-limit-control {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 6px 0;
        }

        .time-input {
            width: 60px;
            padding: 4px;
            border: 1px solid #DEB887;
            border-radius: 4px;
            font-size: 9px;
        }

        /* Time-Based Event Notification */
        .time-based-event-notification {
            position: fixed;
            top: 80px;
            right: 20px;
            background: linear-gradient(45deg, #FF6347, #FF4500);
            border: 3px solid #DC143C;
            border-radius: 15px;
            padding: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 6px 20px rgba(220,20,60,0.4);
            animation: timeEventSlideIn 0.5s ease-out;
            z-index: 2000;
            max-width: 250px;
        }

        .time-event-icon {
            font-size: 24px;
            animation: timeEventPulse 1s infinite;
        }

        .time-event-title {
            font-size: 12px;
            font-weight: bold;
            color: white;
        }

        .time-event-desc {
            font-size: 10px;
            color: #FFE4E1;
        }

        @keyframes timeEventSlideIn {
            0% { transform: translateX(100%); opacity: 0; }
            100% { transform: translateX(0); opacity: 1; }
        }

        @keyframes timeEventPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        /* Game World and Movement System */
        .game-world {
            position: relative;
            width: 100%;
            height: 450px;
            background: linear-gradient(45deg, #87CEEB, #E0F6FF);
            border: 3px solid #4682B4;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(70,130,180,0.4);
            margin-bottom: 10px;
        }

        .location-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            transition: all 0.5s ease;
        }

        .location-objects {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .location-npcs {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .world-object {
            position: absolute;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            pointer-events: all;
            z-index: 10;
        }

        .world-object:hover {
            transform: scale(1.2);
            filter: drop-shadow(0 0 10px rgba(255,255,0,0.8));
        }

        .world-npc {
            position: absolute;
            font-size: 28px;
            cursor: pointer;
            transition: all 0.3s ease;
            pointer-events: all;
            z-index: 15;
            animation: npcFloat 3s infinite ease-in-out;
        }

        .world-npc:hover {
            transform: scale(1.3);
            filter: drop-shadow(0 0 15px rgba(255,182,193,0.8));
        }

        @keyframes npcFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
        }

        .moveable {
            position: absolute;
            transition: all 0.2s ease;
            z-index: 20;
        }

        .koala-container.moveable {
            left: 250px;
            top: 200px;
        }

        .location-exits {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .location-exit {
            position: absolute;
            width: 60px;
            height: 60px;
            background: rgba(255,255,255,0.8);
            border: 3px solid #FFD700;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            pointer-events: all;
            z-index: 25;
            animation: exitPulse 2s infinite ease-in-out;
        }

        .location-exit:hover {
            background: rgba(255,215,0,0.9);
            transform: scale(1.2);
            box-shadow: 0 0 20px rgba(255,215,0,0.8);
        }

        @keyframes exitPulse {
            0%, 100% { box-shadow: 0 0 10px rgba(255,215,0,0.5); }
            50% { box-shadow: 0 0 25px rgba(255,215,0,0.9); }
        }

        /* Movement Controls */
        .movement-controls {
            background: rgba(255,255,255,0.9);
            border: 2px solid #4682B4;
            border-radius: 15px;
            padding: 10px;
            margin: 10px auto;
            max-width: 300px;
            text-align: center;
        }

        .movement-instructions {
            font-size: 10px;
            color: #4682B4;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .movement-buttons {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .move-row {
            display: flex;
            gap: 5px;
        }

        .move-btn {
            width: 40px;
            height: 40px;
            background: linear-gradient(45deg, #87CEEB, #B0E0E6);
            border: 2px solid #4682B4;
            border-radius: 10px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.2s ease;
            user-select: none;
        }

        .move-btn:hover {
            background: linear-gradient(45deg, #4682B4, #5F9EA0);
            transform: scale(1.1);
        }

        .move-btn:active {
            background: linear-gradient(45deg, #2F4F4F, #4682B4);
            transform: scale(0.95);
        }

        /* Mini Map */
        .mini-map {
            background: rgba(255,255,255,0.9);
            border: 2px solid #8B4513;
            border-radius: 12px;
            padding: 8px;
            margin: 10px auto;
            max-width: 250px;
        }

        .mini-map-header {
            font-size: 10px;
            font-weight: bold;
            color: #8B4513;
            text-align: center;
            margin-bottom: 6px;
        }

        .mini-map-content {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 4px;
            margin-bottom: 6px;
        }

        .map-location {
            width: 30px;
            height: 30px;
            background: rgba(139,69,19,0.2);
            border: 1px solid #8B4513;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .map-location.current {
            background: rgba(255,215,0,0.8);
            border-color: #FFD700;
            box-shadow: 0 0 10px rgba(255,215,0,0.6);
        }

        .map-location.unlocked {
            background: rgba(144,238,144,0.6);
            border-color: #90EE90;
        }

        .map-location.locked {
            background: rgba(128,128,128,0.4);
            border-color: #808080;
            cursor: not-allowed;
            opacity: 0.5;
        }

        .map-location:hover:not(.locked) {
            transform: scale(1.1);
            background: rgba(255,215,0,0.6);
        }

        .current-location {
            font-size: 8px;
            color: #8B4513;
            text-align: center;
            font-weight: bold;
        }

        /* Movement Animations */
        @keyframes walkUp {
            0%, 100% { transform: translateY(0px) rotate(-2deg); }
            50% { transform: translateY(-2px) rotate(2deg); }
        }

        @keyframes walkDown {
            0%, 100% { transform: translateY(0px) rotate(2deg); }
            50% { transform: translateY(2px) rotate(-2deg); }
        }

        @keyframes walkLeft {
            0%, 100% { transform: translateX(0px) rotate(-5deg); }
            50% { transform: translateX(-2px) rotate(5deg); }
        }

        @keyframes walkRight {
            0%, 100% { transform: translateX(0px) rotate(5deg); }
            50% { transform: translateX(2px) rotate(-5deg); }
        }

        .moving-up { animation: walkUp 0.3s infinite; }
        .moving-down { animation: walkDown 0.3s infinite; }
        .moving-left { animation: walkLeft 0.3s infinite; }
        .moving-right { animation: walkRight 0.3s infinite; }

        /* Location Backgrounds */
        .bg-home {
            background: linear-gradient(45deg, #FFF8DC, #FFFACD);
        }

        .bg-playground {
            background: linear-gradient(45deg, #98FB98, #90EE90);
        }

        .bg-garden {
            background: linear-gradient(45deg, #FFB6C1, #FFC0CB);
        }

        .bg-library {
            background: linear-gradient(45deg, #DDA0DD, #E6E6FA);
        }

        .bg-park {
            background: linear-gradient(45deg, #228B22, #32CD32);
        }

        .bg-school {
            background: linear-gradient(45deg, #F0E68C, #FFFFE0);
        }

        @keyframes heartFloat {
            0%, 100% { transform: translateY(0) rotate(0deg); opacity: 0.7; }
            50% { transform: translateY(-15px) rotate(15deg); opacity: 1; }
        }

        /* Achievement System */
        .achievement-popup {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: #8B4513;
            padding: 12px 20px;
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(255,215,0,0.4);
            font-size: 12px;
            font-weight: bold;
            z-index: 2000;
            opacity: 0;
            animation: achievementPop 4s ease-out;
            border: 3px solid #FF8C00;
        }

        @keyframes achievementPop {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
            20%, 80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
        }

        /* Parent Button */
        .parent-btn {
            position: absolute;
            top: 45px;
            right: 8px;
            width: 20px;
            height: 20px;
            background: rgba(255,255,255,0.9);
            border: 2px solid #FFB6C1;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            cursor: pointer;
            transition: all 0.3s;
            color: #FF69B4;
            box-shadow: 0 2px 8px rgba(255,182,193,0.3);
        }

        .parent-btn:hover {
            background: rgba(255,182,193,0.8);
            transform: scale(1.1);
        }
    </style>
</head>
<body>
    <!-- Game Header -->
    <div class="game-header">
        <div class="header-left">
            <div class="player-info">
                <div class="player-avatar" id="playerAvatar" onclick="showKoalaMenu()">üê®</div>
                <div class="player-details">
                    <div class="player-name" id="playerName">Koko</div>
                    <div class="player-level" id="playerLevel">Level 8</div>
                </div>
            </div>
        </div>
        <div class="header-center">
            <div class="game-title">üê® Koko's Adventure World üåü</div>
        </div>
        <div class="header-right">
            <div class="resource-display">
                <span id="stickerCount">1250</span> üéÅ
                <span id="heartCount">670</span> üíï
                <span id="xpCount">2840</span> ‚≠ê
            </div>
        </div>
    </div>

    <!-- Left Panel -->
    <div class="left-panel">
        <div class="panel-toggle" onclick="togglePanel('left')" id="leftToggle">‚àí</div>
        <div class="panel-content" id="leftContent">
            <!-- Stats and Progress -->
            <div class="panel-title">üìä Koko's Stats</div>
            <div class="stats-display">
                <div class="stat-item">
                    <span>Happiness:</span>
                    <div class="stat-bar">
                        <div class="stat-fill" id="happinessFill" style="width: 85%"></div>
                    </div>
                    <span id="happinessValue">85/100</span>
                </div>
                <div class="stat-item">
                    <span>Health:</span>
                    <div class="stat-bar">
                        <div class="stat-fill" id="healthFill" style="width: 92%"></div>
                    </div>
                    <span id="healthValue">92/100</span>
                </div>
                <div class="stat-item">
                    <span>Energy:</span>
                    <div class="stat-bar">
                        <div class="stat-fill" id="energyFill" style="width: 78%"></div>
                    </div>
                    <span id="energyValue">78/100</span>
                </div>
                <div class="stat-item">
                    <span>Love:</span>
                    <div class="stat-bar">
                        <div class="stat-fill" id="loveFill" style="width: 67%"></div>
                    </div>
                    <span id="loveValue">67/100</span>
                </div>
            </div>

            <!-- Quest Progress -->
            <div class="panel-title">üìñ Current Quest</div>
            <div id="activeQuest" class="active-quest">
                <div id="questTitle" class="quest-title">Welcome to Eucalyptus Grove!</div>
                <div id="questTasks" class="quest-tasks">
                    <!-- Tasks will be populated by JavaScript -->
                </div>
            </div>

            <!-- Skill Trees -->
            <div class="panel-title">üåü Skills</div>
            <div class="skill-categories">
                <div class="skill-category" onclick="showSkillTree('learning')">
                    <span class="skill-emoji">üß†</span>
                    <span id="learningLevel" class="skill-level">Lv.1</span>
                </div>
                <div class="skill-category" onclick="showSkillTree('creativity')">
                    <span class="skill-emoji">üé®</span>
                    <span id="creativityLevel" class="skill-level">Lv.1</span>
                </div>
                <div class="skill-category" onclick="showSkillTree('friendship')">
                    <span class="skill-emoji">üíï</span>
                    <span id="friendshipLevel" class="skill-level">Lv.1</span>
                </div>
                <div class="skill-category" onclick="showSkillTree('exploration')">
                    <span class="skill-emoji">üó∫Ô∏è</span>
                    <span id="explorationLevel" class="skill-level">Lv.1</span>
                </div>
            </div>

            <!-- Story Mode -->
            <div class="panel-title">üìñ Story Adventures</div>
            <div class="story-mode-panel">
                <div class="current-chapter">
                    <div class="chapter-info">
                        <span id="currentChapterEmoji">üå≥</span>
                        <div class="chapter-details">
                            <div id="currentChapterTitle" class="chapter-title">Welcome to Eucalyptus Grove</div>
                            <div id="currentChapterProgress" class="chapter-progress">Scene 1/3</div>
                        </div>
                    </div>
                    <button class="story-btn" onclick="openStoryMode()">üìö Continue</button>
                </div>
                <div class="story-stats">
                    <div class="story-stat">
                        <span>Chapters:</span>
                        <span id="chaptersCompleted">0/3</span>
                    </div>
                    <div class="story-stat">
                        <span>Scenes:</span>
                        <span id="scenesCompleted">0/9</span>
                    </div>
                </div>
            </div>

            <!-- Achievements -->
            <div class="panel-title">üèÜ Achievements</div>
            <div class="achievements-panel">
                <div class="achievement-summary">
                    <div class="achievement-count">
                        <span id="achievementsUnlocked">0</span>/<span id="totalAchievements">25</span>
                    </div>
                    <button class="achievements-btn" onclick="openAchievements()">üèÜ View All</button>
                </div>
                <div class="recent-achievements">
                    <div class="recent-title">Recent:</div>
                    <div id="recentAchievementsList" class="recent-list">
                        <div class="no-achievements">Complete activities to earn achievements!</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Game World Container -->
    <div class="game-world-container">
        <!-- Game World -->
        <div id="gameWorld" class="game-world">
            <!-- Current Location Background -->
            <div id="locationBackground" class="location-background"></div>
            
            <!-- Interactive Objects in Current Location -->
            <div id="locationObjects" class="location-objects"></div>
            
            <!-- NPCs in Current Location -->
            <div id="locationNPCs" class="location-npcs"></div>
            
            <!-- Cute Koala Character (Moveable) -->
            <div class="koala-container moveable" id="koalaContainer">
                <div class="koala-status" id="koalaStatus">Koko is exploring! üåà</div>
                <div class="cute-koala" id="cuteKoala" onclick="interactWithKoko()">üê®</div>
                <div class="koala-eyes">
                    <div class="sparkle-eye">‚ú®</div>
                    <div class="sparkle-eye">‚ú®</div>
                </div>
                <div class="koala-title" id="koalaTitle">Koko the Super Cute Koala ‚Ä¢ Level 8</div>
                <div class="love-progress">
                    <div class="love-fill" id="loveFillBar" style="width: 67%"></div>
                </div>
                <div class="love-text" id="loveText">Love: 670 / 1000 üíï</div>
            </div>
            
            <!-- Location Exits/Portals -->
            <div id="locationExits" class="location-exits"></div>
        </div>
        
        <!-- Movement Controls -->
        <div class="movement-controls">
            <div class="movement-instructions">
                <span>üéÆ Use WASD or Arrow Keys to move Koko around!</span>
            </div>
            <div class="movement-buttons">
                <button class="move-btn" onmousedown="startMoving('up')" onmouseup="stopMoving('up')">‚¨ÜÔ∏è</button>
                <div class="move-row">
                    <button class="move-btn" onmousedown="startMoving('left')" onmouseup="stopMoving('left')">‚¨ÖÔ∏è</button>
                    <button class="move-btn" onmousedown="startMoving('down')" onmouseup="stopMoving('down')">‚¨áÔ∏è</button>
                    <button class="move-btn" onmousedown="startMoving('right')" onmouseup="stopMoving('right')">‚û°Ô∏è</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Right Panel -->
    <div class="right-panel">
        <div class="panel-toggle" onclick="togglePanel('right')" id="rightToggle">‚àí</div>
        <div class="panel-content" id="rightContent">
            <!-- Mini Map -->
            <div class="panel-title">üó∫Ô∏è World Map</div>
            <div class="mini-map">
                <div id="miniMapContent" class="mini-map-content">
                    <!-- Map will be populated by JavaScript -->
                </div>
                <div class="current-location">
                    üìç <span id="currentLocationName">Cozy Home</span>
                </div>
            </div>

            <!-- Koko's Thoughts -->
            <div class="panel-title">üí≠ Koko's Thoughts</div>
            <div class="koko-thoughts-panel">
                <div id="kokoThought" class="koko-thought">I wonder what we'll discover today!</div>
                <div id="kokoMoodIndicator" class="mood-indicator">üòä Happy & Playful</div>
            </div>

            <!-- Weather System -->
            <div class="panel-title">üå§Ô∏è Weather</div>
            <div class="weather-panel">
                <div class="weather-display">
                    <div id="weatherIcon" class="weather-icon">‚òÄÔ∏è</div>
                    <div id="weatherText" class="weather-text">Sunny Day</div>
                    <div id="weatherTemp" class="weather-temp">22¬∞C</div>
                </div>
                <div id="weatherEffect" class="weather-effect"></div>
            </div>

            <!-- Critter Collection -->
            <div class="panel-title">üêæ My Critters</div>
            <div class="critter-collection">
                <div class="collection-header">
                    <span id="critterCount">1/12</span>
                    <button class="collection-btn" onclick="openCritterCollection()">üìã View All</button>
                </div>
                <div class="active-critter-display">
                    <div class="critter-avatar" id="activeCritterAvatar">üê®</div>
                    <div class="critter-info">
                        <div class="critter-name" id="activeCritterName">Koko</div>
                        <div class="critter-level" id="activeCritterLevel">Level 8 Adult</div>
                        <div class="critter-specialization" id="activeCritterSpec">Explorer</div>
                    </div>
                    <button class="switch-critter-btn" onclick="openCritterSwitcher()">üîÑ</button>
                </div>
                <div class="critter-growth-display">
                    <div class="growth-title">Growth Progress</div>
                    <div class="growth-bars">
                        <div class="growth-item">
                            <span>üìö</span>
                            <div class="growth-bar">
                                <div class="growth-fill" id="mathGrowth" style="width: 45%"></div>
                            </div>
                        </div>
                        <div class="growth-item">
                            <span>üî¨</span>
                            <div class="growth-bar">
                                <div class="growth-fill" id="scienceGrowth" style="width: 30%"></div>
                            </div>
                        </div>
                        <div class="growth-item">
                            <span>üé®</span>
                            <div class="growth-bar">
                                <div class="growth-fill" id="creativityGrowth" style="width: 40%"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="unlock-progress">
                    <div class="unlock-title">Next Critter</div>
                    <div id="nextCritterInfo" class="next-critter">
                        <span>üê∞ Bella - Complete friendship quest</span>
                        <div class="unlock-bar">
                            <div class="unlock-fill" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom Panel -->
    <div class="bottom-panel">
        <!-- Activity Buttons -->
        <div class="activity-section">
            <div class="panel-title">üéÆ Activities</div>
            <div class="activity-buttons">
                <div class="activity-button ready" onclick="doCuteActivity('play')" title="Play Games">
                    <div class="activity-icon">üéà</div>
                    <div class="activity-name">Play</div>
                </div>
                <div class="activity-button ready" onclick="doCuteActivity('learn')" title="Learning Time">
                    <div class="activity-icon">üìö</div>
                    <div class="activity-name">Learn</div>
                </div>
                <div class="activity-button ready" onclick="doCuteActivity('explore')" title="Explore World">
                    <div class="activity-icon">üó∫Ô∏è</div>
                    <div class="activity-name">Explore</div>
                </div>
                <div class="activity-button ready" onclick="doCuteActivity('create')" title="Creative Time">
                    <div class="activity-icon">üé®</div>
                    <div class="activity-name">Create</div>
                </div>
            </div>
        </div>

        <!-- Special Features -->
        <div class="features-section">
            <div class="panel-title">‚ú® Special Features</div>
            <div class="special-buttons">
                <div class="special-button" onclick="openCustomization()" title="Dress Up Koko">üëó</div>
                <div class="special-button" onclick="openFriends()" title="Visit Friends">üë´</div>
                <div class="special-button" onclick="openPhotoMode()" title="Photo Time">üì∏</div>
                <div class="special-button" onclick="changeWeather()" title="Change Weather">üå§Ô∏è</div>
            </div>
        </div>

        <!-- Advanced Features -->
        <div class="advanced-section">
            <div class="panel-title">üöÄ Advanced</div>
            <div class="advanced-buttons">
                <div class="advanced-button" onclick="openAdvancedMiniGames()" title="Advanced Learning Games">üéì</div>
                <div class="advanced-button" onclick="openLearningAnalytics()" title="Learning Progress">üìä</div>
                <div class="advanced-button" onclick="openMusicSystem()" title="Music & Sounds">üéµ</div>
                <div class="advanced-button" onclick="openStoryChoices()" title="Story Adventures">üìö</div>
            </div>
        </div>
    </div>

    <!-- Hidden old container -->
    <div class="game-container" style="display: none;">
        <div class="game-screen">
            <!-- Cute Mode Selector -->
            <div class="mode-selector">
                <div class="mode-tab active" onclick="switchMode('play')" id="playTab">üéà Play Time</div>
                <div class="mode-tab" onclick="switchMode('care')" id="careTab">üíï Care Time</div>
                <div class="mode-tab" onclick="switchMode('friends')" id="friendsTab">üë´ Friends</div>
            </div>

            <!-- Heart System -->
            <div class="heart-system" id="heartSystem"></div>

            <!-- Cute HUD -->
            <div class="cute-hud">
                <div class="top-bar">
                    <div class="player-info">
                        <div class="player-avatar" id="playerAvatar" onclick="showKoalaMenu()">üê®</div>
                        <div class="level-section">
                            <div class="level-badge" id="levelBadge">Level 8 ‚≠ê</div>
                            <div class="xp-container">
                                <div class="xp-bar">
                                    <div class="xp-fill" id="xpFill" style="width: 67%"></div>
                                </div>
                                <div class="xp-text" id="xpText">670 / 1000</div>
                            </div>
                        </div>
                    </div>
                    <div class="resources">
                        <div class="resource-item" onclick="showResourceDetails('stickers')">
                            <span style="font-size: 16px;">üåü</span>
                            <span id="stickerAmount">247</span>
                        </div>
                        <div class="resource-item" onclick="showResourceDetails('hearts')">
                            <span style="font-size: 16px;">üíñ</span>
                            <span id="heartAmount">89</span>
                        </div>
                        <div class="resource-item" onclick="showResourceDetails('treats')">
                            <span style="font-size: 16px;">üç™</span>
                            <span id="treatAmount">156</span>
                        </div>
                        <div class="resource-item" onclick="showResourceDetails('toys')">
                            <span style="font-size: 16px;">üß∏</span>
                            <span id="toyAmount">34</span>
                        </div>
                    </div>
                </div>
                <div class="cute-stats">
                    <div class="stat-mini" title="Health">
                        <div class="stat-fill-mini health-fill" id="healthFill" style="width: 92%"></div>
                    </div>
                    <div class="stat-mini" title="Energy">
                        <div class="stat-fill-mini energy-fill" id="energyFill" style="width: 78%"></div>
                    </div>
                    <div class="stat-mini" title="Happiness">
                        <div class="stat-fill-mini happiness-fill" id="happinessFill" style="width: 96%"></div>
                    </div>
                    <div class="stat-mini" title="Love">
                        <div class="stat-fill-mini love-fill" id="loveFill" style="width: 85%"></div>
                    </div>
                </div>
                
                <!-- Daily Challenge Display -->
                <div id="dailyChallengePanel" class="daily-challenge-panel" style="display: none;">
                    <div class="daily-challenge-header">üåü Daily Challenge</div>
                    <div id="dailyChallengeName" class="daily-challenge-name"></div>
                    <div id="dailyChallengeDesc" class="daily-challenge-desc"></div>
                    <div class="daily-challenge-progress">
                        <div id="dailyChallengeBar" class="progress-bar">
                            <div id="dailyChallengeProgress" class="progress-fill"></div>
                        </div>
                        <span id="dailyChallengeText">0/0</span>
                    </div>
                </div>
                
                <!-- Collections Display -->
                <div class="collections-panel">
                    <div class="collections-header">üìö Collections</div>
                    <div class="collections-grid">
                        <div class="collection-item" onclick="showCollection('stickers')">
                            <span class="collection-emoji">üåü</span>
                            <span id="stickerCollection" class="collection-count">5/20</span>
                        </div>
                        <div class="collection-item" onclick="showCollection('emotions')">
                            <span class="collection-emoji">üòä</span>
                            <span id="emotionCollection" class="collection-count">3/10</span>
                        </div>
                        <div class="collection-item" onclick="showCollection('places')">
                            <span class="collection-emoji">üè†</span>
                            <span id="placeCollection" class="collection-count">6/8</span>
                        </div>
                        <div class="collection-item" onclick="showCollection('toys')">
                            <span class="collection-emoji">üß∏</span>
                            <span id="toyCollection" class="collection-count">8/15</span>
                        </div>
                    </div>
                </div>
                
                <!-- Pet Care Panel -->
                <div class="pet-care-panel">
                    <div class="pet-care-header">üíï Koko's Care</div>
                    <div class="care-stats">
                        <div class="care-stat" onclick="feedKoko()">
                            <span class="care-emoji">üçé</span>
                            <div class="care-bar">
                                <div id="hungerBar" class="care-fill" style="width: 85%"></div>
                            </div>
                        </div>
                        <div class="care-stat" onclick="batheKoko()">
                            <span class="care-emoji">üõÅ</span>
                            <div class="care-bar">
                                <div id="cleanBar" class="care-fill" style="width: 90%"></div>
                            </div>
                        </div>
                        <div class="care-stat" onclick="restKoko()">
                            <span class="care-emoji">üò¥</span>
                            <div class="care-bar">
                                <div id="energyBar" class="care-fill" style="width: 75%"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Weather Display -->
                <div class="weather-panel">
                    <div id="weatherDisplay" class="weather-display">‚òÄÔ∏è Sunny 22¬∞C</div>
                    <div id="weatherEffect" class="weather-effect"></div>
                </div>
                
                <!-- Story Progress -->
                <div class="story-panel">
                    <div class="story-header">üìñ Koko's Adventure</div>
                    <div class="story-info">
                        <span id="currentChapter">Chapter 1: New Friends</span>
                        <div class="story-progress">
                            <div id="storyProgressBar" class="progress-fill" style="width: 25%"></div>
                        </div>
                    </div>
                    <div id="activeQuest" class="active-quest">
                        <div id="questTitle" class="quest-title">Welcome to Eucalyptus Grove!</div>
                        <div id="questTasks" class="quest-tasks">
                            <!-- Tasks will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
                
                <!-- Skill Trees Panel -->
                <div class="skill-trees-panel">
                    <div class="skill-trees-header">üåü Skills</div>
                    <div class="skill-categories">
                        <div class="skill-category" onclick="showSkillTree('learning')">
                            <span class="skill-emoji">üß†</span>
                            <span id="learningLevel" class="skill-level">Lv.1</span>
                        </div>
                        <div class="skill-category" onclick="showSkillTree('creativity')">
                            <span class="skill-emoji">üé®</span>
                            <span id="creativityLevel" class="skill-level">Lv.1</span>
                        </div>
                        <div class="skill-category" onclick="showSkillTree('friendship')">
                            <span class="skill-emoji">üíï</span>
                            <span id="friendshipLevel" class="skill-level">Lv.1</span>
                        </div>
                        <div class="skill-category" onclick="showSkillTree('exploration')">
                            <span class="skill-emoji">üó∫Ô∏è</span>
                            <span id="explorationLevel" class="skill-level">Lv.1</span>
                        </div>
                    </div>
                </div>
                
                <!-- Koko's AI Thoughts -->
                <div class="koko-thoughts-panel">
                    <div class="thoughts-header">üí≠ Koko's Thoughts</div>
                    <div id="kokoThought" class="koko-thought">I wonder what we'll discover today!</div>
                    <div id="kokoMoodIndicator" class="mood-indicator">üòä Happy & Playful</div>
                </div>
                
                <!-- Seasonal Events -->
                <div id="seasonalEventPanel" class="seasonal-event-panel" style="display: none;">
                    <div class="seasonal-header">üéâ Special Event!</div>
                    <div id="seasonalEventName" class="seasonal-name"></div>
                    <div id="seasonalEventDesc" class="seasonal-desc"></div>
                    <div id="seasonalEventTimer" class="seasonal-timer"></div>
                </div>
            </div>

            <!-- Customization Panel -->
            <div id="customizationPanel" class="customization-panel" style="display: none;">
                <div class="customization-header">
                    <span>‚ú® Dress Up Koko!</span>
                    <button onclick="closeCustomization()" class="close-btn">‚ùå</button>
                </div>
                <div class="customization-tabs">
                    <button onclick="showCustomizationTab('hats')" class="tab-btn active">üé© Hats</button>
                    <button onclick="showCustomizationTab('accessories')" class="tab-btn">üéÄ Accessories</button>
                    <button onclick="showCustomizationTab('backgrounds')" class="tab-btn">üåà Backgrounds</button>
                </div>
                <div id="customizationItems" class="customization-items">
                    <!-- Items will be populated by JavaScript -->
                </div>
            </div>
            
            <!-- Friends Panel -->
            <div id="friendsPanel" class="friends-panel" style="display: none;">
                <div class="friends-header">
                    <span>üë´ Koko's Friends</span>
                    <button onclick="closeFriends()" class="close-btn">‚ùå</button>
                </div>
                <div id="friendsList" class="friends-list">
                    <!-- Friends will be populated by JavaScript -->
                </div>
            </div>
            
            <!-- Photo Mode -->
            <div id="photoMode" class="photo-mode" style="display: none;">
                <div class="photo-header">
                    <span>üì∏ Photo Time!</span>
                    <button onclick="closePhotoMode()" class="close-btn">‚ùå</button>
                </div>
                <div class="photo-controls">
                    <button onclick="takePhoto()" class="photo-btn">üì∏ Take Photo</button>
                    <button onclick="changePose()" class="photo-btn">ü§∏ Change Pose</button>
                    <button onclick="addStickers()" class="photo-btn">‚≠ê Add Stickers</button>
                </div>
                <div id="photoPreview" class="photo-preview">
                    <div id="photoKoko" class="photo-koko">üê®</div>
                </div>
            </div>
            
            <!-- Skill Tree Modal -->
            <div id="skillTreeModal" class="skill-tree-modal" style="display: none;">
                <div class="skill-tree-header">
                    <span id="skillTreeTitle">üß† Learning Skills</span>
                    <button onclick="closeSkillTree()" class="close-btn">‚ùå</button>
                </div>
                <div class="skill-points-display">
                    <span>Skill Points: </span>
                    <span id="availableSkillPoints">0</span>
                </div>
                <div id="skillTreeContent" class="skill-tree-content">
                    <!-- Skills will be populated by JavaScript -->
                </div>
            </div>
            
            <!-- Interactive Objects Modal -->
            <div id="interactiveObjectsModal" class="interactive-objects-modal" style="display: none;">
                <div class="interactive-header">
                    <span id="interactiveTitle">üõù Playground Objects</span>
                    <button onclick="closeInteractiveObjects()" class="close-btn">‚ùå</button>
                </div>
                <div id="interactiveObjectsList" class="interactive-objects-list">
                    <!-- Objects will be populated by JavaScript -->
                </div>
            </div>
            
            <!-- Advanced Mini-Games Modal -->
            <div id="advancedMiniGamesModal" class="advanced-mini-games-modal" style="display: none;">
                <div class="advanced-games-header">
                    <span>üéì Advanced Learning Games</span>
                    <button onclick="closeAdvancedMiniGames()" class="close-btn">‚ùå</button>
                </div>
                <div id="advancedGamesList" class="advanced-games-list">
                    <!-- Games will be populated by JavaScript -->
                </div>
            </div>
            
            <!-- Learning Analytics Modal -->
            <div id="learningAnalyticsModal" class="learning-analytics-modal" style="display: none;">
                <div class="analytics-header">
                    <span>üìä Learning Progress & Analytics</span>
                    <button onclick="closeLearningAnalytics()" class="close-btn">‚ùå</button>
                </div>
                <div id="analyticsContent" class="analytics-content">
                    <!-- Analytics will be populated by JavaScript -->
                </div>
            </div>
            
            <!-- Music System Modal -->
            <div id="musicSystemModal" class="music-system-modal" style="display: none;">
                <div class="music-header">
                    <span>üéµ Music & Sound System</span>
                    <button onclick="closeMusicSystem()" class="close-btn">‚ùå</button>
                </div>
                <div id="musicControls" class="music-controls">
                    <!-- Music controls will be populated by JavaScript -->
                </div>
            </div>
            
            <!-- Story Choices Modal -->
            <div id="storyChoicesModal" class="story-choices-modal" style="display: none;">
                <div class="story-choices-header">
                    <span>üìö Story Adventures & Choices</span>
                    <button onclick="closeStoryChoices()" class="close-btn">‚ùå</button>
                </div>
                <div id="storyChoicesContent" class="story-choices-content">
                    <!-- Story choices will be populated by JavaScript -->
                </div>
            </div>
            
            <!-- Enhanced Parental Dashboard Modal -->
            <div id="enhancedParentalModal" class="enhanced-parental-modal" style="display: none;">
                <div class="enhanced-parental-header">
                    <span>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Advanced Parental Dashboard</span>
                    <button onclick="closeEnhancedParental()" class="close-btn">‚ùå</button>
                </div>
                <div id="enhancedParentalContent" class="enhanced-parental-content">
                    <!-- Enhanced parental content will be populated by JavaScript -->
                </div>
            </div>
            
            <!-- Time-Based Event Notification -->
            <div id="timeBasedEventNotification" class="time-based-event-notification" style="display: none;">
                <div class="time-event-icon">üïê</div>
                <div class="time-event-content">
                    <div id="timeEventTitle" class="time-event-title"></div>
                    <div id="timeEventDesc" class="time-event-desc"></div>
                </div>
            </div>
            
            <!-- Critter Collection Modal -->
            <div id="critterCollectionModal" class="critter-collection-modal" style="display: none;">
                <div class="critter-collection-header">
                    <span>üêæ Critter Collection</span>
                    <button onclick="closeCritterCollection()" class="close-btn">‚ùå</button>
                </div>
                <div class="collection-stats">
                    <div class="stat">Collected: <span id="collectedCount">1</span>/8</div>
                    <div class="stat">Discovered: <span id="discoveredCount">1</span>/8</div>
                    <div class="stat">Breeding Unlocked: <span id="breedingStatus">No</span></div>
                </div>
                <div id="critterGrid" class="critter-grid">
                    <!-- Critters will be populated by JavaScript -->
                </div>
            </div>
            
            <!-- Critter Switcher Modal -->
            <div id="critterSwitcherModal" class="critter-switcher-modal" style="display: none;">
                <div class="critter-switcher-header">
                    <span>üîÑ Switch Active Critter</span>
                    <button onclick="closeCritterSwitcher()" class="close-btn">‚ùå</button>
                </div>
                <div id="ownedCrittersList" class="owned-critters-list">
                    <!-- Owned critters will be populated by JavaScript -->
                </div>
            </div>
            
            <!-- Critter Details Modal -->
            <div id="critterDetailsModal" class="critter-details-modal" style="display: none;">
                <div class="critter-details-header">
                    <span id="critterDetailsTitle">üê® Koko Details</span>
                    <button onclick="closeCritterDetails()" class="close-btn">‚ùå</button>
                </div>
                <div id="critterDetailsContent" class="critter-details-content">
                    <!-- Critter details will be populated by JavaScript -->
                </div>
            </div>
            
            <!-- Breeding Lab Modal -->
            <div id="breedingLabModal" class="breeding-lab-modal" style="display: none;">
                <div class="breeding-lab-header">
                    <span>üß¨ Breeding Laboratory</span>
                    <button onclick="closeBreedingLab()" class="close-btn">‚ùå</button>
                </div>
                <div id="breedingLabContent" class="breeding-lab-content">
                    <!-- Breeding content will be populated by JavaScript -->
                </div>
            </div>
            
            <!-- Growth Activity Modal -->
            <div id="growthActivityModal" class="growth-activity-modal" style="display: none;">
                <div class="growth-activity-header">
                    <span>üìà Growth Activities</span>
                    <button onclick="closeGrowthActivity()" class="close-btn">‚ùå</button>
                </div>
                <div id="growthActivityContent" class="growth-activity-content">
                    <!-- Growth activities will be populated by JavaScript -->
                </div>
            </div>
            
            <!-- Story Mode Modal -->
            <div id="storyModeModal" class="story-mode-modal" style="display: none;">
                <div class="story-mode-header">
                    <span id="storyModeTitle">üìñ Story Adventures</span>
                    <button onclick="closeStoryMode()" class="close-btn">‚ùå</button>
                </div>
                <div id="storyModeContent" class="story-mode-content">
                    <div class="chapter-selection" id="chapterSelection">
                        <!-- Chapter selection will be populated by JavaScript -->
                    </div>
                    <div class="story-scene" id="storyScene" style="display: none;">
                        <!-- Current scene will be populated by JavaScript -->
                    </div>
                </div>
            </div>
            
            <!-- Achievements Modal -->
            <div id="achievementsModal" class="achievements-modal" style="display: none;">
                <div class="achievements-header">
                    <span>üèÜ Achievement Gallery</span>
                    <button onclick="closeAchievements()" class="close-btn">‚ùå</button>
                </div>
                <div class="achievements-content">
                    <div class="achievement-categories">
                        <div class="category-tabs" id="categoryTabs">
                            <!-- Category tabs will be populated by JavaScript -->
                        </div>
                        <div class="achievement-grid" id="achievementGrid">
                            <!-- Achievements will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Achievement Notifications -->
            <div id="achievementNotification" class="achievement-notification" style="display: none;">
                <div class="achievement-icon">üèÜ</div>
                <div class="achievement-content">
                    <div id="achievementTitle" class="achievement-title"></div>
                    <div id="achievementDesc" class="achievement-desc"></div>
                </div>
            </div>

            <!-- Parent Button -->
            <div class="parent-btn" onclick="openParentDashboard()" title="Parent Info">
                üë®‚Äçüë©‚Äçüëß‚Äçüë¶
            </div>

            <!-- Cute Toy Box -->
            <div class="toy-box">
                <div class="toy-box-title">üéÅ Toy Box</div>
                <div class="toy-grid" id="toyGrid">
                    <!-- Toy slots will be generated here -->
                </div>
            </div>

            <!-- Game World Container -->
            <div id="gameWorld" class="game-world">
                <!-- Current Location Background -->
                <div id="locationBackground" class="location-background"></div>
                
                <!-- Interactive Objects in Current Location -->
                <div id="locationObjects" class="location-objects"></div>
                
                <!-- NPCs in Current Location -->
                <div id="locationNPCs" class="location-npcs"></div>
                
                <!-- Cute Koala Character (Moveable) -->
                <div class="koala-container moveable" id="koalaContainer">
                    <div class="koala-status" id="koalaStatus">Koko is exploring! üåà</div>
                    <div class="cute-koala" id="cuteKoala" onclick="interactWithKoko()">üê®</div>
                    <div class="koala-eyes">
                        <div class="sparkle-eye">‚ú®</div>
                        <div class="sparkle-eye">‚ú®</div>
                    </div>
                    <div class="koala-title" id="koalaTitle">Koko the Super Cute Koala ‚Ä¢ Level 8</div>
                    <div class="love-progress">
                        <div class="love-fill" id="loveFillBar" style="width: 67%"></div>
                    </div>
                    <div class="love-text" id="loveText">Love: 670 / 1000 üíï</div>
                </div>
                
                <!-- Location Exits/Portals -->
                <div id="locationExits" class="location-exits"></div>
            </div>
            
            <!-- Movement Controls -->
            <div class="movement-controls">
                <div class="movement-instructions">
                    <span>üéÆ Use WASD or Arrow Keys to move Koko around!</span>
                </div>
                <div class="movement-buttons">
                    <button class="move-btn" onmousedown="startMoving('up')" onmouseup="stopMoving('up')">‚¨ÜÔ∏è</button>
                    <div class="move-row">
                        <button class="move-btn" onmousedown="startMoving('left')" onmouseup="stopMoving('left')">‚¨ÖÔ∏è</button>
                        <button class="move-btn" onmousedown="startMoving('down')" onmouseup="stopMoving('down')">‚¨áÔ∏è</button>
                        <button class="move-btn" onmousedown="startMoving('right')" onmouseup="stopMoving('right')">‚û°Ô∏è</button>
                    </div>
                </div>
            </div>
            
            <!-- Mini Map -->
            <div class="mini-map">
                <div class="mini-map-header">üó∫Ô∏è World Map</div>
                <div id="miniMapContent" class="mini-map-content">
                    <!-- Map will be populated by JavaScript -->
                </div>
                <div class="current-location">
                    üìç <span id="currentLocationName">Cozy Home</span>
                </div>
            </div>

            <!-- Cute Activities -->
            <div class="activities-panel">
                <div class="activity-button ready" onclick="doCuteActivity('play')" title="Play Games">
                    üéÆ
                    <div class="activity-level">5</div>
                    <div class="activity-cooldown" id="play-cooldown"></div>
                </div>
                <div class="activity-button ready" onclick="doCuteActivity('hug')" title="Give Hugs">
                    ü§ó
                    <div class="activity-level">3</div>
                    <div class="activity-cooldown" id="hug-cooldown"></div>
                </div>
                <div class="activity-button ready" onclick="doCuteActivity('dance')" title="Dance Party">
                    üíÉ
                    <div class="activity-level">4</div>
                    <div class="activity-cooldown" id="dance-cooldown"></div>
                </div>
                <div class="activity-button ready" onclick="doCuteActivity('sing')" title="Sing Songs">
                    üéµ
                    <div class="activity-level">6</div>
                    <div class="activity-cooldown" id="sing-cooldown"></div>
                </div>
                <div class="activity-button ready" onclick="doCuteActivity('learn')" title="Learn Together">
                    üìö
                    <div class="activity-level">7</div>
                    <div class="activity-cooldown" id="learn-cooldown"></div>
                </div>
                <div class="activity-button ready" onclick="doCuteActivity('magic')" title="Magic Time">
                    ü™Ñ
                    <div class="activity-level">2</div>
                    <div class="activity-cooldown" id="magic-cooldown"></div>
                </div>
            </div>
            
            <!-- Special Feature Buttons -->
            <div class="special-buttons">
                <div class="special-button" onclick="openCustomization()" title="Dress Up Koko">üëó</div>
                <div class="special-button" onclick="openFriends()" title="Visit Friends">üë´</div>
                <div class="special-button" onclick="openPhotoMode()" title="Photo Time">üì∏</div>
                <div class="special-button" onclick="changeWeather()" title="Change Weather">üå§Ô∏è</div>
            </div>
            
            <!-- Advanced Feature Buttons -->
            <div class="advanced-buttons">
                <div class="advanced-button" onclick="openAdvancedMiniGames()" title="Advanced Learning Games">üéì</div>
                <div class="advanced-button" onclick="openLearningAnalytics()" title="Learning Progress">üìä</div>
                <div class="advanced-button" onclick="openMusicSystem()" title="Music & Sounds">üéµ</div>
                <div class="advanced-button" onclick="openStoryChoices()" title="Story Adventures">üìö</div>
            </div>

            <!-- Cute Places -->
            <div class="cute-places">
                <div class="place-button available" onclick="visitCutePlace('playground')" id="playgroundPlace">
                    <div class="place-icon">üõù</div>
                    <div class="place-label">Playground</div>
                    <div class="place-level">Fun!</div>
                </div>
                <div class="place-button available" onclick="visitCutePlace('park')" id="parkPlace">
                    <div class="place-icon">üå≥</div>
                    <div class="place-label">Park</div>
                    <div class="place-level">Nature</div>
                </div>
                <div class="place-button available" onclick="visitCutePlace('library')" id="libraryPlace">
                    <div class="place-icon">üìö</div>
                    <div class="place-label">Library</div>
                    <div class="place-level">Books</div>
                </div>
                <div class="place-button available" onclick="visitCutePlace('bakery')" id="bakeryPlace">
                    <div class="place-icon">üßÅ</div>
                    <div class="place-label">Bakery</div>
                    <div class="place-level">Treats</div>
                </div>
                <div class="place-button available" onclick="visitCutePlace('school')" id="schoolPlace">
                    <div class="place-icon">üè´</div>
                    <div class="place-label">School</div>
                    <div class="place-level">Learn</div>
                </div>
                <div class="place-button" onclick="visitCutePlace('shop')" id="shopPlace">
                    <div class="place-icon">üè™</div>
                    <div class="place-label">Toy Shop</div>
                </div>
                <div class="place-button" onclick="visitCutePlace('home')" id="homePlace">
                    <div class="place-icon">üè†</div>
                    <div class="place-label">Home</div>
                </div>
            </div>
        </div>

        <!-- Cute Challenge Overlay -->
        <div class="challenge-overlay" id="challengeOverlay">
            <div class="challenge-panel" id="challengePanel">
                <!-- Challenge content will be inserted here -->
            </div>
        </div>
    </div>

    <script>
        // Cute Game State
        let cuteGameState = {
            player: {
                name: "Best Friend",
                level: 8,
                xp: 670,
                xpToNext: 1000,
                love: 670,
                loveToNext: 1000
            },
            koala: {
                name: "Koko",
                mood: "super happy",
                personality: "playful and sweet",
                form: "adorable",
                moodLevel: 100,
                expressions: ["üòä", "üòÑ", "ü•∞", "üòç", "ü§ó", "üòÜ"]
            },
            stats: {
                health: 92,
                energy: 78,
                happiness: 96,
                love: 85
            },
            resources: {
                stickers: 247,
                hearts: 89,
                treats: 156,
                toys: 34
            },
            activities: {
                play: { level: 5, cooldown: 0, loveGain: 15 },
                hug: { level: 3, cooldown: 0, loveGain: 25 },
                dance: { level: 4, cooldown: 0, loveGain: 20 },
                sing: { level: 6, cooldown: 0, loveGain: 18 },
                learn: { level: 7, cooldown: 0, loveGain: 30 },
                magic: { level: 2, cooldown: 0, loveGain: 35 }
            },
            toyBox: [
                { name: "Teddy Bear", quantity: 3, emoji: "üß∏" },
                { name: "Ball", quantity: 2, emoji: "‚öΩ" },
                { name: "Puzzle", quantity: 5, emoji: "üß©" },
                { name: "Crayons", quantity: 8, emoji: "üñçÔ∏è" },
                { name: "Blocks", quantity: 12, emoji: "üß±" },
                { name: "Doll", quantity: 1, emoji: "ü™Ü" },
                { name: "Car", quantity: 4, emoji: "üöó" },
                { name: "Book", quantity: 7, emoji: "üìñ" },
                { name: "Stickers", quantity: 25, emoji: "‚≠ê" }
            ],
            currentMode: "play",
            comboCount: 0,
            lastInteraction: 0,
            specialEvents: [],
            achievements: [],
            dailyStreak: 1,
            totalPlayTime: 0,
            unlockedAchievements: [],
            dailyChallenge: null,
            lastDailyReset: 0,
            collections: {
                stickers: { collected: 5, total: 20 },
                emotions: { collected: 3, total: 10 },
                places: { collected: 6, total: 8 },
                toys: { collected: 8, total: 15 }
            },
            kokoCustomization: {
                hat: null,
                accessory: null,
                background: "default",
                unlocked: {
                    hats: ['üé©', 'üëë', 'üéì', 'üß¢'],
                    accessories: ['üéÄ', 'üëì', 'üå∏', '‚≠ê'],
                    backgrounds: ['üåà', 'üå∏', 'üåü', 'üèñÔ∏è', 'üå≤', 'üé™']
                }
            },
            miniGameScores: {
                memoryMatch: 0,
                colorMixer: 0,
                rhythmGame: 0,
                puzzleSolver: 0
            },
            petCare: {
                hunger: 85,
                cleanliness: 90,
                energy: 75,
                lastFed: Date.now(),
                lastBathed: Date.now(),
                lastSlept: Date.now()
            },
            weather: {
                current: 'sunny',
                temperature: 22,
                effects: []
            },
            story: {
                currentChapter: 1,
                unlockedChapters: [1],
                completedQuests: [],
                activeQuest: {
                    id: 'welcome_quest',
                    title: 'Welcome to Eucalyptus Grove!',
                    description: 'Help Koko settle into their new home',
                    tasks: [
                        { id: 'click_koko', description: 'Click Koko 5 times', progress: 0, target: 5, completed: false },
                        { id: 'visit_playground', description: 'Visit the playground', progress: 0, target: 1, completed: false },
                        { id: 'feed_koko', description: 'Feed Koko once', progress: 0, target: 1, completed: false }
                    ],
                    rewards: { xp: 100, stickers: 50, hearts: 25 },
                    completed: false
                }
            },
            friends: [
                { name: 'Bella Bunny', emoji: 'üê∞', friendship: 50, unlocked: true },
                { name: 'Charlie Cat', emoji: 'üê±', friendship: 0, unlocked: false },
                { name: 'Danny Dog', emoji: 'üê∂', friendship: 0, unlocked: false },
                { name: 'Ellie Elephant', emoji: 'üêò', friendship: 0, unlocked: false }
            ],
            timeOfDay: 'morning',
            seasonalEvents: [
                { id: 'spring_festival', name: 'Spring Flower Festival', active: false, duration: 7 },
                { id: 'summer_beach', name: 'Summer Beach Party', active: false, duration: 5 },
                { id: 'autumn_harvest', name: 'Autumn Harvest Celebration', active: false, duration: 6 },
                { id: 'winter_wonderland', name: 'Winter Wonderland', active: false, duration: 8 }
            ],
            photoAlbum: [],
            skillTrees: {
                learning: { 
                    level: 1, 
                    points: 0, 
                    unlocked: ['basic_math'],
                    skills: {
                        basic_math: { name: 'Basic Math', cost: 0, unlocked: true },
                        advanced_math: { name: 'Advanced Math', cost: 10, unlocked: false },
                        science_explorer: { name: 'Science Explorer', cost: 15, unlocked: false },
                        reading_master: { name: 'Reading Master', cost: 12, unlocked: false },
                        genius_mode: { name: 'Genius Mode', cost: 25, unlocked: false }
                    }
                },
                creativity: { 
                    level: 1, 
                    points: 0, 
                    unlocked: ['color_mixing'],
                    skills: {
                        color_mixing: { name: 'Color Mixing', cost: 0, unlocked: true },
                        art_master: { name: 'Art Master', cost: 8, unlocked: false },
                        music_composer: { name: 'Music Composer', cost: 12, unlocked: false },
                        story_teller: { name: 'Story Teller', cost: 10, unlocked: false },
                        creative_genius: { name: 'Creative Genius', cost: 20, unlocked: false }
                    }
                },
                friendship: { 
                    level: 1, 
                    points: 0, 
                    unlocked: ['basic_care'],
                    skills: {
                        basic_care: { name: 'Basic Care', cost: 0, unlocked: true },
                        friend_magnet: { name: 'Friend Magnet', cost: 6, unlocked: false },
                        empathy_expert: { name: 'Empathy Expert', cost: 9, unlocked: false },
                        social_butterfly: { name: 'Social Butterfly', cost: 14, unlocked: false },
                        friendship_guru: { name: 'Friendship Guru', cost: 18, unlocked: false }
                    }
                },
                exploration: { 
                    level: 1, 
                    points: 0, 
                    unlocked: ['playground'],
                    skills: {
                        playground: { name: 'Playground Explorer', cost: 0, unlocked: true },
                        nature_scout: { name: 'Nature Scout', cost: 7, unlocked: false },
                        treasure_hunter: { name: 'Treasure Hunter', cost: 11, unlocked: false },
                        world_traveler: { name: 'World Traveler', cost: 16, unlocked: false },
                        master_explorer: { name: 'Master Explorer', cost: 22, unlocked: false }
                    }
                }
            },
            interactiveObjects: {
                playground: [
                    { id: 'swing', emoji: 'ü™Ä', name: 'Magic Swing', clicks: 0, unlocked: true },
                    { id: 'slide', emoji: 'üõù', name: 'Rainbow Slide', clicks: 0, unlocked: true },
                    { id: 'seesaw', emoji: '‚öñÔ∏è', name: 'Friendship Seesaw', clicks: 0, unlocked: false }
                ],
                garden: [
                    { id: 'flowers', emoji: 'üå∏', name: 'Singing Flowers', clicks: 0, unlocked: true },
                    { id: 'fountain', emoji: '‚õ≤', name: 'Wishing Fountain', clicks: 0, unlocked: false },
                    { id: 'butterfly', emoji: 'ü¶ã', name: 'Dancing Butterfly', clicks: 0, unlocked: false }
                ],
                library: [
                    { id: 'books', emoji: 'üìö', name: 'Magical Books', clicks: 0, unlocked: true },
                    { id: 'globe', emoji: 'üåç', name: 'Adventure Globe', clicks: 0, unlocked: false },
                    { id: 'telescope', emoji: 'üî≠', name: 'Star Telescope', clicks: 0, unlocked: false }
                ]
            },
            kokoAI: {
                mood: 'happy',
                personality: 'playful',
                responses: [],
                learningProgress: 0,
                favoriteActivities: ['play', 'learn', 'hug'],
                currentThought: 'I wonder what we\'ll discover today!'
            },
            learningAnalytics: {
                totalPlayTime: 0,
                sessionsCompleted: 0,
                averageSessionLength: 0,
                skillsLearned: [],
                difficultyLevel: 1,
                learningSpeed: 'normal',
                strongSubjects: [],
                needsImprovement: [],
                parentalInsights: []
            },
            timeBasedEvents: {
                morning: { active: false, lastTriggered: 0 },
                afternoon: { active: false, lastTriggered: 0 },
                evening: { active: false, lastTriggered: 0 },
                night: { active: false, lastTriggered: 0 }
            },
            advancedMiniGames: {
                mathAdventure: { level: 1, highScore: 0, completed: [] },
                wordExplorer: { level: 1, highScore: 0, completed: [] },
                scienceQuest: { level: 1, highScore: 0, completed: [] },
                creativityStudio: { level: 1, highScore: 0, completed: [] },
                logicPuzzles: { level: 1, highScore: 0, completed: [] }
            },
            storyChoices: {
                currentBranch: 'main',
                choicesMade: [],
                unlockedEndings: [],
                characterRelationships: {
                    bella: 'friendly',
                    charlie: 'neutral',
                    danny: 'neutral',
                    ellie: 'neutral'
                }
            },
            musicSystem: {
                currentTrack: 'peaceful_meadow',
                volume: 0.7,
                moodBasedMusic: true,
                unlockedTracks: ['peaceful_meadow', 'playful_bounce'],
                musicPreferences: []
            },
            parentalControls: {
                sessionTimeLimit: 30, // minutes
                currentSessionTime: 0,
                dailyTimeLimit: 120, // minutes
                dailyTimeUsed: 0,
                educationalFocus: true,
                allowSocialFeatures: false,
                progressReports: []
            },
            movement: {
                x: 250, // Koko's current X position
                y: 200, // Koko's current Y position
                speed: 3, // Movement speed
                direction: 'down', // Current facing direction
                isMoving: false,
                targetX: null,
                targetY: null,
                currentLocation: 'home',
                unlockedLocations: ['home', 'playground', 'garden']
            },
            worldMap: {
                home: {
                    name: 'Cozy Home',
                    emoji: 'üè†',
                    x: 250,
                    y: 200,
                    connections: ['playground', 'garden', 'library'],
                    objects: [
                        { id: 'bed', x: 100, y: 150, emoji: 'üõèÔ∏è', name: 'Cozy Bed', action: 'sleep' },
                        { id: 'kitchen', x: 400, y: 180, emoji: 'üç≥', name: 'Kitchen', action: 'cook' },
                        { id: 'bookshelf', x: 200, y: 100, emoji: 'üìö', name: 'Bookshelf', action: 'read' }
                    ],
                    npcs: [],
                    discovered: true
                },
                playground: {
                    name: 'Fun Playground',
                    emoji: 'üõù',
                    x: 150,
                    y: 300,
                    connections: ['home', 'park', 'school'],
                    objects: [
                        { id: 'swing', x: 120, y: 250, emoji: 'ü™Ä', name: 'Magic Swing', action: 'swing' },
                        { id: 'slide', x: 300, y: 280, emoji: 'üõù', name: 'Rainbow Slide', action: 'slide' },
                        { id: 'sandbox', x: 200, y: 350, emoji: 'üèñÔ∏è', name: 'Sandbox', action: 'dig' }
                    ],
                    npcs: [
                        { id: 'bella', x: 180, y: 200, emoji: 'üê∞', name: 'Bella Bunny' }
                    ],
                    discovered: true
                },
                garden: {
                    name: 'Magical Garden',
                    emoji: 'üå∏',
                    x: 350,
                    y: 150,
                    connections: ['home', 'forest', 'pond'],
                    objects: [
                        { id: 'flowers', x: 200, y: 180, emoji: 'üå∏', name: 'Singing Flowers', action: 'smell' },
                        { id: 'fountain', x: 300, y: 120, emoji: '‚õ≤', name: 'Wishing Fountain', action: 'wish' },
                        { id: 'tree', x: 150, y: 250, emoji: 'üå≥', name: 'Wisdom Tree', action: 'climb' }
                    ],
                    npcs: [
                        { id: 'butterfly', x: 250, y: 160, emoji: 'ü¶ã', name: 'Dancing Butterfly' }
                    ],
                    discovered: true
                },
                library: {
                    name: 'Knowledge Library',
                    emoji: 'üìö',
                    x: 400,
                    y: 100,
                    connections: ['home', 'school', 'museum'],
                    objects: [
                        { id: 'books', x: 180, y: 150, emoji: 'üìö', name: 'Magical Books', action: 'study' },
                        { id: 'globe', x: 320, y: 180, emoji: 'üåç', name: 'Adventure Globe', action: 'explore' },
                        { id: 'telescope', x: 250, y: 100, emoji: 'üî≠', name: 'Star Telescope', action: 'observe' }
                    ],
                    npcs: [
                        { id: 'owl', x: 200, y: 120, emoji: 'ü¶â', name: 'Wise Owl' }
                    ],
                    discovered: false
                },
                park: {
                    name: 'Nature Park',
                    emoji: 'üå≤',
                    x: 100,
                    y: 400,
                    connections: ['playground', 'forest', 'lake'],
                    objects: [
                        { id: 'picnic', x: 200, y: 300, emoji: 'üß∫', name: 'Picnic Spot', action: 'eat' },
                        { id: 'trail', x: 150, y: 350, emoji: 'ü•æ', name: 'Nature Trail', action: 'hike' }
                    ],
                    npcs: [
                        { id: 'squirrel', x: 180, y: 280, emoji: 'üêøÔ∏è', name: 'Chatty Squirrel' }
                    ],
                    discovered: false
                },
                school: {
                    name: 'Learning School',
                    emoji: 'üè´',
                    x: 500,
                    y: 200,
                    connections: ['playground', 'library', 'town'],
                    objects: [
                        { id: 'blackboard', x: 200, y: 150, emoji: 'üìã', name: 'Smart Board', action: 'learn' },
                        { id: 'desk', x: 250, y: 200, emoji: 'ü™ë', name: 'Study Desk', action: 'write' },
                        { id: 'computer', x: 300, y: 180, emoji: 'üíª', name: 'Learning Computer', action: 'code' }
                    ],
                    npcs: [
                        { id: 'teacher', x: 220, y: 160, emoji: 'üë©‚Äçüè´', name: 'Ms. Wise' }
                    ],
                    discovered: false
                }
            },
            movementKeys: {
                w: false, a: false, s: false, d: false,
                ArrowUp: false, ArrowLeft: false, ArrowDown: false, ArrowRight: false
            },
            discoveries: [],
            explorationRewards: {
                stepsWalked: 0,
                locationsVisited: 0,
                objectsInteracted: 0,
                npcsMetCount: 0
            },
            critterCollection: {
                activeCritter: 'koko',
                totalCritters: 1,
                maxCapacity: 12,
                critters: {
                    koko: {
                        id: 'koko',
                        name: 'Koko',
                        type: 'koala',
                        emoji: 'üê®',
                        stage: 'adult',
                        level: 8,
                        experience: 2840,
                        specialization: 'exploration',
                        personality: 'playful',
                        happiness: 85,
                        health: 92,
                        energy: 78,
                        love: 67,
                        intelligence: 75,
                        creativity: 60,
                        social: 70,
                        strength: 55,
                        discovered: true,
                        unlocked: true,
                        habitat: 'home',
                        favoriteActivities: ['explore', 'learn', 'play'],
                        growthPoints: {
                            math: 45,
                            science: 30,
                            reading: 55,
                            creativity: 40,
                            social: 50,
                            physical: 35
                        },
                        evolutionStage: 2,
                        maxEvolution: 3,
                        bondLevel: 8,
                        lastInteraction: Date.now()
                    }
                },
                availableCritters: {
                    bella: {
                        id: 'bella',
                        name: 'Bella',
                        type: 'bunny',
                        emoji: 'üê∞',
                        stage: 'baby',
                        specialization: 'social',
                        personality: 'friendly',
                        habitat: 'playground',
                        unlockRequirement: 'Complete friendship quest',
                        unlockProgress: 0,
                        unlockTarget: 1,
                        discovered: true,
                        unlocked: false
                    },
                    charlie: {
                        id: 'charlie',
                        name: 'Charlie',
                        type: 'cat',
                        emoji: 'üê±',
                        stage: 'baby',
                        specialization: 'creativity',
                        personality: 'artistic',
                        habitat: 'library',
                        unlockRequirement: 'Complete 5 creative activities',
                        unlockProgress: 0,
                        unlockTarget: 5,
                        discovered: false,
                        unlocked: false
                    },
                    danny: {
                        id: 'danny',
                        name: 'Danny',
                        type: 'dog',
                        emoji: 'üê∂',
                        stage: 'baby',
                        specialization: 'physical',
                        personality: 'energetic',
                        habitat: 'park',
                        unlockRequirement: 'Walk 500 steps',
                        unlockProgress: 0,
                        unlockTarget: 500,
                        discovered: false,
                        unlocked: false
                    },
                    ellie: {
                        id: 'ellie',
                        name: 'Ellie',
                        type: 'elephant',
                        emoji: 'üêò',
                        stage: 'baby',
                        specialization: 'intelligence',
                        personality: 'wise',
                        habitat: 'school',
                        unlockRequirement: 'Reach level 10 in learning skills',
                        unlockProgress: 0,
                        unlockTarget: 10,
                        discovered: false,
                        unlocked: false
                    },
                    ruby: {
                        id: 'ruby',
                        name: 'Ruby',
                        type: 'fox',
                        emoji: 'ü¶ä',
                        stage: 'baby',
                        specialization: 'cunning',
                        personality: 'clever',
                        habitat: 'forest',
                        unlockRequirement: 'Solve 10 logic puzzles',
                        unlockProgress: 0,
                        unlockTarget: 10,
                        discovered: false,
                        unlocked: false
                    },
                    luna: {
                        id: 'luna',
                        name: 'Luna',
                        type: 'owl',
                        emoji: 'ü¶â',
                        stage: 'baby',
                        specialization: 'wisdom',
                        personality: 'studious',
                        habitat: 'library',
                        unlockRequirement: 'Read 20 books',
                        unlockProgress: 0,
                        unlockTarget: 20,
                        discovered: false,
                        unlocked: false
                    },
                    splash: {
                        id: 'splash',
                        name: 'Splash',
                        type: 'dolphin',
                        emoji: 'üê¨',
                        stage: 'baby',
                        specialization: 'aquatic',
                        personality: 'playful',
                        habitat: 'pond',
                        unlockRequirement: 'Complete water activities',
                        unlockProgress: 0,
                        unlockTarget: 3,
                        discovered: false,
                        unlocked: false
                    },
                    spark: {
                        id: 'spark',
                        name: 'Spark',
                        type: 'dragon',
                        emoji: 'üêâ',
                        stage: 'egg',
                        specialization: 'magical',
                        personality: 'mystical',
                        habitat: 'mountain',
                        unlockRequirement: 'Master all skill trees',
                        unlockProgress: 0,
                        unlockTarget: 4,
                        discovered: false,
                        unlocked: false
                    }
                }
            },
            critterGrowth: {
                stages: ['egg', 'baby', 'child', 'teen', 'adult', 'elder', 'legendary'],
                experienceRequired: [0, 100, 300, 600, 1000, 1500, 2500],
                growthActivities: {
                    math: ['counting', 'addition', 'subtraction', 'multiplication', 'division', 'algebra'],
                    science: ['observation', 'experiment', 'hypothesis', 'discovery', 'invention', 'research'],
                    reading: ['letters', 'words', 'sentences', 'stories', 'books', 'literature'],
                    creativity: ['drawing', 'coloring', 'crafting', 'music', 'dance', 'imagination'],
                    social: ['greeting', 'sharing', 'helping', 'teamwork', 'leadership', 'empathy'],
                    physical: ['walking', 'running', 'jumping', 'climbing', 'sports', 'adventure']
                }
            },
            breeding: {
                unlocked: false,
                combinations: {
                    'koala+bunny': { result: 'koabun', name: 'Koabun', emoji: 'üê®üê∞', rarity: 'rare' },
                    'cat+owl': { result: 'cowl', name: 'Cowl', emoji: 'üê±ü¶â', rarity: 'rare' },
                    'dog+fox': { result: 'dox', name: 'Dox', emoji: 'üê∂ü¶ä', rarity: 'rare' },
                    'elephant+dragon': { result: 'dragonphant', name: 'Dragonphant', emoji: 'üêòüêâ', rarity: 'legendary' },
                    'dolphin+dragon': { result: 'aquadragon', name: 'Aquadragon', emoji: 'üê¨üêâ', rarity: 'legendary' }
                },
                breedingPairs: [],
                incubationTime: 24 * 60 * 60 * 1000, // 24 hours in milliseconds
                activeBreeding: []
            },
            achievements: {
                unlocked: [],
                progress: {},
                categories: {
                    learning: {
                        name: 'Learning Master',
                        emoji: 'üìö',
                        achievements: [
                            { id: 'first_lesson', name: 'First Steps', desc: 'Complete your first educational activity', emoji: 'üë∂', reward: { stickers: 10, hearts: 5 } },
                            { id: 'math_whiz', name: 'Math Whiz', desc: 'Complete 10 math activities', emoji: 'üßÆ', target: 10, reward: { stickers: 50, hearts: 25 } },
                            { id: 'science_explorer', name: 'Science Explorer', desc: 'Complete 10 science activities', emoji: 'üî¨', target: 10, reward: { stickers: 50, hearts: 25 } },
                            { id: 'reading_champion', name: 'Reading Champion', desc: 'Complete 10 reading activities', emoji: 'üìñ', target: 10, reward: { stickers: 50, hearts: 25 } },
                            { id: 'creative_genius', name: 'Creative Genius', desc: 'Complete 10 creative activities', emoji: 'üé®', target: 10, reward: { stickers: 50, hearts: 25 } },
                            { id: 'knowledge_master', name: 'Knowledge Master', desc: 'Complete 100 educational activities', emoji: 'üéì', target: 100, reward: { stickers: 200, hearts: 100, specialCritter: 'scholar' } }
                        ]
                    },
                    collection: {
                        name: 'Critter Collector',
                        emoji: 'üêæ',
                        achievements: [
                            { id: 'first_friend', name: 'First Friend', desc: 'Unlock your second critter', emoji: 'üë´', reward: { stickers: 25, hearts: 15 } },
                            { id: 'growing_family', name: 'Growing Family', desc: 'Collect 3 critters', emoji: 'üë®‚Äçüë©‚Äçüëß', target: 3, reward: { stickers: 75, hearts: 50 } },
                            { id: 'critter_squad', name: 'Critter Squad', desc: 'Collect 5 critters', emoji: 'üë•', target: 5, reward: { stickers: 150, hearts: 100 } },
                            { id: 'legendary_collector', name: 'Legendary Collector', desc: 'Collect all 8 basic critters', emoji: 'üèÜ', target: 8, reward: { stickers: 500, hearts: 300, specialCritter: 'rainbow' } },
                            { id: 'evolution_master', name: 'Evolution Master', desc: 'Evolve a critter to legendary stage', emoji: '‚ú®', reward: { stickers: 200, hearts: 150 } },
                            { id: 'breeding_pioneer', name: 'Breeding Pioneer', desc: 'Successfully breed your first hybrid critter', emoji: 'üß¨', reward: { stickers: 300, hearts: 200 } }
                        ]
                    },
                    exploration: {
                        name: 'World Explorer',
                        emoji: 'üó∫Ô∏è',
                        achievements: [
                            { id: 'first_steps', name: 'First Steps', desc: 'Take 100 steps', emoji: 'üë£', target: 100, reward: { stickers: 20, hearts: 10 } },
                            { id: 'wanderer', name: 'Wanderer', desc: 'Take 1000 steps', emoji: 'üö∂', target: 1000, reward: { stickers: 100, hearts: 50 } },
                            { id: 'explorer', name: 'Explorer', desc: 'Visit all 6 locations', emoji: 'üß≠', target: 6, reward: { stickers: 150, hearts: 75 } },
                            { id: 'treasure_hunter', name: 'Treasure Hunter', desc: 'Interact with 50 objects', emoji: 'üíé', target: 50, reward: { stickers: 200, hearts: 100 } },
                            { id: 'social_butterfly', name: 'Social Butterfly', desc: 'Talk to all NPCs', emoji: 'ü¶ã', target: 5, reward: { stickers: 100, hearts: 75 } },
                            { id: 'world_master', name: 'World Master', desc: 'Discover all secrets in every location', emoji: 'üåç', reward: { stickers: 500, hearts: 300, specialLocation: 'secret_garden' } }
                        ]
                    },
                    social: {
                        name: 'Social Star',
                        emoji: '‚≠ê',
                        achievements: [
                            { id: 'friendly_hello', name: 'Friendly Hello', desc: 'Greet 5 NPCs', emoji: 'üëã', target: 5, reward: { stickers: 30, hearts: 20 } },
                            { id: 'helper', name: 'Helper', desc: 'Help friends 10 times', emoji: 'ü§ù', target: 10, reward: { stickers: 100, hearts: 75 } },
                            { id: 'party_planner', name: 'Party Planner', desc: 'Organize a critter party', emoji: 'üéâ', reward: { stickers: 200, hearts: 150 } },
                            { id: 'friendship_master', name: 'Friendship Master', desc: 'Max friendship with all NPCs', emoji: 'üíï', reward: { stickers: 300, hearts: 200, specialCritter: 'cupid' } }
                        ]
                    },
                    special: {
                        name: 'Special Moments',
                        emoji: 'üåü',
                        achievements: [
                            { id: 'daily_player', name: 'Daily Player', desc: 'Play for 7 consecutive days', emoji: 'üìÖ', target: 7, reward: { stickers: 100, hearts: 100 } },
                            { id: 'speed_learner', name: 'Speed Learner', desc: 'Complete 5 activities in 5 minutes', emoji: '‚ö°', target: 5, reward: { stickers: 150, hearts: 100 } },
                            { id: 'perfectionist', name: 'Perfectionist', desc: 'Get perfect scores on 20 activities', emoji: 'üíØ', target: 20, reward: { stickers: 250, hearts: 200 } },
                            { id: 'night_owl', name: 'Night Owl', desc: 'Play during evening hours', emoji: 'ü¶â', reward: { stickers: 50, hearts: 30 } },
                            { id: 'early_bird', name: 'Early Bird', desc: 'Play during morning hours', emoji: 'üê¶', reward: { stickers: 50, hearts: 30 } },
                            { id: 'ultimate_master', name: 'Ultimate Master', desc: 'Unlock all achievements', emoji: 'üëë', reward: { stickers: 1000, hearts: 1000, specialCritter: 'cosmic', specialLocation: 'rainbow_realm' } }
                        ]
                    }
                }
            },
            storyMode: {
                currentChapter: 1,
                unlockedChapters: [1],
                completedChapters: [],
                chapters: {
                    1: {
                        id: 1,
                        title: 'Welcome to Eucalyptus Grove',
                        description: 'Koko arrives in a magical world full of learning adventures!',
                        emoji: 'üå≥',
                        scenes: [
                            { id: 1, title: 'A New Beginning', content: 'Welcome to Eucalyptus Grove, where learning is the greatest adventure!', choices: ['Start exploring!', 'Learn about the world'], rewards: { stickers: 10 } },
                            { id: 2, title: 'Meeting Friends', content: 'You discover other critters who love to learn just like you!', choices: ['Make friends', 'Explore alone'], rewards: { hearts: 15 } },
                            { id: 3, title: 'First Lesson', content: 'Time for your first educational adventure!', choices: ['Math challenge', 'Reading adventure'], rewards: { xp: 50 } }
                        ],
                        unlockRequirement: null,
                        rewards: { stickers: 100, hearts: 50, newCritter: 'bella' }
                    },
                    2: {
                        id: 2,
                        title: 'The Mystery of the Missing Colors',
                        description: 'Help restore color to the world through creative learning!',
                        emoji: 'üåà',
                        scenes: [
                            { id: 1, title: 'A Gray World', content: 'Oh no! All the colors have disappeared from Eucalyptus Grove!', choices: ['Investigate', 'Ask for help'], rewards: { stickers: 15 } },
                            { id: 2, title: 'The Color Crystals', content: 'You discover that learning activities can restore the magical color crystals!', choices: ['Start collecting', 'Learn more'], rewards: { hearts: 20 } },
                            { id: 3, title: 'Rainbow Restoration', content: 'With enough learning, you bring back all the beautiful colors!', choices: ['Celebrate', 'Help others'], rewards: { xp: 100 } }
                        ],
                        unlockRequirement: 'Complete Chapter 1',
                        rewards: { stickers: 200, hearts: 100, newLocation: 'rainbow_valley' }
                    },
                    3: {
                        id: 3,
                        title: 'The Great Knowledge Quest',
                        description: 'Embark on an epic journey to find the legendary Wisdom Tree!',
                        emoji: 'üå≤',
                        scenes: [
                            { id: 1, title: 'The Ancient Map', content: 'You find a mysterious map leading to the Wisdom Tree!', choices: ['Follow the map', 'Study it first'], rewards: { stickers: 20 } },
                            { id: 2, title: 'Trials of Learning', content: 'The path is guarded by educational challenges!', choices: ['Accept the challenge', 'Find another way'], rewards: { hearts: 25 } },
                            { id: 3, title: 'The Wisdom Tree', content: 'You reach the magnificent tree that grants ultimate knowledge!', choices: ['Make a wish', 'Share with friends'], rewards: { xp: 200 } }
                        ],
                        unlockRequirement: 'Collect 3 critters',
                        rewards: { stickers: 500, hearts: 300, newCritter: 'luna', specialAbility: 'wisdom_boost' }
                    }
                },
                currentScene: { chapter: 1, scene: 1 },
                choices: [],
                storyProgress: {}
            }
        };

        // Cute Educational Content
        const cuteEducationalContent = {
            math: [
                {
                    title: "üç™ Koko's Cookie Counting",
                    question: "Koko baked 12 yummy cookies! He gave 3 to his friend and ate 2 himself. How many cookies are left?",
                    visual: "üç™".repeat(12),
                    answers: [7, 8, 9, 10],
                    correct: 0,
                    explanation: "12 - 3 - 2 = 7 cookies left!",
                    bonus: "Great counting! Koko is so proud! üåü"
                },
                {
                    title: "üéà Balloon Party Math",
                    question: "At Koko's party, there are 5 red balloons and 4 blue balloons. How many balloons in total?",
                    visual: "üéà".repeat(9),
                    answers: [9, 8, 10, 11],
                    correct: 0,
                    explanation: "5 + 4 = 9 balloons for the party!",
                    bonus: "Perfect addition! Party time! üéâ"
                },
                {
                    title: "üß∏ Toy Sharing Fun",
                    question: "Koko has 20 toys and wants to share them equally among 4 friends. How many toys does each friend get?",
                    visual: "üß∏".repeat(20),
                    answers: [5, 4, 6, 3],
                    correct: 0,
                    explanation: "20 √∑ 4 = 5 toys for each friend!",
                    bonus: "Amazing division! Sharing is caring! üíï"
                },
                {
                    title: "‚≠ê Star Pattern Math",
                    question: "Koko sees a pattern: 2, 4, 6, 8... What comes next?",
                    visual: "‚≠ê‚≠ê ‚≠ê‚≠ê‚≠ê‚≠ê ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê",
                    answers: [10, 9, 12, 11],
                    correct: 0,
                    explanation: "The pattern adds 2 each time: 2, 4, 6, 8, 10!",
                    bonus: "Pattern master! Koko loves your smart thinking! üß†"
                }
            ],
            science: [
                {
                    title: "üå± Koko's Garden Science",
                    question: "What do plants need to grow big and strong like Koko's flowers?",
                    visual: "üå±üåûüíß",
                    answers: ["Sunlight and water", "Only candy", "Just hugs", "TV and games"],
                    correct: 0,
                    explanation: "Plants need sunlight and water to grow healthy and beautiful!",
                    bonus: "You're a nature expert! Koko's garden will be amazing! üå∫"
                },
                {
                    title: "üåà Rainbow Science",
                    question: "When does Koko see beautiful rainbows in the sky?",
                    visual: "üåà‚òÄÔ∏èüåßÔ∏è",
                    answers: ["When it's sunny and rainy", "Only at night", "When it's very cold", "Only in winter"],
                    correct: 0,
                    explanation: "Rainbows appear when sunlight shines through raindrops!",
                    bonus: "Rainbow scientist! Koko loves colorful discoveries! üé®"
                },
                {
                    title: "ü¶ã Butterfly Life Cycle",
                    question: "What does a caterpillar become when it grows up?",
                    visual: "üêõ‚û°Ô∏èüõ°Ô∏è‚û°Ô∏èü¶ã",
                    answers: ["A beautiful butterfly", "A bigger caterpillar", "A bird", "A flower"],
                    correct: 0,
                    explanation: "Caterpillars transform into beautiful butterflies!",
                    bonus: "Nature expert! Koko loves learning about animals! ü¶ã"
                }
            ],
            reading: [
                {
                    title: "üìö Koko's Story Time",
                    question: "Koko read: 'The little bunny was very kind and shared his carrots with all his friends.' What was special about the bunny?",
                    visual: "üê∞ü•ïüìñ",
                    answers: ["He was kind and shared", "He was very fast", "He was big and strong", "He liked to sleep"],
                    correct: 0,
                    explanation: "The bunny was special because he was kind and liked to share!",
                    bonus: "Great reading! Koko loves stories about kindness! üíï"
                },
                {
                    title: "üè† Koko's Adventure",
                    question: "In the story, Koko went to the park, then the library, then home. Where did he go second?",
                    visual: "üè†‚û°Ô∏èüå≥‚û°Ô∏èüìö‚û°Ô∏èüè†",
                    answers: ["The library", "The park", "Home", "The store"],
                    correct: 0,
                    explanation: "Koko went to the park first, then the library second!",
                    bonus: "Excellent memory! You follow stories perfectly! üìñ"
                },
                {
                    title: "üé≠ Feeling Words",
                    question: "When Koko's friend gave him a big hug, how do you think Koko felt?",
                    visual: "ü§óüíïüòä",
                    answers: ["Happy and loved", "Sad and lonely", "Angry and mad", "Scared and worried"],
                    correct: 0,
                    explanation: "Hugs make us feel happy and loved!",
                    bonus: "Emotion expert! Koko loves your understanding heart! ‚ù§Ô∏è"
                }
            ],
            creativity: [
                {
                    title: "üé® Color Mixing Magic",
                    question: "If Koko mixes red paint and yellow paint, what color will he make?",
                    visual: "üî¥‚ûïüü°‚û°Ô∏è‚ùì",
                    answers: ["Orange", "Purple", "Green", "Blue"],
                    correct: 0,
                    explanation: "Red + Yellow = Orange! Like a beautiful sunset!",
                    bonus: "Color artist! Koko wants to paint with you! üé®"
                },
                {
                    title: "üéµ Music Patterns",
                    question: "Koko claps a rhythm: CLAP-clap-CLAP-clap. What comes next?",
                    visual: "üëèüëèüëèüëè",
                    answers: ["CLAP", "clap", "silence", "stomp"],
                    correct: 0,
                    explanation: "The pattern is loud-soft-loud-soft, so CLAP comes next!",
                    bonus: "Music master! Koko loves making rhythms with you! üéµ"
                }
            ]
        };

        // Achievement System
        const achievementSystem = {
            achievements: [
                { id: 'first_click', name: 'First Friend', description: 'Click Koko for the first time!', emoji: 'üëã', unlocked: false, reward: { stickers: 10 } },
                { id: 'combo_master', name: 'Combo Master', description: 'Get a 5x combo!', emoji: 'üî•', unlocked: false, reward: { hearts: 20 } },
                { id: 'learning_star', name: 'Learning Star', description: 'Complete 5 educational challenges!', emoji: '‚≠ê', unlocked: false, reward: { toys: 5 } },
                { id: 'daily_player', name: 'Daily Player', description: 'Play for 7 days in a row!', emoji: 'üìÖ', unlocked: false, reward: { stickers: 50 } },
                { id: 'toy_collector', name: 'Toy Collector', description: 'Collect 50 toys!', emoji: 'üß∏', unlocked: false, reward: { treats: 30 } },
                { id: 'love_master', name: 'Love Master', description: 'Reach 1000 love points!', emoji: 'üíï', unlocked: false, reward: { hearts: 100 } },
                { id: 'rainbow_finder', name: 'Rainbow Finder', description: 'Trigger a Rainbow Shower event!', emoji: 'üåà', unlocked: false, reward: { stickers: 25 } },
                { id: 'emotion_expert', name: 'Emotion Expert', description: 'Make Koko ecstatic 10 times!', emoji: 'üòç', unlocked: false, reward: { love: 200 } },
                { id: 'mini_game_pro', name: 'Mini-Game Pro', description: 'Score 100+ in any mini-game!', emoji: 'üéÆ', unlocked: false, reward: { toys: 10 } },
                { id: 'collection_master', name: 'Collection Master', description: 'Complete any collection!', emoji: 'üèÜ', unlocked: false, reward: { stickers: 100, hearts: 50, treats: 25 } }
            ],
            
            checkAchievement: function(id, condition) {
                const achievement = this.achievements.find(a => a.id === id);
                if (achievement && !achievement.unlocked && condition) {
                    achievement.unlocked = true;
                    cuteGameState.unlockedAchievements.push(achievement);
                    showAchievementUnlock(achievement);
                    this.giveReward(achievement.reward);
                }
            },
            
            giveReward: function(reward) {
                Object.keys(reward).forEach(resource => {
                    if (cuteGameState.resources[resource] !== undefined) {
                        cuteGameState.resources[resource] += reward[resource];
                    } else if (cuteGameState.player[resource] !== undefined) {
                        cuteGameState.player[resource] += reward[resource];
                    }
                });
            }
        };

        // Daily Challenge System
        const dailyChallengeSystem = {
            challenges: [
                { id: 'click_master', name: 'Click Master', description: 'Click Koko 50 times today!', target: 50, progress: 0, reward: { stickers: 30, hearts: 15 } },
                { id: 'learning_day', name: 'Learning Day', description: 'Complete 3 educational challenges!', target: 3, progress: 0, reward: { toys: 8, treats: 20 } },
                { id: 'combo_champion', name: 'Combo Champion', description: 'Get a 10x combo!', target: 10, progress: 0, reward: { stickers: 50, love: 100 } },
                { id: 'toy_hunter', name: 'Toy Hunter', description: 'Find 15 toys today!', target: 15, progress: 0, reward: { hearts: 25, treats: 15 } },
                { id: 'mood_booster', name: 'Mood Booster', description: 'Keep Koko happy for 30 interactions!', target: 30, progress: 0, reward: { love: 150, stickers: 40 } },
                { id: 'explorer', name: 'Explorer', description: 'Visit all 6 locations!', target: 6, progress: 0, reward: { toys: 12, hearts: 30 } },
                { id: 'special_finder', name: 'Special Finder', description: 'Trigger 3 special events!', target: 3, progress: 0, reward: { stickers: 75, treats: 25 } }
            ],
            
            generateDaily: function() {
                const today = new Date().toDateString();
                if (cuteGameState.lastDailyReset !== today) {
                    cuteGameState.lastDailyReset = today;
                    cuteGameState.dailyChallenge = this.challenges[Math.floor(Math.random() * this.challenges.length)];
                    cuteGameState.dailyChallenge.progress = 0;
                    showDailyChallenge();
                }
            },
            
            updateProgress: function(type, amount = 1) {
                if (!cuteGameState.dailyChallenge) return;
                
                const challenge = cuteGameState.dailyChallenge;
                if (challenge.id.includes(type)) {
                    challenge.progress = Math.min(challenge.progress + amount, challenge.target);
                    updateDailyChallengeDisplay();
                    
                    if (challenge.progress >= challenge.target) {
                        this.completeDaily();
                    }
                }
            },
            
            completeDaily: function() {
                const challenge = cuteGameState.dailyChallenge;
                showCuteAchievement('Daily Challenge Complete!', `üéâ ${challenge.name} completed! Amazing work!`);
                achievementSystem.giveReward(challenge.reward);
                cuteGameState.dailyStreak++;
                cuteGameState.dailyChallenge = null;
                
                // Check daily streak achievement
                achievementSystem.checkAchievement('daily_player', cuteGameState.dailyStreak >= 7);
            }
        };

        // Mini-Game System
        const miniGameSystem = {
            currentGame: null,
            
            startMemoryMatch: function() {
                this.currentGame = 'memory';
                showMiniGame('Memory Match', 'Remember the pattern!', this.memoryMatchGame);
            },
            
            startColorMixer: function() {
                this.currentGame = 'color';
                showMiniGame('Color Mixer', 'Mix colors to match the target!', this.colorMixerGame);
            },
            
            startRhythmGame: function() {
                this.currentGame = 'rhythm';
                showMiniGame('Rhythm Master', 'Follow the beat!', this.rhythmGame);
            },
            
            memoryMatchGame: function() {
                const patterns = ['üåü', 'üíñ', 'üç™', 'üß∏', 'üéà', 'üåà'];
                let sequence = [];
                let playerSequence = [];
                let level = 1;
                let score = 0;
                
                function nextLevel() {
                    sequence.push(patterns[Math.floor(Math.random() * patterns.length)]);
                    showSequence();
                }
                
                function showSequence() {
                    // Visual sequence display logic would go here
                    showCuteEffect(`Level ${level}: Watch the pattern!`, 'sparkle-effect');
                }
                
                nextLevel();
                return { score: score, complete: false };
            },
            
            colorMixerGame: function() {
                const colors = { red: 'üî¥', blue: 'üîµ', yellow: 'üü°' };
                const targets = ['üü†', 'üü¢', 'üü£']; // orange, green, purple
                let score = 0;
                
                showCuteEffect('Mix red + yellow = orange!', 'happy-effect');
                return { score: score, complete: false };
            },
            
            rhythmGame: function() {
                const beats = ['üëè', 'üéµ', 'üé∂', 'üé§'];
                let score = 0;
                
                showCuteEffect('Clap to the beat!', 'sparkle-effect');
                return { score: score, complete: false };
            }
        };

        // Interact with Koko
        function interactWithKoko() {
            const koala = document.getElementById('cuteKoala');
            
            // Check first click achievement
            achievementSystem.checkAchievement('first_click', cuteGameState.comboCount === 0);
            
            // Enhanced bounce animation with random variations
            const animations = ['koalaBounce 1s ease', 'koalaWiggle 1s ease', 'koalaSpin 1s ease'];
            koala.style.animation = 'none';
            koala.offsetHeight;
            koala.style.animation = animations[Math.floor(Math.random() * animations.length)];
            
            // Calculate cute rewards with combo system
            const baseXP = 25;
            const comboMultiplier = Math.min(cuteGameState.comboCount * 0.1 + 1, 3);
            const xpGain = Math.floor((baseXP + Math.random() * 15) * comboMultiplier);
            const stickerGain = Math.floor((5 + Math.random() * 10) * comboMultiplier);
            const loveGain = Math.floor((8 + Math.random() * 12) * comboMultiplier);
            
            // Increment combo
            cuteGameState.comboCount++;
            cuteGameState.lastInteraction = Date.now();
            
            // Update daily challenge progress
            dailyChallengeSystem.updateProgress('click');
            
            // Check combo achievements
            achievementSystem.checkAchievement('combo_master', cuteGameState.comboCount >= 5);
            
            // Update resources
            cuteGameState.player.xp += xpGain;
            cuteGameState.player.love += loveGain;
            cuteGameState.resources.stickers += stickerGain;
            
            // Check resource achievements
            achievementSystem.checkAchievement('love_master', cuteGameState.player.love >= 1000);
            achievementSystem.checkAchievement('toy_collector', getTotalToys() >= 50);
            
            // Show enhanced floating effects
            if (cuteGameState.comboCount > 1) {
                showCuteEffect(`${cuteGameState.comboCount}x COMBO!`, "sparkle-effect");
            }
            showCuteEffect(`+${xpGain} XP`, "sparkle-effect");
            showCuteEffect(`+${stickerGain} Stickers`, "happy-effect");
            showCuteEffect(`+${loveGain} Love`, "love-effect");
            
            // Random special events
            if (Math.random() < 0.15) {
                triggerSpecialEvent();
                dailyChallengeSystem.updateProgress('special');
            }
            
            // Random toy drops with better chances
            if (Math.random() < 0.4) {
                const randomToy = cuteGameState.toyBox[Math.floor(Math.random() * cuteGameState.toyBox.length)];
                randomToy.quantity += 1;
                showCuteEffect(`Found ${randomToy.emoji}!`, "cute-effect");
                playToyFoundSound();
                dailyChallengeSystem.updateProgress('toy');
            }
            
            // Random mini-game triggers
            if (Math.random() < 0.08) {
                setTimeout(() => triggerRandomMiniGame(), 1000);
            }
            
            // Check for level up
            if (cuteGameState.player.xp >= cuteGameState.player.xpToNext) {
                levelUpCute();
            }
            
            // Random learning challenge with better rewards
            if (Math.random() < 0.18) {
                setTimeout(() => showCuteChallenge(), 500);
            }
            
            // Update Koko's mood based on interaction
            updateKokoMood();
            
            // Check emotion achievement
            if (cuteGameState.koala.mood === 'ecstatic') {
                cuteGameState.koala.ecstaticCount = (cuteGameState.koala.ecstaticCount || 0) + 1;
                achievementSystem.checkAchievement('emotion_expert', cuteGameState.koala.ecstaticCount >= 10);
            }
            
            updateCuteDisplay();
            createEnhancedHeartEffect();
            
            // Play interaction sound
            playInteractionSound();
            
            // Update collections randomly
            updateCollections();
        }

        // Level up system
        function levelUpCute() {
            cuteGameState.player.level++;
            cuteGameState.player.xp -= cuteGameState.player.xpToNext;
            cuteGameState.player.xpToNext = Math.floor(cuteGameState.player.xpToNext * 1.2);
            
            // Increase all stats
            cuteGameState.stats.health = Math.min(100, cuteGameState.stats.health + 5);
            cuteGameState.stats.energy = Math.min(100, cuteGameState.stats.energy + 5);
            cuteGameState.stats.happiness = Math.min(100, cuteGameState.stats.happiness + 5);
            cuteGameState.stats.love = Math.min(100, cuteGameState.stats.love + 5);
            
            // Level up activities
            Object.keys(cuteGameState.activities).forEach(activity => {
                if (Math.random() < 0.3) {
                    cuteGameState.activities[activity].level++;
                    cuteGameState.activities[activity].loveGain += 2;
                }
            });
            
            showCuteEffect("LEVEL UP!", "happy-effect");
            showCuteAchievement("Level Up!", `Koko reached Level ${cuteGameState.player.level}! üéâ`);
        }

        // Do cute activities
        function doCuteActivity(activityName) {
            const activity = cuteGameState.activities[activityName];
            
            if (activity.cooldown > 0) {
                showCuteEffect("Wait a little bit!", "cute-effect");
                return;
            }
            
            // Activity effects
            const loveGain = activity.loveGain + Math.floor(Math.random() * 10);
            const stickerGain = Math.floor(activity.level * 2) + Math.floor(Math.random() * 5);
            
            cuteGameState.player.love += loveGain;
            cuteGameState.resources.stickers += stickerGain;
            
            // Activity-specific effects
            switch(activityName) {
                case 'play':
                    showCuteEffect(`üéÆ +${loveGain} Love from playing!`, "love-effect");
                    cuteGameState.stats.happiness = Math.min(100, cuteGameState.stats.happiness + 8);
                    break;
                case 'hug':
                    showCuteEffect(`ü§ó +${loveGain} Love from hugs!`, "love-effect");
                    cuteGameState.stats.love = Math.min(100, cuteGameState.stats.love + 15);
                    break;
                case 'dance':
                    showCuteEffect(`üíÉ +${loveGain} Love from dancing!`, "love-effect");
                    cuteGameState.stats.energy = Math.min(100, cuteGameState.stats.energy + 10);
                    break;
                case 'sing':
                    showCuteEffect(`üéµ +${loveGain} Love from singing!`, "love-effect");
                    cuteGameState.stats.happiness = Math.min(100, cuteGameState.stats.happiness + 12);
                    break;
                case 'learn':
                    showCuteEffect(`üìö +${loveGain} Love from learning!`, "love-effect");
                    setTimeout(() => showCuteChallenge(), 1000);
                    break;
                case 'magic':
                    showCuteEffect(`ü™Ñ +${loveGain} Love from magic!`, "love-effect");
                    cuteGameState.resources.hearts += 3;
                    break;
            }
            
            // Set cooldown
            activity.cooldown = 5 + activity.level;
            startCuteCooldown(activityName);
            
            updateCuteDisplay();
        }

        // Start activity cooldown
        function startCuteCooldown(activityName) {
            const cooldownElement = document.getElementById(`${activityName}-cooldown`);
            const button = cooldownElement.parentElement;
            
            button.classList.remove('ready');
            cooldownElement.style.display = 'flex';
            cooldownElement.textContent = cuteGameState.activities[activityName].cooldown;
            
            const interval = setInterval(() => {
                cuteGameState.activities[activityName].cooldown--;
                cooldownElement.textContent = cuteGameState.activities[activityName].cooldown;
                
                if (cuteGameState.activities[activityName].cooldown <= 0) {
                    cooldownElement.style.display = 'none';
                    button.classList.add('ready');
                    clearInterval(interval);
                }
            }, 1000);
        }

        // Show cute educational challenge
        function showCuteChallenge() {
            const subjects = Object.keys(cuteEducationalContent);
            const randomSubject = subjects[Math.floor(Math.random() * subjects.length)];
            const challenges = cuteEducationalContent[randomSubject];
            const challenge = challenges[Math.floor(Math.random() * challenges.length)];
            
            const overlay = document.getElementById('challengeOverlay');
            const panel = document.getElementById('challengePanel');
            
            panel.innerHTML = `
                <div class="challenge-title">${challenge.title}</div>
                <div class="challenge-content">Help Koko solve this fun puzzle!</div>
                <div class="challenge-area">
                    <div class="challenge-visual">${challenge.visual}</div>
                    <div class="challenge-question">${challenge.question}</div>
                    <div class="answer-grid">
                        ${challenge.answers.map((answer, index) => 
                            `<button class="answer-button" onclick="answerCuteChallenge(${index}, ${challenge.correct}, '${challenge.explanation}', '${challenge.bonus}')">${answer}</button>`
                        ).join('')}
                    </div>
                </div>
                <div style="margin-top: 10px; font-size: 10px; color: #8B008B;">
                    Correct answers make Koko super happy! üåü
                </div>
            `;
            
            overlay.style.display = 'flex';
        }

        // Answer cute challenge
        function answerCuteChallenge(selected, correct, explanation, bonus) {
            const isCorrect = selected === correct;
            const buttons = document.querySelectorAll('.answer-button');
            
            buttons.forEach((button, index) => {
                if (index === correct) {
                    button.classList.add('correct');
                } else if (index === selected && !isCorrect) {
                    button.classList.add('incorrect');
                }
                button.disabled = true;
            });
            
            setTimeout(() => {
                if (isCorrect) {
                    // Big rewards for correct answers
                    const xpBonus = 100 + (cuteGameState.player.level * 10);
                    const stickerBonus = 50 + (cuteGameState.player.level * 5);
                    const loveBonus = 25 + (cuteGameState.player.level * 3);
                    
                    cuteGameState.player.xp += xpBonus;
                    cuteGameState.resources.stickers += stickerBonus;
                    cuteGameState.player.love += loveBonus;
                    cuteGameState.resources.hearts += 5;
                    
                    showCuteAchievement("AMAZING!", `${bonus}\n+${xpBonus} XP, +${stickerBonus} Stickers, +${loveBonus} Love!`);
                } else {
                    // Consolation rewards
                    const xpBonus = 25;
                    const stickerBonus = 10;
                    
                    cuteGameState.player.xp += xpBonus;
                    cuteGameState.resources.stickers += stickerBonus;
                    
                    showCuteAchievement("Good Try!", `${explanation}\n+${xpBonus} XP, +${stickerBonus} Stickers for trying!`);
                }
                
                setTimeout(() => {
                    document.getElementById('challengeOverlay').style.display = 'none';
                    updateCuteDisplay();
                }, 3000);
            }, 2000);
        }

        // Switch game modes
        function switchMode(mode) {
            cuteGameState.currentMode = mode;
            
            // Update tab appearance
            document.querySelectorAll('.mode-tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById(mode + 'Tab').classList.add('active');
            
            // Mode-specific changes
            switch(mode) {
                case 'play':
                    showCuteEffect("Play Time! üéà", "happy-effect");
                    break;
                case 'care':
                    showCuteEffect("Care Time! üíï", "love-effect");
                    break;
                case 'friends':
                    showCuteEffect("Friend Time! üë´", "sparkle-effect");
                    break;
            }
        }

        // Visit cute places
        function visitCutePlace(place) {
            switch(place) {
                case 'playground':
                    showCuteEffect("Playing at the playground! üõù", "happy-effect");
                    setTimeout(() => showCuteChallenge(), 1000);
                    break;
                case 'library':
                    showCuteEffect("Reading time! üìö", "sparkle-effect");
                    setTimeout(() => showCuteChallenge(), 1000);
                    break;
                case 'school':
                    showCuteEffect("Learning is fun! üè´", "cute-effect");
                    setTimeout(() => showCuteChallenge(), 1000);
                    break;
                case 'shop':
                    showCuteEffect("Toy shop coming soon! üè™", "happy-effect");
                    break;
                default:
                    showCuteEffect(`Visiting ${place}! üåü`, "sparkle-effect");
                    break;
            }
        }

        // Show cute floating effects
        function showCuteEffect(text, className) {
            const effect = document.createElement('div');
            effect.className = `floating-effect ${className}`;
            effect.textContent = text;
            effect.style.left = (Math.random() * 200 + 100) + 'px';
            effect.style.top = (Math.random() * 100 + 200) + 'px';
            
            document.querySelector('.game-screen').appendChild(effect);
            
            setTimeout(() => {
                if (effect.parentNode) {
                    effect.parentNode.removeChild(effect);
                }
            }, 2000);
        }

        // Show cute achievement popup
        function showCuteAchievement(title, description) {
            const achievement = document.createElement('div');
            achievement.className = 'achievement-popup';
            achievement.innerHTML = `üèÜ ${title}<br><small>${description}</small>`;
            
            document.querySelector('.game-screen').appendChild(achievement);
            
            setTimeout(() => {
                if (achievement.parentNode) {
                    achievement.parentNode.removeChild(achievement);
                }
            }, 4000);
        }

        // Create heart effects
        function createHeartEffect() {
            const heartSystem = document.getElementById('heartSystem');
            
            for (let i = 0; i < 5; i++) {
                const heart = document.createElement('div');
                heart.className = 'floating-heart';
                
                const hearts = ['üíï', 'üíñ', 'üíó', 'üíù', 'üíò', 'üíû'];
                heart.textContent = hearts[Math.floor(Math.random() * hearts.length)];
                
                heart.style.left = Math.random() * 100 + '%';
                heart.style.top = Math.random() * 100 + '%';
                heart.style.animationDelay = Math.random() * 3 + 's';
                heart.style.animationDuration = (Math.random() * 2 + 2) + 's';
                
                heartSystem.appendChild(heart);
                
                setTimeout(() => {
                    if (heart.parentNode) {
                        heart.parentNode.removeChild(heart);
                    }
                }, 5000);
            }
        }

        // Initialize toy box
        function initializeToyBox() {
            const toyGrid = document.getElementById('toyGrid');
            toyGrid.innerHTML = '';
            
            for (let i = 0; i < 9; i++) {
                const slot = document.createElement('div');
                slot.className = 'toy-slot';
                
                if (i < cuteGameState.toyBox.length) {
                    const toy = cuteGameState.toyBox[i];
                    slot.classList.add('has-toy');
                    slot.textContent = toy.emoji;
                    slot.title = `${toy.name} (${toy.quantity})`;
                    
                    if (toy.quantity > 1) {
                        const quantity = document.createElement('div');
                        quantity.className = 'toy-quantity';
                        quantity.textContent = toy.quantity > 99 ? '99+' : toy.quantity;
                        slot.appendChild(quantity);
                    }
                }
                
                toyGrid.appendChild(slot);
            }
        }

        // Helper functions
        function showKoalaMenu() {
            showCuteEffect("Koko menu coming soon! üê®", "cute-effect");
        }

        function showResourceDetails(resource) {
            showCuteEffect(`${resource} details coming soon! ‚ú®`, "sparkle-effect");
        }

        function openParentDashboard() {
            showCuteEffect("Parent info coming soon! üë®‚Äçüë©‚Äçüëß‚Äçüë¶", "happy-effect");
        }

        // Update cute display
        function updateCuteDisplay() {
            // Update level and XP
            document.getElementById('levelBadge').textContent = `Level ${cuteGameState.player.level} ‚≠ê`;
            document.getElementById('xpFill').style.width = `${(cuteGameState.player.xp / cuteGameState.player.xpToNext) * 100}%`;
            document.getElementById('xpText').textContent = `${cuteGameState.player.xp} / ${cuteGameState.player.xpToNext}`;
            
            // Update resources
            document.getElementById('stickerAmount').textContent = cuteGameState.resources.stickers;
            document.getElementById('heartAmount').textContent = cuteGameState.resources.hearts;
            document.getElementById('treatAmount').textContent = cuteGameState.resources.treats;
            document.getElementById('toyAmount').textContent = cuteGameState.resources.toys;
            
            // Update stats
            document.getElementById('healthFill').style.width = `${cuteGameState.stats.health}%`;
            document.getElementById('energyFill').style.width = `${cuteGameState.stats.energy}%`;
            document.getElementById('happinessFill').style.width = `${cuteGameState.stats.happiness}%`;
            document.getElementById('loveFill').style.width = `${cuteGameState.stats.love}%`;
            
            // Update love progress
            document.getElementById('loveFillBar').style.width = `${(cuteGameState.player.love / cuteGameState.player.loveToNext) * 100}%`;
            document.getElementById('loveText').textContent = `Love: ${cuteGameState.player.love} / ${cuteGameState.player.loveToNext} üíï`;
            
            // Update koala status
            document.getElementById('koalaStatus').textContent = `Koko is ${cuteGameState.koala.mood}! üåà`;
            document.getElementById('koalaTitle').textContent = `${cuteGameState.koala.name} the Super Cute Koala ‚Ä¢ Level ${cuteGameState.player.level}`;
        }

        // Keyboard controls
        document.addEventListener('keydown', (event) => {
            const key = event.key;
            
            // Activity hotkeys
            if (key >= '1' && key <= '6') {
                const activities = ['play', 'hug', 'dance', 'sing', 'learn', 'magic'];
                const activityIndex = parseInt(key) - 1;
                if (activities[activityIndex]) {
                    doCuteActivity(activities[activityIndex]);
                }
            }
            
            // Mode switching
            if (key.toLowerCase() === 'q') switchMode('play');
            if (key.toLowerCase() === 'w') switchMode('care');
            if (key.toLowerCase() === 'e') switchMode('friends');
        });

        // Initialize cute game
        function initializeCuteGame() {
            updateCuteDisplay();
            initializeToyBox();
            
            // Auto-regeneration
            setInterval(() => {
                cuteGameState.stats.energy = Math.min(100, cuteGameState.stats.energy + 2);
                cuteGameState.stats.happiness = Math.min(100, cuteGameState.stats.happiness + 1);
                updateCuteDisplay();
            }, 5000);
            
            // Random cute events
            setInterval(() => {
                if (Math.random() < 0.08) {
                    const events = [
                        { message: "Koko found a shiny sticker! ‚ú®", stickers: 10 },
                        { message: "A friend gave Koko a hug! ü§ó", love: 15 },
                        { message: "Koko learned something new! üìö", xp: 50 },
                        { message: "Koko found a yummy treat! üç™", treats: 5 },
                        { message: "Koko feels extra happy! üòä", happiness: 10 }
                    ];
                    
                    const event = events[Math.floor(Math.random() * events.length)];
                    
                    Object.keys(event).forEach(key => {
                        if (key !== 'message') {
                            if (key === 'xp') cuteGameState.player.xp += event[key];
                            else if (key === 'love') cuteGameState.player.love += event[key];
                            else if (key === 'happiness') cuteGameState.stats.happiness = Math.min(100, cuteGameState.stats.happiness + event[key]);
                            else if (cuteGameState.resources[key] !== undefined) {
                                cuteGameState.resources[key] += event[key];
                            }
                        }
                    });
                    
                    showCuteEffect(event.message, "sparkle-effect");
                    updateCuteDisplay();
                }
            }, 15000);
            
            // Welcome message
            setTimeout(() => {
                showCuteAchievement("Welcome!", "Koko is so happy to see you! Let's play together! üê®üíï");
            }, 1000);
        }

        // New Fun Functions

        // Trigger special events
        function triggerSpecialEvent() {
            const events = [
                {
                    name: "Rainbow Shower",
                    message: "üåà A magical rainbow appears! Everything sparkles!",
                    effect: () => {
                        cuteGameState.resources.stickers += 50;
                        cuteGameState.resources.hearts += 10;
                        createRainbowEffect();
                    }
                },
                {
                    name: "Toy Explosion",
                    message: "üéÅ Toy explosion! Koko found lots of toys!",
                    effect: () => {
                        cuteGameState.toyBox.forEach(toy => toy.quantity += Math.floor(Math.random() * 3) + 1);
                        createToyExplosion();
                    }
                },
                {
                    name: "Love Burst",
                    message: "üíï Love burst! Koko feels extra loved!",
                    effect: () => {
                        cuteGameState.player.love += 100;
                        cuteGameState.stats.happiness = 100;
                        createLoveBurst();
                    }
                },
                {
                    name: "Super Learning",
                    message: "üß† Brain boost! Learning is super fun right now!",
                    effect: () => {
                        setTimeout(() => showCuteChallenge(), 1000);
                        cuteGameState.player.xp += 200;
                    }
                }
            ];
            
            const event = events[Math.floor(Math.random() * events.length)];
            showCuteAchievement(event.name, event.message);
            event.effect();
        }

        // Update Koko's mood
        function updateKokoMood() {
            const happiness = cuteGameState.stats.happiness;
            const love = cuteGameState.stats.love;
            const avgMood = (happiness + love) / 2;
            
            let mood, expression;
            if (avgMood >= 90) {
                mood = "ecstatic";
                expression = "ü•∞";
            } else if (avgMood >= 75) {
                mood = "super happy";
                expression = "üòÑ";
            } else if (avgMood >= 60) {
                mood = "happy";
                expression = "üòä";
            } else if (avgMood >= 40) {
                mood = "okay";
                expression = "üòê";
            } else {
                mood = "needs attention";
                expression = "üòî";
            }
            
            cuteGameState.koala.mood = mood;
            cuteGameState.koala.moodLevel = avgMood;
            
            // Update status display
            const statusMessages = {
                "ecstatic": "Koko is absolutely amazing! üåü",
                "super happy": "Koko is super happy! üåà",
                "happy": "Koko is feeling great! ‚ú®",
                "okay": "Koko is doing okay! üòä",
                "needs attention": "Koko needs some love! üíï"
            };
            
            document.getElementById('koalaStatus').textContent = statusMessages[mood];
        }

        // Enhanced heart effects
        function createEnhancedHeartEffect() {
            const heartSystem = document.getElementById('heartSystem');
            
            for (let i = 0; i < 8; i++) {
                const heart = document.createElement('div');
                heart.className = 'floating-heart';
                
                const hearts = ['üíï', 'üíñ', 'üíó', 'üíù', 'üíò', 'üíû', '‚ù§Ô∏è', 'üß°', 'üíõ', 'üíö', 'üíô', 'üíú'];
                heart.textContent = hearts[Math.floor(Math.random() * hearts.length)];
                
                heart.style.left = Math.random() * 100 + '%';
                heart.style.top = Math.random() * 100 + '%';
                heart.style.animationDelay = Math.random() * 3 + 's';
                heart.style.animationDuration = (Math.random() * 2 + 2) + 's';
                
                heartSystem.appendChild(heart);
                
                setTimeout(() => {
                    if (heart.parentNode) {
                        heart.parentNode.removeChild(heart);
                    }
                }, 5000);
            }
        }

        // Create rainbow effect
        function createRainbowEffect() {
            const gameScreen = document.querySelector('.game-screen');
            gameScreen.style.background = 'linear-gradient(45deg, #ff0000, #ff8000, #ffff00, #80ff00, #00ff00, #00ff80, #00ffff, #0080ff, #0000ff, #8000ff, #ff00ff, #ff0080)';
            gameScreen.style.backgroundSize = '400% 400%';
            gameScreen.style.animation = 'rainbowShift 3s ease-in-out';
            
            setTimeout(() => {
                gameScreen.style.background = 'radial-gradient(circle at center, rgba(255,182,193,0.2) 0%, transparent 70%)';
                gameScreen.style.animation = '';
            }, 3000);
        }

        // Create toy explosion
        function createToyExplosion() {
            const gameScreen = document.querySelector('.game-screen');
            
            for (let i = 0; i < 15; i++) {
                const toy = document.createElement('div');
                toy.style.position = 'absolute';
                toy.style.fontSize = '24px';
                toy.style.left = '50%';
                toy.style.top = '50%';
                toy.style.pointerEvents = 'none';
                toy.style.zIndex = '1000';
                
                const toys = ['üß∏', '‚öΩ', 'üß©', 'üñçÔ∏è', 'üß±', 'ü™Ü', 'üöó', 'üìñ', '‚≠ê', 'üéà', 'üé®', 'üé≠'];
                toy.textContent = toys[Math.floor(Math.random() * toys.length)];
                
                const angle = (i / 15) * 2 * Math.PI;
                const distance = 100 + Math.random() * 100;
                const endX = Math.cos(angle) * distance;
                const endY = Math.sin(angle) * distance;
                
                toy.style.animation = `toyExplosion 2s ease-out forwards`;
                toy.style.setProperty('--endX', endX + 'px');
                toy.style.setProperty('--endY', endY + 'px');
                
                gameScreen.appendChild(toy);
                
                setTimeout(() => {
                    if (toy.parentNode) {
                        toy.parentNode.removeChild(toy);
                    }
                }, 2000);
            }
        }

        // Create love burst
        function createLoveBurst() {
            const koala = document.getElementById('cuteKoala');
            koala.style.filter = 'drop-shadow(0 0 30px rgba(255,20,147,0.8)) hue-rotate(45deg)';
            koala.style.transform = 'scale(1.2)';
            
            setTimeout(() => {
                koala.style.filter = 'drop-shadow(0 0 20px rgba(255,182,193,0.6))';
                koala.style.transform = 'scale(1)';
            }, 2000);
        }

        // Play interaction sound (visual feedback)
        function playInteractionSound() {
            showCuteEffect("‚ô™ ‚ô´ ‚ô™", "sparkle-effect");
        }

        // Play toy found sound (visual feedback)
        function playToyFoundSound() {
            showCuteEffect("‚ú® DING! ‚ú®", "happy-effect");
        }

        // Combo system reset
        setInterval(() => {
            if (Date.now() - cuteGameState.lastInteraction > 5000) {
                cuteGameState.comboCount = 0;
            }
        }, 1000);

        // Add rainbow animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes rainbowShift {
                0% { background-position: 0% 50%; }
                50% { background-position: 100% 50%; }
                100% { background-position: 0% 50%; }
            }
            
            @keyframes toyExplosion {
                0% { 
                    transform: translate(-50%, -50%) scale(0) rotate(0deg);
                    opacity: 1;
                }
                100% { 
                    transform: translate(calc(-50% + var(--endX)), calc(-50% + var(--endY))) scale(1) rotate(360deg);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);

        // New Supporting Functions

        // Get total toys count
        function getTotalToys() {
            return cuteGameState.toyBox.reduce((total, toy) => total + toy.quantity, 0);
        }

        // Show achievement unlock
        function showAchievementUnlock(achievement) {
            const notification = document.getElementById('achievementNotification');
            const title = document.getElementById('achievementTitle');
            const desc = document.getElementById('achievementDesc');
            
            title.textContent = `${achievement.emoji} ${achievement.name}`;
            desc.textContent = achievement.description;
            
            notification.style.display = 'flex';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 4000);
            
            showCuteEffect('üèÜ ACHIEVEMENT!', 'sparkle-effect');
        }

        // Show daily challenge
        function showDailyChallenge() {
            const panel = document.getElementById('dailyChallengePanel');
            const challenge = cuteGameState.dailyChallenge;
            
            if (challenge) {
                document.getElementById('dailyChallengeName').textContent = challenge.name;
                document.getElementById('dailyChallengeDesc').textContent = challenge.description;
                updateDailyChallengeDisplay();
                panel.style.display = 'block';
                
                showCuteEffect('üåü New Daily Challenge!', 'sparkle-effect');
            }
        }

        // Update daily challenge display
        function updateDailyChallengeDisplay() {
            const challenge = cuteGameState.dailyChallenge;
            if (!challenge) return;
            
            const progress = Math.min(challenge.progress / challenge.target * 100, 100);
            document.getElementById('dailyChallengeProgress').style.width = progress + '%';
            document.getElementById('dailyChallengeText').textContent = `${challenge.progress}/${challenge.target}`;
        }

        // Update collections
        function updateCollections() {
            if (Math.random() < 0.1) {
                const collections = Object.keys(cuteGameState.collections);
                const randomCollection = collections[Math.floor(Math.random() * collections.length)];
                const collection = cuteGameState.collections[randomCollection];
                
                if (collection.collected < collection.total) {
                    collection.collected++;
                    showCuteEffect(`üìö New ${randomCollection} collected!`, 'happy-effect');
                    updateCollectionDisplay();
                    
                    // Check collection completion
                    if (collection.collected >= collection.total) {
                        achievementSystem.checkAchievement('collection_master', true);
                        showCuteEffect(`üèÜ ${randomCollection} collection complete!`, 'sparkle-effect');
                    }
                }
            }
        }

        // Update collection display
        function updateCollectionDisplay() {
            document.getElementById('stickerCollection').textContent = 
                `${cuteGameState.collections.stickers.collected}/${cuteGameState.collections.stickers.total}`;
            document.getElementById('emotionCollection').textContent = 
                `${cuteGameState.collections.emotions.collected}/${cuteGameState.collections.emotions.total}`;
            document.getElementById('placeCollection').textContent = 
                `${cuteGameState.collections.places.collected}/${cuteGameState.collections.places.total}`;
            document.getElementById('toyCollection').textContent = 
                `${cuteGameState.collections.toys.collected}/${cuteGameState.collections.toys.total}`;
        }

        // Show collection details
        function showCollection(type) {
            const collection = cuteGameState.collections[type];
            const percentage = Math.round(collection.collected / collection.total * 100);
            showCuteAchievement(`${type.charAt(0).toUpperCase() + type.slice(1)} Collection`, 
                `${collection.collected}/${collection.total} collected (${percentage}%)`);
        }

        // Trigger random mini-game
        function triggerRandomMiniGame() {
            const games = ['memory', 'color', 'rhythm'];
            const randomGame = games[Math.floor(Math.random() * games.length)];
            
            switch(randomGame) {
                case 'memory':
                    miniGameSystem.startMemoryMatch();
                    break;
                case 'color':
                    miniGameSystem.startColorMixer();
                    break;
                case 'rhythm':
                    miniGameSystem.startRhythmGame();
                    break;
            }
        }

        // Show mini-game
        function showMiniGame(title, description, gameFunction) {
            showCuteAchievement(`üéÆ ${title}`, description);
            
            // Simulate mini-game completion
            setTimeout(() => {
                const result = gameFunction();
                const score = Math.floor(Math.random() * 150) + 50; // Random score 50-200
                
                cuteGameState.miniGameScores[miniGameSystem.currentGame] = Math.max(
                    cuteGameState.miniGameScores[miniGameSystem.currentGame], score
                );
                
                showCuteEffect(`üéÆ Score: ${score}!`, 'sparkle-effect');
                
                // Check mini-game achievement
                achievementSystem.checkAchievement('mini_game_pro', score >= 100);
                
                // Reward based on score
                const reward = Math.floor(score / 10);
                cuteGameState.resources.stickers += reward;
                showCuteEffect(`+${reward} Stickers!`, 'happy-effect');
                
                updateCuteDisplay();
            }, 3000);
        }

        // Enhanced special events
        function triggerSpecialEvent() {
            const events = [
                {
                    name: "Rainbow Shower",
                    message: "üåà A magical rainbow appears! Everything sparkles!",
                    effect: () => {
                        cuteGameState.resources.stickers += 50;
                        cuteGameState.resources.hearts += 10;
                        createRainbowEffect();
                        achievementSystem.checkAchievement('rainbow_finder', true);
                    }
                },
                {
                    name: "Toy Explosion",
                    message: "üéÅ Toy explosion! Koko found lots of toys!",
                    effect: () => {
                        cuteGameState.toyBox.forEach(toy => toy.quantity += Math.floor(Math.random() * 3) + 1);
                        createToyExplosion();
                        dailyChallengeSystem.updateProgress('toy', 5);
                    }
                },
                {
                    name: "Love Burst",
                    message: "üíï Love burst! Koko feels extra loved!",
                    effect: () => {
                        cuteGameState.player.love += 100;
                        cuteGameState.stats.happiness = 100;
                        createLoveBurst();
                    }
                },
                {
                    name: "Super Learning",
                    message: "üß† Brain boost! Learning is super fun right now!",
                    effect: () => {
                        setTimeout(() => showCuteChallenge(), 1000);
                        cuteGameState.player.xp += 200;
                    }
                },
                {
                    name: "Collection Bonus",
                    message: "üìö Collection bonus! Found rare items!",
                    effect: () => {
                        Object.keys(cuteGameState.collections).forEach(type => {
                            const collection = cuteGameState.collections[type];
                            if (collection.collected < collection.total && Math.random() < 0.5) {
                                collection.collected++;
                            }
                        });
                        updateCollectionDisplay();
                    }
                },
                {
                    name: "Achievement Rain",
                    message: "üèÜ Achievement rain! Multiple rewards!",
                    effect: () => {
                        cuteGameState.resources.stickers += 75;
                        cuteGameState.resources.hearts += 25;
                        cuteGameState.resources.treats += 15;
                        createAchievementRain();
                    }
                }
            ];
            
            const event = events[Math.floor(Math.random() * events.length)];
            showCuteAchievement(event.name, event.message);
            event.effect();
        }

        // Create achievement rain effect
        function createAchievementRain() {
            const gameScreen = document.querySelector('.game-screen');
            const achievements = ['üèÜ', 'üåü', 'üíé', 'üëë', 'üéñÔ∏è', 'ü•á', '‚≠ê', 'üí´'];
            
            for (let i = 0; i < 20; i++) {
                const achievement = document.createElement('div');
                achievement.style.position = 'absolute';
                achievement.style.fontSize = '20px';
                achievement.style.left = Math.random() * 100 + '%';
                achievement.style.top = '-20px';
                achievement.style.pointerEvents = 'none';
                achievement.style.zIndex = '1000';
                achievement.style.animation = 'achievementFall 3s ease-in forwards';
                
                achievement.textContent = achievements[Math.floor(Math.random() * achievements.length)];
                
                gameScreen.appendChild(achievement);
                
                setTimeout(() => {
                    if (achievement.parentNode) {
                        achievement.parentNode.removeChild(achievement);
                    }
                }, 3000);
            }
        }

        // Initialize all systems
        function initializeNewSystems() {
            dailyChallengeSystem.generateDaily();
            updateCollectionDisplay();
            
            // Check for existing achievements
            achievementSystem.checkAchievement('love_master', cuteGameState.player.love >= 1000);
            achievementSystem.checkAchievement('toy_collector', getTotalToys() >= 50);
        }

        // Add achievement fall animation
        const newStyle = document.createElement('style');
        newStyle.textContent += `
            @keyframes achievementFall {
                0% { 
                    transform: translateY(-20px) rotate(0deg);
                    opacity: 1;
                }
                100% { 
                    transform: translateY(400px) rotate(360deg);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(newStyle);

        // Start the cute game
        initializeCuteGame();
        
        // Initialize new systems
        setTimeout(() => {
            initializeNewSystems();
        }, 1000);

        // NEW ADVANCED FEATURES

        // Pet Care System
        function feedKoko() {
            if (cuteGameState.petCare.hunger < 100) {
                cuteGameState.petCare.hunger = Math.min(100, cuteGameState.petCare.hunger + 20);
                cuteGameState.petCare.lastFed = Date.now();
                updatePetCareDisplay();
                showCuteEffect('üçé Yummy! Koko loves apples!', 'happy-effect');
                
                // Boost happiness when well-fed
                cuteGameState.stats.happiness = Math.min(100, cuteGameState.stats.happiness + 5);
                updateCuteDisplay();
            } else {
                showCuteEffect('ü§ó Koko is already full!', 'cute-effect');
            }
        }

        function batheKoko() {
            if (cuteGameState.petCare.cleanliness < 100) {
                cuteGameState.petCare.cleanliness = Math.min(100, cuteGameState.petCare.cleanliness + 25);
                cuteGameState.petCare.lastBathed = Date.now();
                updatePetCareDisplay();
                showCuteEffect('üõÅ Splish splash! Koko is sparkling clean!', 'sparkle-effect');
                
                // Create bubble effect
                createBubbleEffect();
                
                // Boost health when clean
                cuteGameState.stats.health = Math.min(100, cuteGameState.stats.health + 5);
                updateCuteDisplay();
            } else {
                showCuteEffect('‚ú® Koko is already squeaky clean!', 'sparkle-effect');
            }
        }

        function restKoko() {
            if (cuteGameState.petCare.energy < 100) {
                cuteGameState.petCare.energy = Math.min(100, cuteGameState.petCare.energy + 30);
                cuteGameState.petCare.lastSlept = Date.now();
                updatePetCareDisplay();
                showCuteEffect('üò¥ Sweet dreams! Koko feels refreshed!', 'love-effect');
                
                // Create sleep effect
                createSleepEffect();
                
                // Boost energy stat
                cuteGameState.stats.energy = Math.min(100, cuteGameState.stats.energy + 10);
                updateCuteDisplay();
            } else {
                showCuteEffect('‚ö° Koko is full of energy!', 'sparkle-effect');
            }
        }

        function updatePetCareDisplay() {
            document.getElementById('hungerBar').style.width = cuteGameState.petCare.hunger + '%';
            document.getElementById('cleanBar').style.width = cuteGameState.petCare.cleanliness + '%';
            document.getElementById('energyBar').style.width = cuteGameState.petCare.energy + '%';
        }

        // Weather System
        function changeWeather() {
            const weathers = [
                { type: 'sunny', emoji: '‚òÄÔ∏è', temp: 25, effect: 'Perfect day for playing!' },
                { type: 'rainy', emoji: 'üåßÔ∏è', temp: 18, effect: 'Cozy indoor time!' },
                { type: 'snowy', emoji: '‚ùÑÔ∏è', temp: 5, effect: 'Winter wonderland!' },
                { type: 'cloudy', emoji: '‚òÅÔ∏è', temp: 20, effect: 'Nice and cool!' },
                { type: 'rainbow', emoji: 'üåà', temp: 22, effect: 'Magical rainbow day!' }
            ];
            
            const newWeather = weathers[Math.floor(Math.random() * weathers.length)];
            cuteGameState.weather = newWeather;
            
            document.getElementById('weatherDisplay').textContent = 
                `${newWeather.emoji} ${newWeather.type.charAt(0).toUpperCase() + newWeather.type.slice(1)} ${newWeather.temp}¬∞C`;
            document.getElementById('weatherEffect').textContent = newWeather.effect;
            
            showCuteEffect(`üå§Ô∏è Weather changed to ${newWeather.type}!`, 'sparkle-effect');
            
            // Weather affects mood
            if (newWeather.type === 'rainbow') {
                cuteGameState.stats.happiness = Math.min(100, cuteGameState.stats.happiness + 15);
                createRainbowEffect();
            }
            
            updateCuteDisplay();
        }

        // Customization System
        function openCustomization() {
            document.getElementById('customizationPanel').style.display = 'block';
            showCustomizationTab('hats');
            showCuteEffect('üëó Time to dress up Koko!', 'sparkle-effect');
        }

        function closeCustomization() {
            document.getElementById('customizationPanel').style.display = 'none';
        }

        function showCustomizationTab(type) {
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Show items
            const items = cuteGameState.kokoCustomization.unlocked[type];
            const container = document.getElementById('customizationItems');
            container.innerHTML = '';
            
            // Add "none" option
            const noneItem = document.createElement('div');
            noneItem.className = 'customization-item';
            noneItem.textContent = '‚ùå';
            noneItem.onclick = () => selectCustomization(type, null);
            container.appendChild(noneItem);
            
            // Add unlocked items
            items.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'customization-item';
                itemDiv.textContent = item;
                itemDiv.onclick = () => selectCustomization(type, item);
                
                if (cuteGameState.kokoCustomization[type] === item) {
                    itemDiv.classList.add('selected');
                }
                
                container.appendChild(itemDiv);
            });
        }

        function selectCustomization(type, item) {
            cuteGameState.kokoCustomization[type] = item;
            
            // Update visual
            document.querySelectorAll('.customization-item').forEach(el => el.classList.remove('selected'));
            event.target.classList.add('selected');
            
            // Apply to Koko
            applyCustomization();
            
            showCuteEffect(`‚ú® Koko looks amazing!`, 'sparkle-effect');
        }

        function applyCustomization() {
            const koala = document.getElementById('cuteKoala');
            const customization = cuteGameState.kokoCustomization;
            
            // This would apply visual changes to Koko
            // For now, we'll show the effect
            let description = 'Koko is wearing: ';
            if (customization.hat) description += customization.hat + ' ';
            if (customization.accessory) description += customization.accessory + ' ';
            
            showCuteEffect(description, 'cute-effect');
        }

        // Friends System
        function openFriends() {
            document.getElementById('friendsPanel').style.display = 'block';
            populateFriendsList();
            showCuteEffect('üë´ Time to visit friends!', 'love-effect');
        }

        function closeFriends() {
            document.getElementById('friendsPanel').style.display = 'none';
        }

        function populateFriendsList() {
            const container = document.getElementById('friendsList');
            container.innerHTML = '';
            
            cuteGameState.friends.forEach(friend => {
                const friendDiv = document.createElement('div');
                friendDiv.className = 'friend-item';
                if (!friend.unlocked) friendDiv.style.opacity = '0.5';
                
                friendDiv.innerHTML = `
                    <div class="friend-emoji">${friend.emoji}</div>
                    <div class="friend-info">
                        <div class="friend-name">${friend.name}</div>
                        <div class="friend-friendship">Friendship: ${friend.friendship}%</div>
                    </div>
                `;
                
                if (friend.unlocked) {
                    friendDiv.onclick = () => interactWithFriend(friend);
                }
                
                container.appendChild(friendDiv);
            });
        }

        function interactWithFriend(friend) {
            friend.friendship = Math.min(100, friend.friendship + 10);
            showCuteEffect(`üíï ${friend.name} friendship +10!`, 'love-effect');
            populateFriendsList();
            
            // Unlock new friends based on friendship levels
            if (friend.friendship >= 75) {
                const nextFriend = cuteGameState.friends.find(f => !f.unlocked);
                if (nextFriend) {
                    nextFriend.unlocked = true;
                    showCuteAchievement('New Friend!', `${nextFriend.name} wants to be friends!`);
                }
            }
        }

        // Photo Mode System
        function openPhotoMode() {
            document.getElementById('photoMode').style.display = 'block';
            showCuteEffect('üì∏ Say cheese, Koko!', 'sparkle-effect');
        }

        function closePhotoMode() {
            document.getElementById('photoMode').style.display = 'none';
        }

        function takePhoto() {
            const timestamp = new Date().toLocaleString();
            cuteGameState.photoAlbum.push({
                timestamp: timestamp,
                pose: cuteGameState.currentPose || 'happy',
                customization: {...cuteGameState.kokoCustomization}
            });
            
            showCuteEffect('üì∏ Photo saved! Koko looks adorable!', 'sparkle-effect');
            createCameraFlash();
        }

        function changePose() {
            const poses = ['üê®', 'ü§ó', 'üòç', 'ü•∞', 'üòä', 'ü§∏'];
            const newPose = poses[Math.floor(Math.random() * poses.length)];
            document.getElementById('photoKoko').textContent = newPose;
            cuteGameState.currentPose = newPose;
            showCuteEffect('ü§∏ New pose!', 'happy-effect');
        }

        function addStickers() {
            const photoPreview = document.getElementById('photoPreview');
            const stickers = ['‚≠ê', 'üíñ', 'üåà', '‚ú®', 'üéà', 'üå∏'];
            
            for (let i = 0; i < 3; i++) {
                const sticker = document.createElement('div');
                sticker.style.position = 'absolute';
                sticker.style.fontSize = '20px';
                sticker.style.left = Math.random() * 80 + '%';
                sticker.style.top = Math.random() * 80 + '%';
                sticker.style.pointerEvents = 'none';
                sticker.textContent = stickers[Math.floor(Math.random() * stickers.length)];
                photoPreview.appendChild(sticker);
            }
            
            showCuteEffect('‚≠ê Stickers added!', 'sparkle-effect');
        }

        // Special Effects
        function createBubbleEffect() {
            const gameScreen = document.querySelector('.game-screen');
            const bubbles = ['ü´ß', 'üíô', 'üîµ', 'üíé'];
            
            for (let i = 0; i < 10; i++) {
                const bubble = document.createElement('div');
                bubble.style.position = 'absolute';
                bubble.style.fontSize = '16px';
                bubble.style.left = Math.random() * 100 + '%';
                bubble.style.top = '100%';
                bubble.style.pointerEvents = 'none';
                bubble.style.animation = 'bubbleFloat 3s ease-out forwards';
                bubble.textContent = bubbles[Math.floor(Math.random() * bubbles.length)];
                
                gameScreen.appendChild(bubble);
                
                setTimeout(() => {
                    if (bubble.parentNode) bubble.parentNode.removeChild(bubble);
                }, 3000);
            }
        }

        function createSleepEffect() {
            const gameScreen = document.querySelector('.game-screen');
            const sleepEmojis = ['üò¥', 'üí§', 'üåô', '‚≠ê'];
            
            for (let i = 0; i < 8; i++) {
                const sleep = document.createElement('div');
                sleep.style.position = 'absolute';
                sleep.style.fontSize = '18px';
                sleep.style.left = Math.random() * 100 + '%';
                sleep.style.top = Math.random() * 100 + '%';
                sleep.style.pointerEvents = 'none';
                sleep.style.animation = 'sleepFloat 4s ease-in-out forwards';
                sleep.textContent = sleepEmojis[Math.floor(Math.random() * sleepEmojis.length)];
                
                gameScreen.appendChild(sleep);
                
                setTimeout(() => {
                    if (sleep.parentNode) sleep.parentNode.removeChild(sleep);
                }, 4000);
            }
        }

        function createCameraFlash() {
            const gameScreen = document.querySelector('.game-screen');
            const flash = document.createElement('div');
            flash.style.position = 'absolute';
            flash.style.top = '0';
            flash.style.left = '0';
            flash.style.width = '100%';
            flash.style.height = '100%';
            flash.style.background = 'rgba(255,255,255,0.8)';
            flash.style.pointerEvents = 'none';
            flash.style.animation = 'cameraFlash 0.3s ease-out';
            
            gameScreen.appendChild(flash);
            
            setTimeout(() => {
                if (flash.parentNode) flash.parentNode.removeChild(flash);
            }, 300);
        }

        // Add new animations
        const advancedStyle = document.createElement('style');
        advancedStyle.textContent = `
            @keyframes bubbleFloat {
                0% { transform: translateY(0) scale(0); opacity: 0; }
                50% { transform: translateY(-200px) scale(1); opacity: 1; }
                100% { transform: translateY(-400px) scale(0); opacity: 0; }
            }
            
            @keyframes sleepFloat {
                0%, 100% { transform: translateY(0) rotate(0deg); opacity: 0.7; }
                50% { transform: translateY(-20px) rotate(10deg); opacity: 1; }
            }
            
            @keyframes cameraFlash {
                0% { opacity: 0; }
                50% { opacity: 1; }
                100% { opacity: 0; }
            }
        `;
        document.head.appendChild(advancedStyle);

        // Pet care degradation over time
        setInterval(() => {
            const now = Date.now();
            const hourInMs = 60 * 60 * 1000;
            
            // Gradual degradation
            if (now - cuteGameState.petCare.lastFed > hourInMs) {
                cuteGameState.petCare.hunger = Math.max(0, cuteGameState.petCare.hunger - 1);
            }
            if (now - cuteGameState.petCare.lastBathed > 2 * hourInMs) {
                cuteGameState.petCare.cleanliness = Math.max(0, cuteGameState.petCare.cleanliness - 1);
            }
            if (now - cuteGameState.petCare.lastSlept > 3 * hourInMs) {
                cuteGameState.petCare.energy = Math.max(0, cuteGameState.petCare.energy - 1);
            }
            
            updatePetCareDisplay();
        }, 60000); // Check every minute

        // Initialize pet care display
        updatePetCareDisplay();

        // ADVANCED GAME SYSTEMS

        // Quest System
        function updateQuestProgress(taskType, amount = 1) {
            const quest = cuteGameState.story.activeQuest;
            if (!quest || quest.completed) return;
            
            quest.tasks.forEach(task => {
                if (task.id.includes(taskType) && !task.completed) {
                    task.progress = Math.min(task.progress + amount, task.target);
                    if (task.progress >= task.target) {
                        task.completed = true;
                        showCuteEffect(`‚úÖ ${task.description} completed!`, 'sparkle-effect');
                    }
                }
            });
            
            updateQuestDisplay();
            
            // Check if quest is complete
            if (quest.tasks.every(task => task.completed)) {
                completeQuest();
            }
        }

        function updateQuestDisplay() {
            const quest = cuteGameState.story.activeQuest;
            if (!quest) return;
            
            document.getElementById('questTitle').textContent = quest.title;
            const tasksContainer = document.getElementById('questTasks');
            tasksContainer.innerHTML = '';
            
            quest.tasks.forEach(task => {
                const taskDiv = document.createElement('div');
                taskDiv.className = `quest-task ${task.completed ? 'completed' : ''}`;
                taskDiv.innerHTML = `
                    <span>${task.description}</span>
                    <span>${task.progress}/${task.target}</span>
                `;
                tasksContainer.appendChild(taskDiv);
            });
        }

        function completeQuest() {
            const quest = cuteGameState.story.activeQuest;
            quest.completed = true;
            cuteGameState.story.completedQuests.push(quest.id);
            
            // Give rewards
            Object.keys(quest.rewards).forEach(resource => {
                if (cuteGameState.resources[resource] !== undefined) {
                    cuteGameState.resources[resource] += quest.rewards[resource];
                } else if (cuteGameState.player[resource] !== undefined) {
                    cuteGameState.player[resource] += quest.rewards[resource];
                }
            });
            
            showCuteAchievement('Quest Complete!', `üéâ ${quest.title} completed! Great job!`);
            
            // Start next quest
            setTimeout(() => {
                startNextQuest();
            }, 2000);
            
            updateCuteDisplay();
        }

        function startNextQuest() {
            const nextQuests = [
                {
                    id: 'friendship_quest',
                    title: 'Making Friends',
                    description: 'Build friendships with other animals',
                    tasks: [
                        { id: 'visit_friends', description: 'Visit the friends panel', progress: 0, target: 1, completed: false },
                        { id: 'interact_friend', description: 'Interact with Bella Bunny', progress: 0, target: 3, completed: false },
                        { id: 'unlock_friend', description: 'Unlock a new friend', progress: 0, target: 1, completed: false }
                    ],
                    rewards: { xp: 150, stickers: 75, hearts: 40 },
                    completed: false
                },
                {
                    id: 'learning_quest',
                    title: 'Knowledge Seeker',
                    description: 'Expand your learning skills',
                    tasks: [
                        { id: 'complete_challenge', description: 'Complete 3 educational challenges', progress: 0, target: 3, completed: false },
                        { id: 'unlock_skill', description: 'Unlock a new skill', progress: 0, target: 1, completed: false },
                        { id: 'visit_library', description: 'Visit the library', progress: 0, target: 1, completed: false }
                    ],
                    rewards: { xp: 200, stickers: 100, skillPoints: 5 },
                    completed: false
                }
            ];
            
            const nextQuest = nextQuests[cuteGameState.story.completedQuests.length % nextQuests.length];
            cuteGameState.story.activeQuest = nextQuest;
            updateQuestDisplay();
            showCuteEffect('üìñ New quest available!', 'sparkle-effect');
        }

        // Skill Tree System
        function showSkillTree(category) {
            const skillTree = cuteGameState.skillTrees[category];
            const modal = document.getElementById('skillTreeModal');
            const title = document.getElementById('skillTreeTitle');
            const pointsDisplay = document.getElementById('availableSkillPoints');
            const content = document.getElementById('skillTreeContent');
            
            const categoryEmojis = {
                learning: 'üß†',
                creativity: 'üé®',
                friendship: 'üíï',
                exploration: 'üó∫Ô∏è'
            };
            
            title.textContent = `${categoryEmojis[category]} ${category.charAt(0).toUpperCase() + category.slice(1)} Skills`;
            pointsDisplay.textContent = skillTree.points;
            
            content.innerHTML = '';
            
            Object.keys(skillTree.skills).forEach(skillId => {
                const skill = skillTree.skills[skillId];
                const skillDiv = document.createElement('div');
                skillDiv.className = 'skill-item';
                
                if (skill.unlocked) {
                    skillDiv.classList.add('unlocked');
                } else if (skillTree.points >= skill.cost) {
                    skillDiv.classList.add('affordable');
                }
                
                skillDiv.innerHTML = `
                    <div class="skill-info">
                        <div class="skill-name">${skill.name}</div>
                        <div class="skill-cost">${skill.unlocked ? 'Unlocked' : `Cost: ${skill.cost} points`}</div>
                    </div>
                    ${!skill.unlocked && skillTree.points >= skill.cost ? 
                        `<button class="skill-unlock-btn" onclick="unlockSkill('${category}', '${skillId}')">Unlock</button>` : ''}
                `;
                
                content.appendChild(skillDiv);
            });
            
            modal.style.display = 'block';
            showCuteEffect(`üåü ${category} skill tree opened!`, 'sparkle-effect');
        }

        function closeSkillTree() {
            document.getElementById('skillTreeModal').style.display = 'none';
        }

        function unlockSkill(category, skillId) {
            const skillTree = cuteGameState.skillTrees[category];
            const skill = skillTree.skills[skillId];
            
            if (skillTree.points >= skill.cost && !skill.unlocked) {
                skillTree.points -= skill.cost;
                skill.unlocked = true;
                skillTree.unlocked.push(skillId);
                skillTree.level++;
                
                showCuteAchievement('Skill Unlocked!', `üåü ${skill.name} unlocked!`);
                updateSkillTreeDisplay();
                showSkillTree(category); // Refresh the modal
                
                // Update quest progress
                updateQuestProgress('unlock_skill');
                
                // Unlock new abilities based on skills
                unlockSkillAbilities(category, skillId);
            }
        }

        function unlockSkillAbilities(category, skillId) {
            // Unlock new customization items, friends, or interactive objects based on skills
            if (skillId === 'friend_magnet') {
                cuteGameState.friends.forEach(friend => {
                    if (!friend.unlocked && Math.random() < 0.5) {
                        friend.unlocked = true;
                        showCuteEffect(`üë´ ${friend.name} wants to be friends!`, 'love-effect');
                    }
                });
            }
            
            if (skillId === 'nature_scout') {
                // Unlock new interactive objects
                Object.values(cuteGameState.interactiveObjects).forEach(locationObjects => {
                    locationObjects.forEach(obj => {
                        if (!obj.unlocked && Math.random() < 0.3) {
                            obj.unlocked = true;
                            showCuteEffect(`üîì ${obj.name} unlocked!`, 'sparkle-effect');
                        }
                    });
                });
            }
        }

        function updateSkillTreeDisplay() {
            document.getElementById('learningLevel').textContent = `Lv.${cuteGameState.skillTrees.learning.level}`;
            document.getElementById('creativityLevel').textContent = `Lv.${cuteGameState.skillTrees.creativity.level}`;
            document.getElementById('friendshipLevel').textContent = `Lv.${cuteGameState.skillTrees.friendship.level}`;
            document.getElementById('explorationLevel').textContent = `Lv.${cuteGameState.skillTrees.exploration.level}`;
        }

        // Interactive Objects System
        function showInteractiveObjects(location) {
            const objects = cuteGameState.interactiveObjects[location];
            const modal = document.getElementById('interactiveObjectsModal');
            const title = document.getElementById('interactiveTitle');
            const list = document.getElementById('interactiveObjectsList');
            
            const locationEmojis = {
                playground: 'üõù',
                garden: 'üå∏',
                library: 'üìö'
            };
            
            title.textContent = `${locationEmojis[location]} ${location.charAt(0).toUpperCase() + location.slice(1)} Objects`;
            
            list.innerHTML = '';
            
            objects.forEach(obj => {
                const objDiv = document.createElement('div');
                objDiv.className = `interactive-object ${!obj.unlocked ? 'locked' : ''}`;
                
                objDiv.innerHTML = `
                    <div class="object-emoji">${obj.emoji}</div>
                    <div class="object-info">
                        <div class="object-name">${obj.name}</div>
                        <div class="object-clicks">Clicked: ${obj.clicks} times</div>
                    </div>
                `;
                
                if (obj.unlocked) {
                    objDiv.onclick = () => interactWithObject(obj);
                }
                
                list.appendChild(objDiv);
            });
            
            modal.style.display = 'block';
            showCuteEffect(`üîç Exploring ${location}!`, 'sparkle-effect');
        }

        function closeInteractiveObjects() {
            document.getElementById('interactiveObjectsModal').style.display = 'none';
        }

        function interactWithObject(obj) {
            obj.clicks++;
            
            const interactions = {
                swing: ['ü™Ä Wheee! Koko loves swinging!', 'üåü The swing sparkles with magic!'],
                slide: ['üõù Sliding down the rainbow!', 'üåà Colors dance around Koko!'],
                flowers: ['üå∏ The flowers sing a beautiful melody!', 'üéµ Musical notes float in the air!'],
                books: ['üìö Koko discovers amazing stories!', '‚ú® Knowledge fills the air!']
            };
            
            const messages = interactions[obj.id] || ['‚ú® Something magical happens!'];
            const message = messages[Math.floor(Math.random() * messages.length)];
            
            showCuteEffect(message, 'sparkle-effect');
            
            // Give rewards based on object type
            const rewards = {
                swing: { happiness: 5, stickers: 3 },
                slide: { happiness: 8, hearts: 2 },
                flowers: { love: 10, stickers: 5 },
                books: { xp: 15, skillPoints: 1 }
            };
            
            const reward = rewards[obj.id];
            if (reward) {
                Object.keys(reward).forEach(resource => {
                    if (cuteGameState.stats[resource] !== undefined) {
                        cuteGameState.stats[resource] = Math.min(100, cuteGameState.stats[resource] + reward[resource]);
                    } else if (cuteGameState.resources[resource] !== undefined) {
                        cuteGameState.resources[resource] += reward[resource];
                    } else if (cuteGameState.player[resource] !== undefined) {
                        cuteGameState.player[resource] += reward[resource];
                    } else if (cuteGameState.skillTrees.learning[resource] !== undefined) {
                        cuteGameState.skillTrees.learning[resource] += reward[resource];
                    }
                });
            }
            
            updateCuteDisplay();
            showInteractiveObjects(Object.keys(cuteGameState.interactiveObjects).find(loc => 
                cuteGameState.interactiveObjects[loc].includes(obj)
            ));
        }

        // Advanced AI System
        function updateKokoAI() {
            const ai = cuteGameState.kokoAI;
            const stats = cuteGameState.stats;
            
            // Update mood based on stats
            if (stats.happiness > 80 && stats.health > 80) {
                ai.mood = 'ecstatic';
            } else if (stats.happiness > 60) {
                ai.mood = 'happy';
            } else if (stats.happiness > 40) {
                ai.mood = 'content';
            } else {
                ai.mood = 'sad';
            }
            
            // Generate dynamic thoughts
            const thoughts = {
                ecstatic: [
                    'I feel amazing! Let\'s have more adventures!',
                    'This is the best day ever! üåü',
                    'I love learning and playing with you!',
                    'Everything is so wonderful and magical!'
                ],
                happy: [
                    'I\'m having so much fun today!',
                    'What should we explore next?',
                    'I love spending time with you!',
                    'Learning is such an adventure!'
                ],
                content: [
                    'Today is a good day for learning.',
                    'I wonder what we\'ll discover.',
                    'Shall we try something new?',
                    'I\'m ready for our next activity!'
                ],
                sad: [
                    'I could use some cheering up...',
                    'Maybe we could play together?',
                    'I\'m feeling a bit lonely.',
                    'Some hugs would be nice.'
                ]
            };
            
            if (Math.random() < 0.1) { // 10% chance to update thought
                const moodThoughts = thoughts[ai.mood];
                ai.currentThought = moodThoughts[Math.floor(Math.random() * moodThoughts.length)];
                updateKokoThoughtsDisplay();
            }
        }

        function updateKokoThoughtsDisplay() {
            const ai = cuteGameState.kokoAI;
            document.getElementById('kokoThought').textContent = ai.currentThought;
            
            const moodEmojis = {
                ecstatic: 'ü§© Ecstatic & Energetic',
                happy: 'üòä Happy & Playful',
                content: 'üòå Content & Curious',
                sad: 'üò¢ Sad & Lonely'
            };
            
            document.getElementById('kokoMoodIndicator').textContent = moodEmojis[ai.mood];
        }

        // Seasonal Events System
        function triggerSeasonalEvent() {
            const events = cuteGameState.seasonalEvents;
            const availableEvents = events.filter(event => !event.active);
            
            if (availableEvents.length > 0 && Math.random() < 0.05) { // 5% chance
                const event = availableEvents[Math.floor(Math.random() * availableEvents.length)];
                event.active = true;
                event.startTime = Date.now();
                
                showSeasonalEvent(event);
            }
        }

        function showSeasonalEvent(event) {
            const panel = document.getElementById('seasonalEventPanel');
            document.getElementById('seasonalEventName').textContent = event.name;
            document.getElementById('seasonalEventDesc').textContent = `Special rewards and activities available!`;
            document.getElementById('seasonalEventTimer').textContent = `${event.duration} days remaining`;
            
            panel.style.display = 'block';
            
            showCuteAchievement('Seasonal Event!', `üéâ ${event.name} has begun!`);
            
            // Hide after 10 seconds
            setTimeout(() => {
                panel.style.display = 'none';
            }, 10000);
        }

        // Enhanced interaction system
        function enhancedInteractWithKoko() {
            // Update quest progress
            updateQuestProgress('click_koko');
            
            // Update AI
            updateKokoAI();
            
            // Award skill points occasionally
            if (Math.random() < 0.1) {
                const categories = Object.keys(cuteGameState.skillTrees);
                const randomCategory = categories[Math.floor(Math.random() * categories.length)];
                cuteGameState.skillTrees[randomCategory].points++;
                showCuteEffect(`üåü +1 ${randomCategory} skill point!`, 'sparkle-effect');
                updateSkillTreeDisplay();
            }
            
            // Trigger seasonal events
            triggerSeasonalEvent();
        }

        // Override the original interaction function
        const originalInteract = interactWithKoko;
        interactWithKoko = function() {
            originalInteract();
            enhancedInteractWithKoko();
        };

        // Initialize advanced systems
        function initializeAdvancedSystems() {
            updateQuestDisplay();
            updateSkillTreeDisplay();
            updateKokoThoughtsDisplay();
            
            // Add interactive object buttons to places
            const places = document.querySelectorAll('.place-button');
            places.forEach(place => {
                const location = place.id.replace('Place', '');
                if (cuteGameState.interactiveObjects[location]) {
                    place.addEventListener('dblclick', () => {
                        showInteractiveObjects(location);
                    });
                }
            });
        }

        // Initialize advanced systems
        setTimeout(() => {
            initializeAdvancedSystems();
        }, 1500);

        // ULTIMATE ADVANCED FEATURES

        // Advanced Mini-Games System
        function openAdvancedMiniGames() {
            const modal = document.getElementById('advancedMiniGamesModal');
            const gamesList = document.getElementById('advancedGamesList');
            
            const games = [
                {
                    id: 'mathAdventure',
                    title: 'Math Adventure Quest',
                    description: 'Solve math puzzles to help Koko explore magical lands!',
                    level: cuteGameState.advancedMiniGames.mathAdventure.level,
                    highScore: cuteGameState.advancedMiniGames.mathAdventure.highScore,
                    emoji: 'üßÆ'
                },
                {
                    id: 'wordExplorer',
                    title: 'Word Explorer Journey',
                    description: 'Discover new words and build vocabulary with Koko!',
                    level: cuteGameState.advancedMiniGames.wordExplorer.level,
                    highScore: cuteGameState.advancedMiniGames.wordExplorer.highScore,
                    emoji: 'üìù'
                },
                {
                    id: 'scienceQuest',
                    title: 'Science Discovery Quest',
                    description: 'Conduct fun experiments and learn about the world!',
                    level: cuteGameState.advancedMiniGames.scienceQuest.level,
                    highScore: cuteGameState.advancedMiniGames.scienceQuest.highScore,
                    emoji: 'üî¨'
                },
                {
                    id: 'creativityStudio',
                    title: 'Creativity Art Studio',
                    description: 'Create beautiful art and express your imagination!',
                    level: cuteGameState.advancedMiniGames.creativityStudio.level,
                    highScore: cuteGameState.advancedMiniGames.creativityStudio.highScore,
                    emoji: 'üé®'
                },
                {
                    id: 'logicPuzzles',
                    title: 'Logic Puzzle Challenge',
                    description: 'Solve brain teasers and develop critical thinking!',
                    level: cuteGameState.advancedMiniGames.logicPuzzles.level,
                    highScore: cuteGameState.advancedMiniGames.logicPuzzles.highScore,
                    emoji: 'üß©'
                }
            ];
            
            gamesList.innerHTML = '';
            
            games.forEach(game => {
                const gameDiv = document.createElement('div');
                gameDiv.className = 'advanced-game-item';
                
                gameDiv.innerHTML = `
                    <div class="game-info">
                        <div class="game-title">${game.emoji} ${game.title}</div>
                        <div class="game-description">${game.description}</div>
                        <div class="game-stats">Level: ${game.level} | High Score: ${game.highScore}</div>
                    </div>
                    <button class="game-play-btn" onclick="playAdvancedGame('${game.id}')">Play</button>
                `;
                
                gamesList.appendChild(gameDiv);
            });
            
            modal.style.display = 'block';
            showCuteEffect('üéì Advanced learning games opened!', 'sparkle-effect');
        }

        function closeAdvancedMiniGames() {
            document.getElementById('advancedMiniGamesModal').style.display = 'none';
        }

        function playAdvancedGame(gameId) {
            const game = cuteGameState.advancedMiniGames[gameId];
            const score = Math.floor(Math.random() * 200) + 50 + (game.level * 10);
            
            if (score > game.highScore) {
                game.highScore = score;
                showCuteAchievement('New High Score!', `üèÜ ${score} points in ${gameId}!`);
            }
            
            // Level up based on performance
            if (score > 150) {
                game.level++;
                showCuteEffect(`üìà Level up! Now level ${game.level}!`, 'sparkle-effect');
            }
            
            // Award rewards
            const rewards = Math.floor(score / 20);
            cuteGameState.resources.stickers += rewards;
            cuteGameState.player.xp += score;
            
            // Update learning analytics
            updateLearningAnalytics(gameId, score);
            
            showCuteEffect(`üéÆ Game complete! Score: ${score}`, 'sparkle-effect');
            updateCuteDisplay();
            openAdvancedMiniGames(); // Refresh the modal
        }

        // Learning Analytics System
        function openLearningAnalytics() {
            const modal = document.getElementById('learningAnalyticsModal');
            const content = document.getElementById('analyticsContent');
            const analytics = cuteGameState.learningAnalytics;
            
            content.innerHTML = `
                <div class="analytics-section">
                    <div class="analytics-title">üìä Play Statistics</div>
                    <div class="analytics-stat">
                        <span>Total Play Time:</span>
                        <span>${Math.floor(analytics.totalPlayTime / 60)} minutes</span>
                    </div>
                    <div class="analytics-stat">
                        <span>Sessions Completed:</span>
                        <span>${analytics.sessionsCompleted}</span>
                    </div>
                    <div class="analytics-stat">
                        <span>Average Session:</span>
                        <span>${analytics.averageSessionLength} minutes</span>
                    </div>
                    <div class="analytics-stat">
                        <span>Learning Speed:</span>
                        <span>${analytics.learningSpeed}</span>
                    </div>
                </div>
                
                <div class="analytics-section">
                    <div class="analytics-title">üéØ Skill Progress</div>
                    <div class="analytics-stat">
                        <span>Math Skills:</span>
                        <span>Level ${cuteGameState.skillTrees.learning.level}</span>
                    </div>
                    <div class="progress-chart">
                        <div class="progress-fill-analytics" style="width: ${cuteGameState.skillTrees.learning.level * 20}%"></div>
                    </div>
                    <div class="analytics-stat">
                        <span>Creativity Skills:</span>
                        <span>Level ${cuteGameState.skillTrees.creativity.level}</span>
                    </div>
                    <div class="progress-chart">
                        <div class="progress-fill-analytics" style="width: ${cuteGameState.skillTrees.creativity.level * 20}%"></div>
                    </div>
                    <div class="analytics-stat">
                        <span>Social Skills:</span>
                        <span>Level ${cuteGameState.skillTrees.friendship.level}</span>
                    </div>
                    <div class="progress-chart">
                        <div class="progress-fill-analytics" style="width: ${cuteGameState.skillTrees.friendship.level * 20}%"></div>
                    </div>
                </div>
                
                <div class="analytics-section">
                    <div class="analytics-title">üåü Achievements</div>
                    <div class="analytics-stat">
                        <span>Achievements Unlocked:</span>
                        <span>${cuteGameState.unlockedAchievements.length}/10</span>
                    </div>
                    <div class="progress-chart">
                        <div class="progress-fill-analytics" style="width: ${cuteGameState.unlockedAchievements.length * 10}%"></div>
                    </div>
                    <div class="analytics-stat">
                        <span>Collections Completed:</span>
                        <span>${getCompletedCollections()}/4</span>
                    </div>
                </div>
                
                <div class="analytics-section">
                    <div class="analytics-title">üìà Learning Insights</div>
                    <div class="analytics-stat">
                        <span>Strong Subjects:</span>
                        <span>${analytics.strongSubjects.join(', ') || 'Discovering...'}</span>
                    </div>
                    <div class="analytics-stat">
                        <span>Areas to Improve:</span>
                        <span>${analytics.needsImprovement.join(', ') || 'All good!'}</span>
                    </div>
                    <div class="analytics-stat">
                        <span>Difficulty Level:</span>
                        <span>Level ${analytics.difficultyLevel}</span>
                    </div>
                </div>
            `;
            
            modal.style.display = 'block';
            showCuteEffect('üìä Learning analytics opened!', 'sparkle-effect');
        }

        function closeLearningAnalytics() {
            document.getElementById('learningAnalyticsModal').style.display = 'none';
        }

        function updateLearningAnalytics(gameType, score) {
            const analytics = cuteGameState.learningAnalytics;
            analytics.totalPlayTime += 5; // Assume 5 minutes per game
            analytics.sessionsCompleted++;
            analytics.averageSessionLength = Math.floor(analytics.totalPlayTime / analytics.sessionsCompleted);
            
            // Determine learning speed
            if (score > 180) {
                analytics.learningSpeed = 'fast';
            } else if (score > 120) {
                analytics.learningSpeed = 'normal';
            } else {
                analytics.learningSpeed = 'steady';
            }
            
            // Track strong subjects
            if (score > 150) {
                const subject = gameType.replace(/([A-Z])/g, ' $1').toLowerCase();
                if (!analytics.strongSubjects.includes(subject)) {
                    analytics.strongSubjects.push(subject);
                }
            }
            
            // Adaptive difficulty
            if (analytics.sessionsCompleted % 5 === 0 && analytics.learningSpeed === 'fast') {
                analytics.difficultyLevel++;
                showCuteEffect('üéØ Difficulty increased! You\'re doing great!', 'sparkle-effect');
            }
        }

        function getCompletedCollections() {
            return Object.values(cuteGameState.collections).filter(collection => 
                collection.collected >= collection.total
            ).length;
        }

        // Music System
        function openMusicSystem() {
            const modal = document.getElementById('musicSystemModal');
            const controls = document.getElementById('musicControls');
            const musicSystem = cuteGameState.musicSystem;
            
            const tracks = [
                { id: 'peaceful_meadow', name: 'Peaceful Meadow', mood: 'Calm & Relaxing', emoji: 'üå∏' },
                { id: 'playful_bounce', name: 'Playful Bounce', mood: 'Happy & Energetic', emoji: 'üéà' },
                { id: 'learning_melody', name: 'Learning Melody', mood: 'Focused & Curious', emoji: 'üìö' },
                { id: 'friendship_song', name: 'Friendship Song', mood: 'Warm & Social', emoji: 'üë´' },
                { id: 'adventure_theme', name: 'Adventure Theme', mood: 'Exciting & Bold', emoji: 'üó∫Ô∏è' },
                { id: 'sleepy_lullaby', name: 'Sleepy Lullaby', mood: 'Gentle & Soothing', emoji: 'üò¥' }
            ];
            
            controls.innerHTML = '';
            
            tracks.forEach(track => {
                if (musicSystem.unlockedTracks.includes(track.id) || track.id === 'peaceful_meadow') {
                    const trackDiv = document.createElement('div');
                    trackDiv.className = `music-track ${musicSystem.currentTrack === track.id ? 'playing' : ''}`;
                    
                    trackDiv.innerHTML = `
                        <div class="track-info">
                            <div class="track-name">${track.emoji} ${track.name}</div>
                            <div class="track-mood">${track.mood}</div>
                        </div>
                        <button onclick="playTrack('${track.id}')" style="padding: 4px 8px; background: #8A2BE2; color: white; border: none; border-radius: 4px; font-size: 8px;">
                            ${musicSystem.currentTrack === track.id ? 'Playing' : 'Play'}
                        </button>
                    `;
                    
                    controls.appendChild(trackDiv);
                }
            });
            
            // Add volume control
            const volumeDiv = document.createElement('div');
            volumeDiv.className = 'volume-control';
            volumeDiv.innerHTML = `
                <span style="font-size: 10px; color: #8A2BE2;">üîä Volume:</span>
                <div class="volume-slider" onclick="adjustVolume(event)">
                    <div style="width: ${musicSystem.volume * 100}%; height: 100%; background: #8A2BE2; border-radius: 3px;"></div>
                </div>
                <span style="font-size: 9px; color: #9370DB;">${Math.floor(musicSystem.volume * 100)}%</span>
            `;
            controls.appendChild(volumeDiv);
            
            modal.style.display = 'block';
            showCuteEffect('üéµ Music system opened!', 'sparkle-effect');
        }

        function closeMusicSystem() {
            document.getElementById('musicSystemModal').style.display = 'none';
        }

        function playTrack(trackId) {
            cuteGameState.musicSystem.currentTrack = trackId;
            showCuteEffect(`üéµ Now playing: ${trackId.replace('_', ' ')}!`, 'sparkle-effect');
            openMusicSystem(); // Refresh the modal
        }

        function adjustVolume(event) {
            const rect = event.currentTarget.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const width = rect.width;
            const volume = Math.max(0, Math.min(1, x / width));
            cuteGameState.musicSystem.volume = volume;
            openMusicSystem(); // Refresh the modal
        }

        // Story Choices System
        function openStoryChoices() {
            const modal = document.getElementById('storyChoicesModal');
            const content = document.getElementById('storyChoicesContent');
            
            const scenarios = [
                {
                    text: "Koko finds a lost baby bird in the garden. What should Koko do?",
                    choices: [
                        { text: "Help the bird find its family", outcome: "kindness", relationship: "bella" },
                        { text: "Build a cozy nest for the bird", outcome: "creativity", relationship: "charlie" },
                        { text: "Ask friends for advice", outcome: "social", relationship: "danny" }
                    ]
                },
                {
                    text: "There's a big storm coming and all the animals need shelter. How can Koko help?",
                    choices: [
                        { text: "Share Koko's home with everyone", outcome: "generosity", relationship: "all" },
                        { text: "Build emergency shelters together", outcome: "teamwork", relationship: "ellie" },
                        { text: "Find the safest hiding spots", outcome: "wisdom", relationship: "bella" }
                    ]
                },
                {
                    text: "Koko discovers a magical book that can grant one wish. What should the wish be?",
                    choices: [
                        { text: "Wish for endless learning adventures", outcome: "knowledge", relationship: "charlie" },
                        { text: "Wish for all friends to be happy", outcome: "friendship", relationship: "all" },
                        { text: "Wish for the power to help others", outcome: "heroism", relationship: "ellie" }
                    ]
                }
            ];
            
            const randomScenario = scenarios[Math.floor(Math.random() * scenarios.length)];
            
            content.innerHTML = `
                <div class="story-scenario">
                    <div class="scenario-text">${randomScenario.text}</div>
                    <div class="choice-buttons">
                        ${randomScenario.choices.map((choice, index) => 
                            `<button class="choice-btn" onclick="makeStoryChoice(${index}, '${choice.outcome}', '${choice.relationship}')">${choice.text}</button>`
                        ).join('')}
                    </div>
                </div>
            `;
            
            modal.style.display = 'block';
            showCuteEffect('üìö Story adventure opened!', 'sparkle-effect');
        }

        function closeStoryChoices() {
            document.getElementById('storyChoicesModal').style.display = 'none';
        }

        function makeStoryChoice(choiceIndex, outcome, relationship) {
            cuteGameState.storyChoices.choicesMade.push({ outcome, relationship });
            
            // Update relationships
            if (relationship === 'all') {
                cuteGameState.friends.forEach(friend => {
                    friend.friendship = Math.min(100, friend.friendship + 5);
                });
            } else if (relationship !== 'none') {
                const friend = cuteGameState.friends.find(f => f.name.toLowerCase().includes(relationship));
                if (friend) {
                    friend.friendship = Math.min(100, friend.friendship + 10);
                }
            }
            
            // Give rewards based on outcome
            const rewards = {
                kindness: { love: 20, hearts: 10 },
                creativity: { stickers: 15, xp: 30 },
                social: { hearts: 15, friendship: 10 },
                generosity: { love: 25, hearts: 20 },
                teamwork: { xp: 40, stickers: 20 },
                wisdom: { xp: 50, skillPoints: 2 },
                knowledge: { xp: 60, skillPoints: 3 },
                friendship: { love: 30, hearts: 25 },
                heroism: { xp: 45, love: 15 }
            };
            
            const reward = rewards[outcome];
            Object.keys(reward).forEach(resource => {
                if (cuteGameState.player[resource] !== undefined) {
                    cuteGameState.player[resource] += reward[resource];
                } else if (cuteGameState.resources[resource] !== undefined) {
                    cuteGameState.resources[resource] += reward[resource];
                } else if (cuteGameState.skillTrees.learning[resource] !== undefined) {
                    cuteGameState.skillTrees.learning[resource] += reward[resource];
                }
            });
            
            showCuteAchievement('Story Choice Made!', `üåü You chose ${outcome}! Great decision!`);
            updateCuteDisplay();
            closeStoryChoices();
        }

        // Time-Based Events System
        function checkTimeBasedEvents() {
            const now = new Date();
            const hour = now.getHours();
            const timeOfDay = getTimeOfDay(hour);
            
            cuteGameState.timeOfDay = timeOfDay;
            
            const events = cuteGameState.timeBasedEvents;
            const currentEvent = events[timeOfDay];
            
            if (!currentEvent.active && Date.now() - currentEvent.lastTriggered > 3600000) { // 1 hour cooldown
                if (Math.random() < 0.1) { // 10% chance
                    triggerTimeBasedEvent(timeOfDay);
                }
            }
        }

        function getTimeOfDay(hour) {
            if (hour >= 6 && hour < 12) return 'morning';
            if (hour >= 12 && hour < 18) return 'afternoon';
            if (hour >= 18 && hour < 22) return 'evening';
            return 'night';
        }

        function triggerTimeBasedEvent(timeOfDay) {
            const events = {
                morning: {
                    title: 'Good Morning Sunshine!',
                    description: 'Start your day with extra energy and happiness!',
                    effect: () => {
                        cuteGameState.stats.energy = Math.min(100, cuteGameState.stats.energy + 20);
                        cuteGameState.stats.happiness = Math.min(100, cuteGameState.stats.happiness + 15);
                    }
                },
                afternoon: {
                    title: 'Afternoon Learning Boost!',
                    description: 'Perfect time for learning - double XP for 10 minutes!',
                    effect: () => {
                        // This would enable double XP temporarily
                        cuteGameState.player.xp += 50;
                    }
                },
                evening: {
                    title: 'Evening Friendship Time!',
                    description: 'Friends are more active - bonus friendship points!',
                    effect: () => {
                        cuteGameState.friends.forEach(friend => {
                            if (friend.unlocked) {
                                friend.friendship = Math.min(100, friend.friendship + 5);
                            }
                        });
                    }
                },
                night: {
                    title: 'Peaceful Night Rest!',
                    description: 'Time to rest and recharge for tomorrow!',
                    effect: () => {
                        cuteGameState.petCare.energy = Math.min(100, cuteGameState.petCare.energy + 30);
                        cuteGameState.stats.health = Math.min(100, cuteGameState.stats.health + 10);
                    }
                }
            };
            
            const event = events[timeOfDay];
            showTimeBasedEvent(event.title, event.description);
            event.effect();
            
            cuteGameState.timeBasedEvents[timeOfDay].active = true;
            cuteGameState.timeBasedEvents[timeOfDay].lastTriggered = Date.now();
            
            updateCuteDisplay();
        }

        function showTimeBasedEvent(title, description) {
            const notification = document.getElementById('timeBasedEventNotification');
            document.getElementById('timeEventTitle').textContent = title;
            document.getElementById('timeEventDesc').textContent = description;
            
            notification.style.display = 'flex';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 5000);
        }

        // Enhanced Parental Dashboard
        function openEnhancedParental() {
            const modal = document.getElementById('enhancedParentalModal');
            const content = document.getElementById('enhancedParentalContent');
            const controls = cuteGameState.parentalControls;
            const analytics = cuteGameState.learningAnalytics;
            
            content.innerHTML = `
                <div class="parental-section">
                    <div class="parental-title">‚è∞ Time Management</div>
                    <div class="parental-stat">
                        <span>Current Session:</span>
                        <span>${controls.currentSessionTime} / ${controls.sessionTimeLimit} minutes</span>
                    </div>
                    <div class="parental-stat">
                        <span>Daily Usage:</span>
                        <span>${controls.dailyTimeUsed} / ${controls.dailyTimeLimit} minutes</span>
                    </div>
                    <div class="time-limit-control">
                        <span style="font-size: 10px;">Session Limit:</span>
                        <input type="number" class="time-input" value="${controls.sessionTimeLimit}" onchange="updateSessionLimit(this.value)">
                        <span style="font-size: 9px;">minutes</span>
                    </div>
                    <div class="time-limit-control">
                        <span style="font-size: 10px;">Daily Limit:</span>
                        <input type="number" class="time-input" value="${controls.dailyTimeLimit}" onchange="updateDailyLimit(this.value)">
                        <span style="font-size: 9px;">minutes</span>
                    </div>
                </div>
                
                <div class="parental-section">
                    <div class="parental-title">üìä Learning Progress</div>
                    <div class="parental-stat">
                        <span>Total Learning Time:</span>
                        <span>${Math.floor(analytics.totalPlayTime / 60)} hours</span>
                    </div>
                    <div class="parental-stat">
                        <span>Skills Developed:</span>
                        <span>${analytics.skillsLearned.length} skills</span>
                    </div>
                    <div class="parental-stat">
                        <span>Learning Speed:</span>
                        <span>${analytics.learningSpeed}</span>
                    </div>
                    <div class="parental-stat">
                        <span>Strong Areas:</span>
                        <span>${analytics.strongSubjects.join(', ') || 'Discovering...'}</span>
                    </div>
                </div>
                
                <div class="parental-section">
                    <div class="parental-title">üéØ Achievement Summary</div>
                    <div class="parental-stat">
                        <span>Achievements Unlocked:</span>
                        <span>${cuteGameState.unlockedAchievements.length}/10</span>
                    </div>
                    <div class="parental-stat">
                        <span>Quests Completed:</span>
                        <span>${cuteGameState.story.completedQuests.length}</span>
                    </div>
                    <div class="parental-stat">
                        <span>Friends Made:</span>
                        <span>${cuteGameState.friends.filter(f => f.unlocked).length}/4</span>
                    </div>
                </div>
                
                <div class="parental-section">
                    <div class="parental-title">‚öôÔ∏è Settings</div>
                    <div class="parental-stat">
                        <span>Educational Focus:</span>
                        <label><input type="checkbox" ${controls.educationalFocus ? 'checked' : ''} onchange="toggleEducationalFocus()"> Enabled</label>
                    </div>
                    <div class="parental-stat">
                        <span>Social Features:</span>
                        <label><input type="checkbox" ${controls.allowSocialFeatures ? 'checked' : ''} onchange="toggleSocialFeatures()"> Allowed</label>
                    </div>
                </div>
            `;
            
            modal.style.display = 'block';
            showCuteEffect('üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Parental dashboard opened!', 'sparkle-effect');
        }

        function closeEnhancedParental() {
            document.getElementById('enhancedParentalModal').style.display = 'none';
        }

        function updateSessionLimit(value) {
            cuteGameState.parentalControls.sessionTimeLimit = parseInt(value);
            showCuteEffect('‚è∞ Session limit updated!', 'sparkle-effect');
        }

        function updateDailyLimit(value) {
            cuteGameState.parentalControls.dailyTimeLimit = parseInt(value);
            showCuteEffect('üìÖ Daily limit updated!', 'sparkle-effect');
        }

        function toggleEducationalFocus() {
            cuteGameState.parentalControls.educationalFocus = !cuteGameState.parentalControls.educationalFocus;
            showCuteEffect('üéì Educational focus toggled!', 'sparkle-effect');
        }

        function toggleSocialFeatures() {
            cuteGameState.parentalControls.allowSocialFeatures = !cuteGameState.parentalControls.allowSocialFeatures;
            showCuteEffect('üë´ Social features toggled!', 'sparkle-effect');
        }

        // Override parent button to use enhanced dashboard
        function openParentDashboard() {
            openEnhancedParental();
        }

        // Initialize ultimate systems
        function initializeUltimateSystems() {
            // Check time-based events every 5 minutes
            setInterval(checkTimeBasedEvents, 300000);
            
            // Track session time
            setInterval(() => {
                cuteGameState.parentalControls.currentSessionTime++;
                cuteGameState.parentalControls.dailyTimeUsed++;
                
                // Check time limits
                if (cuteGameState.parentalControls.currentSessionTime >= cuteGameState.parentalControls.sessionTimeLimit) {
                    showTimeBasedEvent('Session Time Limit', 'Time for a break! Come back later to continue playing.');
                }
            }, 60000); // Every minute
            
            // Initial time-based event check
            checkTimeBasedEvents();
        }

        // Initialize ultimate systems
        setTimeout(() => {
            initializeUltimateSystems();
        }, 2000);

        // MOVEMENT AND EXPLORATION SYSTEM

        // Movement Controls
        function startMoving(direction) {
            cuteGameState.movement.isMoving = true;
            cuteGameState.movement.direction = direction;
            
            const koalaContainer = document.getElementById('koalaContainer');
            koalaContainer.classList.add(`moving-${direction}`);
            
            // Start movement interval
            if (!cuteGameState.movementInterval) {
                cuteGameState.movementInterval = setInterval(updateMovement, 50);
            }
        }

        function stopMoving(direction) {
            cuteGameState.movement.isMoving = false;
            
            const koalaContainer = document.getElementById('koalaContainer');
            koalaContainer.classList.remove(`moving-${direction}`);
            
            // Stop movement interval
            if (cuteGameState.movementInterval) {
                clearInterval(cuteGameState.movementInterval);
                cuteGameState.movementInterval = null;
            }
        }

        function updateMovement() {
            if (!cuteGameState.movement.isMoving) return;
            
            const movement = cuteGameState.movement;
            const speed = movement.speed;
            let newX = movement.x;
            let newY = movement.y;
            
            // Calculate new position based on direction
            switch (movement.direction) {
                case 'up':
                    newY = Math.max(50, movement.y - speed);
                    break;
                case 'down':
                    newY = Math.min(350, movement.y + speed);
                    break;
                case 'left':
                    newX = Math.max(50, movement.x - speed);
                    break;
                case 'right':
                    newX = Math.min(450, movement.x + speed);
                    break;
            }
            
            // Update position
            movement.x = newX;
            movement.y = newY;
            
            // Update visual position
            const koalaContainer = document.getElementById('koalaContainer');
            koalaContainer.style.left = newX + 'px';
            koalaContainer.style.top = newY + 'px';
            
            // Track steps for rewards
            cuteGameState.explorationRewards.stepsWalked++;
            
            // Check for interactions with objects and NPCs
            checkProximityInteractions();
            
            // Check for location exits
            checkLocationExits();
            
            // Award exploration rewards
            if (cuteGameState.explorationRewards.stepsWalked % 100 === 0) {
                awardExplorationReward();
            }
        }

        // Keyboard Controls
        function setupKeyboardControls() {
            document.addEventListener('keydown', (event) => {
                const key = event.key.toLowerCase();
                if (['w', 'a', 's', 'd', 'arrowup', 'arrowleft', 'arrowdown', 'arrowright'].includes(key)) {
                    event.preventDefault();
                    
                    if (!cuteGameState.movementKeys[key]) {
                        cuteGameState.movementKeys[key] = true;
                        
                        const directionMap = {
                            'w': 'up', 'arrowup': 'up',
                            's': 'down', 'arrowdown': 'down',
                            'a': 'left', 'arrowleft': 'left',
                            'd': 'right', 'arrowright': 'right'
                        };
                        
                        startMoving(directionMap[key]);
                    }
                }
            });
            
            document.addEventListener('keyup', (event) => {
                const key = event.key.toLowerCase();
                if (['w', 'a', 's', 'd', 'arrowup', 'arrowleft', 'arrowdown', 'arrowright'].includes(key)) {
                    cuteGameState.movementKeys[key] = false;
                    
                    const directionMap = {
                        'w': 'up', 'arrowup': 'up',
                        's': 'down', 'arrowdown': 'down',
                        'a': 'left', 'arrowleft': 'left',
                        'd': 'right', 'arrowright': 'right'
                    };
                    
                    stopMoving(directionMap[key]);
                }
            });
        }

        // Location System
        function loadLocation(locationId) {
            const location = cuteGameState.worldMap[locationId];
            if (!location) return;
            
            cuteGameState.movement.currentLocation = locationId;
            
            // Update background
            const background = document.getElementById('locationBackground');
            background.className = `location-background bg-${locationId}`;
            
            // Load objects
            loadLocationObjects(location);
            
            // Load NPCs
            loadLocationNPCs(location);
            
            // Load exits
            loadLocationExits(location);
            
            // Update mini-map
            updateMiniMap();
            
            // Update location name
            document.getElementById('currentLocationName').textContent = location.name;
            
            // Mark as discovered
            if (!location.discovered) {
                location.discovered = true;
                showCuteAchievement('New Location!', `üó∫Ô∏è Discovered ${location.name}!`);
                cuteGameState.explorationRewards.locationsVisited++;
            }
            
            // Reset Koko's position to center
            cuteGameState.movement.x = 250;
            cuteGameState.movement.y = 200;
            const koalaContainer = document.getElementById('koalaContainer');
            koalaContainer.style.left = '250px';
            koalaContainer.style.top = '200px';
            
            showCuteEffect(`üèÉ‚Äç‚ôÄÔ∏è Arrived at ${location.name}!`, 'sparkle-effect');
        }

        function loadLocationObjects(location) {
            const container = document.getElementById('locationObjects');
            container.innerHTML = '';
            
            location.objects.forEach(obj => {
                const objElement = document.createElement('div');
                objElement.className = 'world-object';
                objElement.style.left = obj.x + 'px';
                objElement.style.top = obj.y + 'px';
                objElement.textContent = obj.emoji;
                objElement.title = obj.name;
                objElement.onclick = () => interactWithWorldObject(obj);
                container.appendChild(objElement);
            });
        }

        function loadLocationNPCs(location) {
            const container = document.getElementById('locationNPCs');
            container.innerHTML = '';
            
            location.npcs.forEach(npc => {
                const npcElement = document.createElement('div');
                npcElement.className = 'world-npc';
                npcElement.style.left = npc.x + 'px';
                npcElement.style.top = npc.y + 'px';
                npcElement.textContent = npc.emoji;
                npcElement.title = npc.name;
                npcElement.onclick = () => interactWithNPC(npc);
                container.appendChild(npcElement);
            });
        }

        function loadLocationExits(location) {
            const container = document.getElementById('locationExits');
            container.innerHTML = '';
            
            const exitPositions = {
                0: { x: 20, y: 20 },    // Top-left
                1: { x: 220, y: 10 },   // Top-center
                2: { x: 420, y: 20 },   // Top-right
                3: { x: 10, y: 180 },   // Middle-left
                4: { x: 430, y: 180 },  // Middle-right
                5: { x: 20, y: 340 },   // Bottom-left
                6: { x: 220, y: 350 },  // Bottom-center
                7: { x: 420, y: 340 }   // Bottom-right
            };
            
            location.connections.forEach((connectionId, index) => {
                const connectedLocation = cuteGameState.worldMap[connectionId];
                if (!connectedLocation) return;
                
                const exitElement = document.createElement('div');
                exitElement.className = 'location-exit';
                const pos = exitPositions[index] || { x: 100 + index * 80, y: 50 };
                exitElement.style.left = pos.x + 'px';
                exitElement.style.top = pos.y + 'px';
                exitElement.textContent = connectedLocation.emoji;
                exitElement.title = `Go to ${connectedLocation.name}`;
                exitElement.onclick = () => {
                    if (cuteGameState.movement.unlockedLocations.includes(connectionId)) {
                        loadLocation(connectionId);
                    } else {
                        showCuteEffect('üîí Location locked! Complete more quests to unlock.', 'sparkle-effect');
                    }
                };
                container.appendChild(exitElement);
            });
        }

        function updateMiniMap() {
            const container = document.getElementById('miniMapContent');
            container.innerHTML = '';
            
            const locationOrder = ['library', 'school', 'park', 'home', 'playground', 'garden'];
            
            locationOrder.forEach(locationId => {
                const location = cuteGameState.worldMap[locationId];
                if (!location) return;
                
                const mapElement = document.createElement('div');
                mapElement.className = 'map-location';
                
                if (cuteGameState.movement.currentLocation === locationId) {
                    mapElement.classList.add('current');
                } else if (cuteGameState.movement.unlockedLocations.includes(locationId)) {
                    mapElement.classList.add('unlocked');
                } else {
                    mapElement.classList.add('locked');
                }
                
                mapElement.textContent = location.emoji;
                mapElement.title = location.name;
                
                if (cuteGameState.movement.unlockedLocations.includes(locationId)) {
                    mapElement.onclick = () => loadLocation(locationId);
                }
                
                container.appendChild(mapElement);
            });
        }

        // Interaction Systems
        function interactWithWorldObject(obj) {
            const distance = getDistance(
                cuteGameState.movement.x, cuteGameState.movement.y,
                obj.x, obj.y
            );
            
            if (distance > 80) {
                showCuteEffect('üö∂‚Äç‚ôÄÔ∏è Get closer to interact!', 'sparkle-effect');
                return;
            }
            
            const actions = {
                sleep: () => {
                    cuteGameState.petCare.energy = Math.min(100, cuteGameState.petCare.energy + 30);
                    showCuteEffect('üò¥ Koko had a refreshing nap!', 'love-effect');
                },
                cook: () => {
                    cuteGameState.petCare.hunger = Math.min(100, cuteGameState.petCare.hunger + 25);
                    showCuteEffect('üç≥ Koko cooked something delicious!', 'sparkle-effect');
                },
                read: () => {
                    cuteGameState.player.xp += 20;
                    cuteGameState.skillTrees.learning.points += 1;
                    showCuteEffect('üìö Koko learned something new!', 'sparkle-effect');
                },
                swing: () => {
                    cuteGameState.stats.happiness = Math.min(100, cuteGameState.stats.happiness + 15);
                    showCuteEffect('ü™Ä Wheee! Koko loves swinging!', 'love-effect');
                },
                slide: () => {
                    cuteGameState.stats.happiness = Math.min(100, cuteGameState.stats.happiness + 20);
                    showCuteEffect('üõù Sliding down the rainbow!', 'sparkle-effect');
                },
                dig: () => {
                    const treasures = ['üèÜ', 'üíé', 'ü™ô', '‚≠ê', 'üéÅ'];
                    const treasure = treasures[Math.floor(Math.random() * treasures.length)];
                    cuteGameState.resources.stickers += 5;
                    showCuteEffect(`üèñÔ∏è Koko found a treasure! ${treasure}`, 'sparkle-effect');
                },
                smell: () => {
                    cuteGameState.stats.love = Math.min(100, cuteGameState.stats.love + 10);
                    showCuteEffect('üå∏ The flowers smell wonderful!', 'love-effect');
                },
                wish: () => {
                    cuteGameState.resources.hearts += 10;
                    showCuteEffect('‚õ≤ Koko made a wish! Dreams come true!', 'sparkle-effect');
                },
                climb: () => {
                    cuteGameState.skillTrees.exploration.points += 2;
                    showCuteEffect('üå≥ Koko climbed high and saw amazing views!', 'sparkle-effect');
                }
            };
            
            const action = actions[obj.action];
            if (action) {
                action();
                cuteGameState.explorationRewards.objectsInteracted++;
                updateCuteDisplay();
                
                // Update quest progress
                updateQuestProgress('interact_object');
            }
        }

        function interactWithNPC(npc) {
            const distance = getDistance(
                cuteGameState.movement.x, cuteGameState.movement.y,
                npc.x, npc.y
            );
            
            if (distance > 60) {
                showCuteEffect('üö∂‚Äç‚ôÄÔ∏è Get closer to talk!', 'sparkle-effect');
                return;
            }
            
            const dialogues = {
                bella: [
                    "Hi Koko! Want to play together? üê∞",
                    "I love hopping around the playground! ü™Ä",
                    "Have you seen the magical flowers in the garden? üå∏"
                ],
                butterfly: [
                    "Flutter flutter! The garden is so beautiful! ü¶ã",
                    "I know where the sweetest nectar is! üå∫",
                    "Want to dance with me among the flowers? üíÉ"
                ],
                owl: [
                    "Hoot hoot! Welcome to the library! ü¶â",
                    "Knowledge is the greatest treasure! üìö",
                    "Have you read any good books lately? üîç"
                ],
                squirrel: [
                    "Chitter chatter! I love collecting acorns! üêøÔ∏è",
                    "The park has the best hiding spots! üå∞",
                    "Want to go on a nature adventure? ü•æ"
                ],
                teacher: [
                    "Hello there! Ready to learn something new? üë©‚Äçüè´",
                    "Education is the key to success! üéì",
                    "What subject interests you most? üìù"
                ]
            };
            
            const npcDialogues = dialogues[npc.id] || ["Hello there! Nice to meet you! üòä"];
            const dialogue = npcDialogues[Math.floor(Math.random() * npcDialogues.length)];
            
            showCuteEffect(`${npc.name}: ${dialogue}`, 'love-effect');
            
            // Award friendship points
            const friend = cuteGameState.friends.find(f => f.name.toLowerCase().includes(npc.id));
            if (friend) {
                friend.friendship = Math.min(100, friend.friendship + 5);
            }
            
            cuteGameState.explorationRewards.npcsMetCount++;
            updateCuteDisplay();
            
            // Update quest progress
            updateQuestProgress('interact_friend');
        }

        function checkProximityInteractions() {
            // Auto-highlight nearby objects and NPCs
            const currentLocation = cuteGameState.worldMap[cuteGameState.movement.currentLocation];
            
            // Check objects
            currentLocation.objects.forEach(obj => {
                const distance = getDistance(
                    cuteGameState.movement.x, cuteGameState.movement.y,
                    obj.x, obj.y
                );
                
                const objElement = document.querySelector(`[title="${obj.name}"]`);
                if (objElement) {
                    if (distance <= 80) {
                        objElement.style.filter = 'drop-shadow(0 0 15px rgba(255,255,0,1))';
                    } else {
                        objElement.style.filter = '';
                    }
                }
            });
            
            // Check NPCs
            currentLocation.npcs.forEach(npc => {
                const distance = getDistance(
                    cuteGameState.movement.x, cuteGameState.movement.y,
                    npc.x, npc.y
                );
                
                const npcElement = document.querySelector(`[title="${npc.name}"]`);
                if (npcElement) {
                    if (distance <= 60) {
                        npcElement.style.filter = 'drop-shadow(0 0 20px rgba(255,182,193,1))';
                    } else {
                        npcElement.style.filter = '';
                    }
                }
            });
        }

        function checkLocationExits() {
            // Auto-travel when walking into exits
            const exits = document.querySelectorAll('.location-exit');
            exits.forEach(exit => {
                const exitRect = exit.getBoundingClientRect();
                const koalaRect = document.getElementById('koalaContainer').getBoundingClientRect();
                
                if (isColliding(koalaRect, exitRect)) {
                    exit.click();
                }
            });
        }

        function getDistance(x1, y1, x2, y2) {
            return Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));
        }

        function isColliding(rect1, rect2) {
            return !(rect1.right < rect2.left || 
                     rect1.left > rect2.right || 
                     rect1.bottom < rect2.top || 
                     rect1.top > rect2.bottom);
        }

        function awardExplorationReward() {
            const rewards = [
                { type: 'stickers', amount: 3, message: 'üéÅ Found stickers while exploring!' },
                { type: 'hearts', amount: 2, message: 'üíï Exploration fills the heart!' },
                { type: 'xp', amount: 10, message: '‚≠ê Adventure experience gained!' },
                { type: 'skillPoints', amount: 1, message: 'üåü Exploration skill point earned!' }
            ];
            
            const reward = rewards[Math.floor(Math.random() * rewards.length)];
            
            if (reward.type === 'skillPoints') {
                cuteGameState.skillTrees.exploration.points += reward.amount;
            } else if (cuteGameState.resources[reward.type]) {
                cuteGameState.resources[reward.type] += reward.amount;
            } else if (cuteGameState.player[reward.type]) {
                cuteGameState.player[reward.type] += reward.amount;
            }
            
            showCuteEffect(reward.message, 'sparkle-effect');
            updateCuteDisplay();
        }

        // Initialize Movement System
        function initializeMovementSystem() {
            setupKeyboardControls();
            loadLocation('home');
            updateMiniMap();
            
            // Update quest progress for visiting playground
            setTimeout(() => {
                updateQuestProgress('visit_playground');
            }, 1000);
        }

        // Initialize movement system
        setTimeout(() => {
            initializeMovementSystem();
        }, 2500);

        // PANEL MANAGEMENT SYSTEM

        function togglePanel(panelName) {
            const panel = document.querySelector(`.${panelName}-panel`);
            const content = document.getElementById(`${panelName}Content`);
            const toggle = document.getElementById(`${panelName}Toggle`);
            
            if (panel.classList.contains('panel-minimized')) {
                panel.classList.remove('panel-minimized');
                content.style.display = 'block';
                toggle.textContent = '‚àí';
            } else {
                panel.classList.add('panel-minimized');
                content.style.display = 'none';
                toggle.textContent = '+';
            }
        }

        // Initialize the new layout
        function initializeNewLayout() {
            // Update all the display elements with current game state
            updateResourceDisplay();
            updateStatsDisplay();
            updateQuestDisplay();
            updateSkillTreeDisplay();
            updateMiniMap();
            updateKokoThoughtsDisplay();
            
            // Show welcome message
            showCuteEffect('üéÆ Welcome to the new adventure layout!', 'sparkle-effect');
        }

        function updateResourceDisplay() {
            document.getElementById('stickerCount').textContent = cuteGameState.resources.stickers;
            document.getElementById('heartCount').textContent = cuteGameState.resources.hearts;
            document.getElementById('xpCount').textContent = cuteGameState.player.xp;
        }

        function updateStatsDisplay() {
            const stats = cuteGameState.stats;
            
            document.getElementById('happinessFill').style.width = stats.happiness + '%';
            document.getElementById('happinessValue').textContent = stats.happiness + '/100';
            
            document.getElementById('healthFill').style.width = stats.health + '%';
            document.getElementById('healthValue').textContent = stats.health + '/100';
            
            document.getElementById('energyFill').style.width = cuteGameState.petCare.energy + '%';
            document.getElementById('energyValue').textContent = cuteGameState.petCare.energy + '/100';
            
            document.getElementById('loveFill').style.width = stats.love + '%';
            document.getElementById('loveValue').textContent = stats.love + '/100';
        }

        // Override the original update function to also update the new layout
        const originalUpdateCuteDisplay = updateCuteDisplay;
        updateCuteDisplay = function() {
            originalUpdateCuteDisplay();
            updateResourceDisplay();
            updateStatsDisplay();
        };

        // Initialize the new layout after everything else is loaded
        setTimeout(() => {
            initializeNewLayout();
        }, 3000);

        // CRITTER COLLECTION SYSTEM

        // Critter Collection Management
        function openCritterCollection() {
            const modal = document.getElementById('critterCollectionModal');
            const grid = document.getElementById('critterGrid');
            
            updateCollectionStats();
            populateCritterGrid();
            
            modal.style.display = 'block';
            showCuteEffect('üêæ Critter collection opened!', 'sparkle-effect');
        }

        function closeCritterCollection() {
            document.getElementById('critterCollectionModal').style.display = 'none';
        }

        function updateCollectionStats() {
            const collection = cuteGameState.critterCollection;
            const ownedCount = Object.keys(collection.critters).length;
            const discoveredCount = Object.values(collection.availableCritters).filter(c => c.discovered).length + ownedCount;
            
            document.getElementById('collectedCount').textContent = ownedCount;
            document.getElementById('discoveredCount').textContent = discoveredCount;
            document.getElementById('breedingStatus').textContent = cuteGameState.breeding.unlocked ? 'Yes' : 'No';
            document.getElementById('critterCount').textContent = `${ownedCount}/${collection.maxCapacity}`;
        }

        function populateCritterGrid() {
            const grid = document.getElementById('critterGrid');
            const collection = cuteGameState.critterCollection;
            grid.innerHTML = '';
            
            // Add owned critters
            Object.values(collection.critters).forEach(critter => {
                const card = createCritterCard(critter, 'owned');
                grid.appendChild(card);
            });
            
            // Add available critters
            Object.values(collection.availableCritters).forEach(critter => {
                const status = critter.unlocked ? 'owned' : (critter.discovered ? 'discovered' : 'locked');
                const card = createCritterCard(critter, status);
                grid.appendChild(card);
            });
        }

        function createCritterCard(critter, status) {
            const card = document.createElement('div');
            card.className = `critter-card ${status}`;
            
            const emoji = status === 'locked' ? '‚ùì' : critter.emoji;
            const name = status === 'locked' ? '???' : critter.name;
            const type = status === 'locked' ? 'Unknown' : critter.type;
            
            let statusText = '';
            if (status === 'owned') {
                statusText = `Level ${critter.level || 1}`;
            } else if (status === 'discovered') {
                statusText = critter.unlockRequirement;
            } else {
                statusText = 'Not discovered';
            }
            
            card.innerHTML = `
                <div class="critter-card-emoji">${emoji}</div>
                <div class="critter-card-name">${name}</div>
                <div class="critter-card-type">${type}</div>
                <div class="critter-card-status">${statusText}</div>
            `;
            
            if (status === 'owned') {
                card.onclick = () => showCritterDetails(critter.id);
            } else if (status === 'discovered') {
                card.onclick = () => showUnlockProgress(critter.id);
            }
            
            return card;
        }

        // Critter Switching
        function openCritterSwitcher() {
            const modal = document.getElementById('critterSwitcherModal');
            const list = document.getElementById('ownedCrittersList');
            
            list.innerHTML = '';
            
            Object.values(cuteGameState.critterCollection.critters).forEach(critter => {
                const item = document.createElement('div');
                item.className = `owned-critter-item ${critter.id === cuteGameState.critterCollection.activeCritter ? 'active' : ''}`;
                
                item.innerHTML = `
                    <div class="owned-critter-emoji">${critter.emoji}</div>
                    <div class="owned-critter-details">
                        <div class="owned-critter-name">${critter.name}</div>
                        <div class="owned-critter-stats">Level ${critter.level} ${critter.stage} ‚Ä¢ ${critter.specialization}</div>
                    </div>
                `;
                
                item.onclick = () => switchActiveCritter(critter.id);
                list.appendChild(item);
            });
            
            modal.style.display = 'block';
            showCuteEffect('üîÑ Choose your active critter!', 'sparkle-effect');
        }

        function closeCritterSwitcher() {
            document.getElementById('critterSwitcherModal').style.display = 'none';
        }

        function switchActiveCritter(critterId) {
            cuteGameState.critterCollection.activeCritter = critterId;
            updateActiveCritterDisplay();
            updateGameWorldCritter();
            closeCritterSwitcher();
            showCuteAchievement('Critter Switched!', `üîÑ ${cuteGameState.critterCollection.critters[critterId].name} is now active!`);
        }

        function updateActiveCritterDisplay() {
            const activeCritter = getActiveCritter();
            if (!activeCritter) return;
            
            document.getElementById('activeCritterAvatar').textContent = activeCritter.emoji;
            document.getElementById('activeCritterName').textContent = activeCritter.name;
            document.getElementById('activeCritterLevel').textContent = `Level ${activeCritter.level} ${activeCritter.stage}`;
            document.getElementById('activeCritterSpec').textContent = activeCritter.specialization;
            
            // Update growth bars
            const growthPoints = activeCritter.growthPoints;
            document.getElementById('mathGrowth').style.width = growthPoints.math + '%';
            document.getElementById('scienceGrowth').style.width = growthPoints.science + '%';
            document.getElementById('creativityGrowth').style.width = growthPoints.creativity + '%';
        }

        function updateGameWorldCritter() {
            const activeCritter = getActiveCritter();
            if (!activeCritter) return;
            
            // Update the visual critter in the game world
            document.getElementById('cuteKoala').textContent = activeCritter.emoji;
            document.getElementById('koalaTitle').textContent = `${activeCritter.name} the ${activeCritter.type} ‚Ä¢ Level ${activeCritter.level}`;
            document.getElementById('koalaStatus').textContent = `${activeCritter.name} is exploring! üåà`;
        }

        function getActiveCritter() {
            return cuteGameState.critterCollection.critters[cuteGameState.critterCollection.activeCritter];
        }

        // Critter Growth and Development
        function awardCritterGrowth(activityType, points = 10) {
            const activeCritter = getActiveCritter();
            if (!activeCritter) return;
            
            // Award growth points based on activity type
            const growthMapping = {
                'math': 'math',
                'science': 'science',
                'reading': 'reading',
                'creativity': 'creativity',
                'social': 'social',
                'physical': 'physical',
                'learn': 'reading',
                'play': 'physical',
                'create': 'creativity',
                'explore': 'physical'
            };
            
            const growthType = growthMapping[activityType] || 'math';
            activeCritter.growthPoints[growthType] = Math.min(100, activeCritter.growthPoints[growthType] + points);
            activeCritter.experience += points;
            
            // Check for level up
            checkCritterLevelUp(activeCritter);
            
            // Check for evolution
            checkCritterEvolution(activeCritter);
            
            // Update displays
            updateActiveCritterDisplay();
            
            showCuteEffect(`üìà ${activeCritter.name} gained ${points} ${growthType} points!`, 'sparkle-effect');
        }

        function checkCritterLevelUp(critter) {
            const requiredExp = cuteGameState.critterGrowth.experienceRequired;
            const currentStageIndex = cuteGameState.critterGrowth.stages.indexOf(critter.stage);
            
            if (currentStageIndex < requiredExp.length - 1) {
                const nextStageExp = requiredExp[currentStageIndex + 1];
                if (critter.experience >= nextStageExp) {
                    critter.level++;
                    critter.stage = cuteGameState.critterGrowth.stages[currentStageIndex + 1];
                    showCuteAchievement('Level Up!', `üéâ ${critter.name} evolved to ${critter.stage}!`);
                    
                    // Award bonus stats
                    Object.keys(critter.growthPoints).forEach(stat => {
                        critter.growthPoints[stat] = Math.min(100, critter.growthPoints[stat] + 5);
                    });
                }
            }
        }

        function checkCritterEvolution(critter) {
            // Check if critter can evolve based on growth points
            const totalGrowth = Object.values(critter.growthPoints).reduce((sum, val) => sum + val, 0);
            const averageGrowth = totalGrowth / Object.keys(critter.growthPoints).length;
            
            if (averageGrowth >= 80 && critter.evolutionStage < critter.maxEvolution) {
                critter.evolutionStage++;
                critter.level += 2;
                
                // Enhance critter abilities
                critter.intelligence = Math.min(100, critter.intelligence + 10);
                critter.creativity = Math.min(100, critter.creativity + 10);
                critter.social = Math.min(100, critter.social + 10);
                critter.strength = Math.min(100, critter.strength + 10);
                
                showCuteAchievement('Evolution!', `‚ú® ${critter.name} has evolved! All abilities increased!`);
            }
        }

        // Critter Discovery and Unlocking
        function checkCritterUnlocks() {
            const availableCritters = cuteGameState.critterCollection.availableCritters;
            
            Object.values(availableCritters).forEach(critter => {
                if (!critter.discovered && !critter.unlocked) {
                    checkCritterDiscovery(critter);
                } else if (critter.discovered && !critter.unlocked) {
                    checkCritterUnlock(critter);
                }
            });
        }

        function checkCritterDiscovery(critter) {
            // Discovery conditions based on player actions
            const discoveryConditions = {
                'bella': () => cuteGameState.story.completedQuests.length > 0,
                'charlie': () => cuteGameState.skillTrees.creativity.level >= 2,
                'danny': () => cuteGameState.explorationRewards.stepsWalked >= 100,
                'ellie': () => cuteGameState.skillTrees.learning.level >= 3,
                'ruby': () => cuteGameState.advancedMiniGames.logicPuzzles.level >= 2,
                'luna': () => cuteGameState.explorationRewards.objectsInteracted >= 5,
                'splash': () => cuteGameState.movement.currentLocation === 'pond',
                'spark': () => Object.values(cuteGameState.skillTrees).every(tree => tree.level >= 5)
            };
            
            const condition = discoveryConditions[critter.id];
            if (condition && condition()) {
                critter.discovered = true;
                showCuteAchievement('New Critter Discovered!', `üîç ${critter.name} the ${critter.type} has been discovered!`);
                updateCollectionStats();
            }
        }

        function checkCritterUnlock(critter) {
            // Update unlock progress based on requirements
            const unlockConditions = {
                'bella': () => cuteGameState.story.completedQuests.includes('friendship_quest'),
                'charlie': () => cuteGameState.resources.stickers >= 100, // Creative activities
                'danny': () => cuteGameState.explorationRewards.stepsWalked >= 500,
                'ellie': () => cuteGameState.skillTrees.learning.level >= 10,
                'ruby': () => cuteGameState.advancedMiniGames.logicPuzzles.completed.length >= 10,
                'luna': () => cuteGameState.explorationRewards.objectsInteracted >= 20,
                'splash': () => cuteGameState.weather.effects.includes('rain'),
                'spark': () => Object.values(cuteGameState.skillTrees).every(tree => tree.level >= 10)
            };
            
            const condition = unlockConditions[critter.id];
            if (condition && condition()) {
                unlockCritter(critter.id);
            }
        }

        function unlockCritter(critterId) {
            const critter = cuteGameState.critterCollection.availableCritters[critterId];
            if (!critter) return;
            
            // Create new critter instance
            const newCritter = {
                id: critterId,
                name: critter.name,
                type: critter.type,
                emoji: critter.emoji,
                stage: 'baby',
                level: 1,
                experience: 0,
                specialization: critter.specialization,
                personality: critter.personality,
                happiness: 50,
                health: 100,
                energy: 100,
                love: 25,
                intelligence: 30,
                creativity: 30,
                social: 30,
                strength: 30,
                discovered: true,
                unlocked: true,
                habitat: critter.habitat,
                favoriteActivities: ['play', 'learn'],
                growthPoints: {
                    math: 10,
                    science: 10,
                    reading: 10,
                    creativity: 10,
                    social: 10,
                    physical: 10
                },
                evolutionStage: 1,
                maxEvolution: 3,
                bondLevel: 1,
                lastInteraction: Date.now()
            };
            
            // Add to collection
            cuteGameState.critterCollection.critters[critterId] = newCritter;
            cuteGameState.critterCollection.totalCritters++;
            critter.unlocked = true;
            
            showCuteAchievement('New Critter Unlocked!', `üéâ ${critter.name} has joined your collection!`);
            updateCollectionStats();
            
            // Check if breeding is unlocked
            if (cuteGameState.critterCollection.totalCritters >= 3 && !cuteGameState.breeding.unlocked) {
                cuteGameState.breeding.unlocked = true;
                showCuteAchievement('Breeding Unlocked!', 'üß¨ You can now breed critters in the laboratory!');
            }
        }

        // Enhanced activity system to award critter growth
        function enhancedDoCuteActivity(activityType) {
            // Call original activity function
            doCuteActivity(activityType);
            
            // Award critter growth
            awardCritterGrowth(activityType, 15);
            
            // Check for critter unlocks
            checkCritterUnlocks();
        }

        // Override original activity functions
        const originalDoCuteActivity = doCuteActivity;
        doCuteActivity = function(activityType) {
            originalDoCuteActivity(activityType);
            awardCritterGrowth(activityType, 10);
            checkCritterUnlocks();
        };

        // Override educational challenge completion
        const originalCompleteEducationalChallenge = completeEducationalChallenge;
        completeEducationalChallenge = function(challengeType) {
            originalCompleteEducationalChallenge(challengeType);
            awardCritterGrowth(challengeType, 20);
            checkCritterUnlocks();
        };

        // Initialize critter collection system
        function initializeCritterCollection() {
            updateActiveCritterDisplay();
            updateGameWorldCritter();
            updateCollectionStats();
            checkCritterUnlocks();
            
            // Set up periodic critter care reminders
            setInterval(() => {
                const activeCritter = getActiveCritter();
                if (activeCritter && Date.now() - activeCritter.lastInteraction > 300000) { // 5 minutes
                    showCuteEffect(`üí≠ ${activeCritter.name} misses you! Come play together!`, 'love-effect');
                }
            }, 300000); // Check every 5 minutes
        }

        // Initialize critter collection system
        setTimeout(() => {
            initializeCritterCollection();
        }, 3500);

        // ACHIEVEMENT SYSTEM

        function checkAchievements() {
            const achievements = cuteGameState.achievements;
            
            Object.values(achievements.categories).forEach(category => {
                category.achievements.forEach(achievement => {
                    if (!achievements.unlocked.includes(achievement.id)) {
                        checkAchievementProgress(achievement);
                    }
                });
            });
        }

        function checkAchievementProgress(achievement) {
            let progress = 0;
            let completed = false;
            
            // Check different achievement types
            switch (achievement.id) {
                case 'first_lesson':
                    completed = cuteGameState.player.xp > 0;
                    break;
                case 'math_whiz':
                    progress = cuteGameState.skillTrees.learning.points;
                    completed = progress >= achievement.target;
                    break;
                case 'first_friend':
                    completed = cuteGameState.critterCollection.totalCritters >= 2;
                    break;
                case 'growing_family':
                    progress = cuteGameState.critterCollection.totalCritters;
                    completed = progress >= achievement.target;
                    break;
                case 'first_steps':
                    progress = cuteGameState.explorationRewards.stepsWalked;
                    completed = progress >= achievement.target;
                    break;
                case 'wanderer':
                    progress = cuteGameState.explorationRewards.stepsWalked;
                    completed = progress >= achievement.target;
                    break;
                case 'explorer':
                    progress = cuteGameState.explorationRewards.locationsVisited;
                    completed = progress >= achievement.target;
                    break;
                case 'treasure_hunter':
                    progress = cuteGameState.explorationRewards.objectsInteracted;
                    completed = progress >= achievement.target;
                    break;
                case 'social_butterfly':
                    progress = cuteGameState.explorationRewards.npcsMetCount;
                    completed = progress >= achievement.target;
                    break;
                case 'evolution_master':
                    completed = Object.values(cuteGameState.critterCollection.critters).some(c => c.stage === 'legendary');
                    break;
                case 'daily_player':
                    // Check if played for consecutive days (simplified)
                    completed = cuteGameState.player.level >= 5;
                    break;
                case 'early_bird':
                    const hour = new Date().getHours();
                    completed = hour >= 6 && hour <= 10;
                    break;
                case 'night_owl':
                    const nightHour = new Date().getHours();
                    completed = nightHour >= 20 || nightHour <= 6;
                    break;
            }
            
            // Update progress
            cuteGameState.achievements.progress[achievement.id] = progress;
            
            // Unlock achievement if completed
            if (completed && !cuteGameState.achievements.unlocked.includes(achievement.id)) {
                unlockAchievement(achievement);
            }
        }

        function unlockAchievement(achievement) {
            cuteGameState.achievements.unlocked.push(achievement.id);
            
            // Award rewards
            if (achievement.reward.stickers) {
                cuteGameState.resources.stickers += achievement.reward.stickers;
            }
            if (achievement.reward.hearts) {
                cuteGameState.resources.hearts += achievement.reward.hearts;
            }
            if (achievement.reward.xp) {
                cuteGameState.player.xp += achievement.reward.xp;
            }
            
            // Show achievement notification
            showAchievementUnlocked(achievement);
            
            // Update displays
            updateAchievementDisplay();
            updateCuteDisplay();
            
            // Check for special rewards
            if (achievement.reward.specialCritter) {
                unlockSpecialCritter(achievement.reward.specialCritter);
            }
            if (achievement.reward.specialLocation) {
                unlockSpecialLocation(achievement.reward.specialLocation);
            }
        }

        function showAchievementUnlocked(achievement) {
            showCuteAchievement('Achievement Unlocked!', `${achievement.emoji} ${achievement.name}: ${achievement.desc}`);
            
            // Add to recent achievements
            addRecentAchievement(achievement);
        }

        function addRecentAchievement(achievement) {
            const recentList = document.getElementById('recentAchievementsList');
            
            // Remove "no achievements" message
            const noAchievements = recentList.querySelector('.no-achievements');
            if (noAchievements) {
                noAchievements.remove();
            }
            
            // Add new achievement
            const achievementElement = document.createElement('div');
            achievementElement.className = 'recent-achievement';
            achievementElement.innerHTML = `
                <span>${achievement.emoji}</span>
                <span>${achievement.name}</span>
            `;
            
            recentList.insertBefore(achievementElement, recentList.firstChild);
            
            // Keep only last 3 achievements
            while (recentList.children.length > 3) {
                recentList.removeChild(recentList.lastChild);
            }
        }

        function updateAchievementDisplay() {
            const totalAchievements = Object.values(cuteGameState.achievements.categories)
                .reduce((total, category) => total + category.achievements.length, 0);
            
            document.getElementById('achievementsUnlocked').textContent = cuteGameState.achievements.unlocked.length;
            document.getElementById('totalAchievements').textContent = totalAchievements;
        }

        function openAchievements() {
            const modal = document.getElementById('achievementsModal');
            populateAchievementCategories();
            showAchievementCategory('learning');
            modal.style.display = 'block';
            showCuteEffect('üèÜ Achievement gallery opened!', 'sparkle-effect');
        }

        function closeAchievements() {
            document.getElementById('achievementsModal').style.display = 'none';
        }

        function populateAchievementCategories() {
            const tabsContainer = document.getElementById('categoryTabs');
            tabsContainer.innerHTML = '';
            
            Object.entries(cuteGameState.achievements.categories).forEach(([categoryId, category]) => {
                const tab = document.createElement('div');
                tab.className = 'category-tab';
                tab.innerHTML = `${category.emoji} ${category.name}`;
                tab.onclick = () => showAchievementCategory(categoryId);
                tabsContainer.appendChild(tab);
            });
        }

        function showAchievementCategory(categoryId) {
            // Update active tab
            document.querySelectorAll('.category-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // Populate achievement grid
            const grid = document.getElementById('achievementGrid');
            const category = cuteGameState.achievements.categories[categoryId];
            grid.innerHTML = '';
            
            category.achievements.forEach(achievement => {
                const item = document.createElement('div');
                const isUnlocked = cuteGameState.achievements.unlocked.includes(achievement.id);
                const progress = cuteGameState.achievements.progress[achievement.id] || 0;
                const progressPercent = achievement.target ? Math.min(100, (progress / achievement.target) * 100) : (isUnlocked ? 100 : 0);
                
                item.className = `achievement-item ${isUnlocked ? 'unlocked' : 'locked'}`;
                item.innerHTML = `
                    <div class="achievement-emoji">${achievement.emoji}</div>
                    <div class="achievement-name">${achievement.name}</div>
                    <div class="achievement-desc">${achievement.desc}</div>
                    <div class="achievement-progress">
                        <div class="achievement-progress-fill" style="width: ${progressPercent}%"></div>
                    </div>
                    <div class="achievement-reward">
                        ${achievement.reward.stickers ? `${achievement.reward.stickers} üéÅ` : ''}
                        ${achievement.reward.hearts ? `${achievement.reward.hearts} üíï` : ''}
                        ${achievement.reward.specialCritter ? `Special Critter!` : ''}
                    </div>
                `;
                
                grid.appendChild(item);
            });
        }

        // STORY MODE SYSTEM

        function openStoryMode() {
            const modal = document.getElementById('storyModeModal');
            showChapterSelection();
            modal.style.display = 'block';
            showCuteEffect('üìñ Story mode opened!', 'sparkle-effect');
        }

        function closeStoryMode() {
            document.getElementById('storyModeModal').style.display = 'none';
        }

        function showChapterSelection() {
            const chapterSelection = document.getElementById('chapterSelection');
            const storyScene = document.getElementById('storyScene');
            
            chapterSelection.style.display = 'block';
            storyScene.style.display = 'none';
            
            chapterSelection.innerHTML = '';
            
            Object.values(cuteGameState.storyMode.chapters).forEach(chapter => {
                const isUnlocked = cuteGameState.storyMode.unlockedChapters.includes(chapter.id);
                const isCompleted = cuteGameState.storyMode.completedChapters.includes(chapter.id);
                
                const card = document.createElement('div');
                card.className = `chapter-card ${isCompleted ? 'completed' : ''} ${!isUnlocked ? 'locked' : ''}`;
                
                let statusText = '';
                if (isCompleted) {
                    statusText = '‚úÖ Completed';
                } else if (isUnlocked) {
                    statusText = 'üîì Available';
                } else {
                    statusText = `üîí ${chapter.unlockRequirement}`;
                }
                
                card.innerHTML = `
                    <div class="chapter-emoji">${chapter.emoji}</div>
                    <div class="chapter-info-detailed">
                        <div class="chapter-title-large">${chapter.title}</div>
                        <div class="chapter-description">${chapter.description}</div>
                        <div class="chapter-status">${statusText}</div>
                    </div>
                `;
                
                if (isUnlocked) {
                    card.onclick = () => startChapter(chapter.id);
                }
                
                chapterSelection.appendChild(card);
            });
        }

        function startChapter(chapterId) {
            cuteGameState.storyMode.currentChapter = chapterId;
            cuteGameState.storyMode.currentScene = { chapter: chapterId, scene: 1 };
            showCurrentScene();
        }

        function showCurrentScene() {
            const chapterSelection = document.getElementById('chapterSelection');
            const storyScene = document.getElementById('storyScene');
            
            chapterSelection.style.display = 'none';
            storyScene.style.display = 'block';
            
            const currentChapter = cuteGameState.storyMode.chapters[cuteGameState.storyMode.currentScene.chapter];
            const currentSceneData = currentChapter.scenes[cuteGameState.storyMode.currentScene.scene - 1];
            
            storyScene.innerHTML = `
                <div class="scene-title">${currentSceneData.title}</div>
                <div class="scene-content">${currentSceneData.content}</div>
                <div class="scene-choices">
                    ${currentSceneData.choices.map((choice, index) => 
                        `<button class="choice-button" onclick="makeChoice(${index})">${choice}</button>`
                    ).join('')}
                </div>
            `;
        }

        function makeChoice(choiceIndex) {
            const currentChapter = cuteGameState.storyMode.chapters[cuteGameState.storyMode.currentScene.chapter];
            const currentSceneData = currentChapter.scenes[cuteGameState.storyMode.currentScene.scene - 1];
            
            // Award scene rewards
            if (currentSceneData.rewards) {
                Object.entries(currentSceneData.rewards).forEach(([resource, amount]) => {
                    if (cuteGameState.resources[resource]) {
                        cuteGameState.resources[resource] += amount;
                    } else if (cuteGameState.player[resource]) {
                        cuteGameState.player[resource] += amount;
                    }
                });
            }
            
            // Progress to next scene or complete chapter
            if (cuteGameState.storyMode.currentScene.scene < currentChapter.scenes.length) {
                cuteGameState.storyMode.currentScene.scene++;
                showCurrentScene();
            } else {
                completeChapter();
            }
            
            updateCuteDisplay();
        }

        function completeChapter() {
            const chapterId = cuteGameState.storyMode.currentScene.chapter;
            const chapter = cuteGameState.storyMode.chapters[chapterId];
            
            // Mark chapter as completed
            if (!cuteGameState.storyMode.completedChapters.includes(chapterId)) {
                cuteGameState.storyMode.completedChapters.push(chapterId);
            }
            
            // Award chapter rewards
            if (chapter.rewards) {
                Object.entries(chapter.rewards).forEach(([resource, amount]) => {
                    if (resource === 'newCritter') {
                        unlockCritter(amount);
                    } else if (resource === 'newLocation') {
                        unlockLocation(amount);
                    } else if (cuteGameState.resources[resource]) {
                        cuteGameState.resources[resource] += amount;
                    } else if (cuteGameState.player[resource]) {
                        cuteGameState.player[resource] += amount;
                    }
                });
            }
            
            // Unlock next chapter
            const nextChapterId = chapterId + 1;
            if (cuteGameState.storyMode.chapters[nextChapterId] && 
                !cuteGameState.storyMode.unlockedChapters.includes(nextChapterId)) {
                cuteGameState.storyMode.unlockedChapters.push(nextChapterId);
            }
            
            showCuteAchievement('Chapter Complete!', `üìñ ${chapter.title} completed!`);
            updateStoryDisplay();
            showChapterSelection();
        }

        function updateStoryDisplay() {
            const currentChapter = cuteGameState.storyMode.chapters[cuteGameState.storyMode.currentChapter];
            
            document.getElementById('currentChapterEmoji').textContent = currentChapter.emoji;
            document.getElementById('currentChapterTitle').textContent = currentChapter.title;
            document.getElementById('currentChapterProgress').textContent = 
                `Scene ${cuteGameState.storyMode.currentScene.scene}/${currentChapter.scenes.length}`;
            
            document.getElementById('chaptersCompleted').textContent = 
                `${cuteGameState.storyMode.completedChapters.length}/${Object.keys(cuteGameState.storyMode.chapters).length}`;
            
            const totalScenes = Object.values(cuteGameState.storyMode.chapters)
                .reduce((total, chapter) => total + chapter.scenes.length, 0);
            const completedScenes = cuteGameState.storyMode.completedChapters
                .reduce((total, chapterId) => total + cuteGameState.storyMode.chapters[chapterId].scenes.length, 0);
            
            document.getElementById('scenesCompleted').textContent = `${completedScenes}/${totalScenes}`;
        }

        // Enhanced activity system to check achievements and story progress
        const originalCompleteEducationalChallenge2 = completeEducationalChallenge;
        completeEducationalChallenge = function(challengeType) {
            originalCompleteEducationalChallenge2(challengeType);
            checkAchievements();
        };

        const originalAwardCritterGrowth = awardCritterGrowth;
        awardCritterGrowth = function(activityType, points) {
            originalAwardCritterGrowth(activityType, points);
            checkAchievements();
        };

        // Initialize Achievement and Story systems
        function initializeAchievementAndStory() {
            updateAchievementDisplay();
            updateStoryDisplay();
            checkAchievements();
            
            // Check time-based achievements
            setInterval(() => {
                checkAchievements();
            }, 60000); // Check every minute
        }

        // Initialize systems
        setTimeout(() => {
            initializeAchievementAndStory();
        }, 4000);
    </script>
</body>
</html>